/*!
 * Name: @dsf/cli-platform
 * Version: 0.2.39
 * Description: 平台基础包
 * BuildTime: 2021/4/25 下午9:52:35
 */
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[1],{184:function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}o.d(e,"a",(function(){return i}))},185:function(t,e,o){"use strict";function i(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}o.d(e,"a",(function(){return n}))},461:function(t,e,o){var i=o(13),n=o(499).entries;i({target:"Object",stat:!0},{entries:function(t){return n(t)}})},499:function(t,e,o){var i=o(60),n=o(196),s=o(88),r=o(242).f,a=function(t){return function(e){var o,a=s(e),l=n(a),c=l.length,u=0,m=[];while(c>u)o=l[u++],i&&!r.call(a,o)||m.push(t?[o,a[o]]:a[o]);return m}};t.exports={entries:a(!0),values:a(!1)}},858:function(t,e,o){"use strict";var i=o(184),n=o(185),s=(o(30),o(31),o(461),function(){function t(){Object(i["a"])(this,t),this.events={}}return Object(n["a"])(t,[{key:"listen",value:function(t,e){if(void 0===this.events[t])this.events[t]=[e];else{var o=this.events[t];if(!_.isArray(o))return void"请使用 on 来监听 ".concat(t," 事件");o.push(e)}}},{key:"dispatch",value:function(t,e){var o=this.events[t];o&&_.isArray(o)&&o.forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){void 0===this.events[t]?this.events[t]=e:_.isArray(this.events[t])&&"请使用 listen 来监听 ".concat(t," 事件")}},{key:"emit",value:function(t,e){var o=this.events[t];o&&(_.isArray(o)||o(e))}},{key:"off",value:function(t){this.events[t]=void 0}},{key:"clear",value:function(){this.events={}}},{key:"$getAllListener",value:function(){return Object.entries(this.events)}}]),t}()),r=new s;window.$simpleEventBus=r,e["a"]=r},861:function(t,e,o){var i=o(13),n=o(22),s=o(863).f,r=n((function(){return!Object.getOwnPropertyNames(1)}));i({target:"Object",stat:!0,forced:r},{getOwnPropertyNames:s})},862:function(t,e,o){"use strict";o.d(e,"a",(function(){return s}));var i=o(184),n=o(185),s=(o(16),o(30),o(31),o(861),function(){function t(e,o){var n=this;Object(i["a"])(this,t),this.config=e,o||this.alert("url里面缺少必要的opt参数"),this.config[o]||this.alert("[".concat(this.config.name,"] url里面的opt参数没有对应的配置项")),Object.getOwnPropertyNames(this.config[o]).forEach((function(t){n[t]=n.config[o][t]}))}return Object(n["a"])(t,[{key:"alert",value:function(t){throw dsf.layer.alert({title:"警告",type:"warning",message:t}),new Error(t)}}]),t}())},863:function(t,e,o){var i=o(88),n=o(174).f,s={}.toString,r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return n(t)}catch(e){return r.slice()}};t.exports.f=function(t){return r&&"[object Window]"==s.call(t)?a(t):n(i(t))}},865:function(t,e,o){var i=o(877);"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=o(66).default;n("386800bd",i,!1,{sourceMap:!1,shadowMode:!1})},876:function(t,e,o){"use strict";o(865)},877:function(t,e,o){"use strict";o.r(e)},898:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"ds-dormitory-container"},[o("left-menu",{attrs:{title:t.leftMenuTitle},scopedSlots:t._u([{key:"inner",fn:function(){return[o(t.dynamicLeft,t._b({tag:"component"},"component",t.commonProps,!1,!0))]},proxy:!0}])}),o("div",{staticClass:"ds-dormitory-right"},[o("div",{staticClass:"top-tool-container"},[o(t.dynamicTop,t._b({tag:"component"},"component",t.commonProps,!1,!0))],1),o(t.dynamicRoom,t._b({tag:"component"},"component",t.commonProps,!1,!0))],1)],1)},n=[];i._withStripped=!0;var s=o(858),r=(o(37),o(12),o(268),o(188),o(30),o(31),o(25),o(73),function(){_.isFunction(Date.prototype.Format)||(Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?e[o]:("00"+e[o]).substr((""+e[o]).length)));return t})}),a=function(t,e){var o=function(t,e){return e||t};return _.assignWith({},t,e,o)},l=function(t,e){if(!t||0===t.length)return[];var o=[];return t.forEach((function(t){var i=Object.assign({},t);i.roomDtos=t.roomDtos.filter((function(t){var o=e.find((function(e){return e.val===t.statusValue}));return!!o&&o.checked})),o.push(i)})),o},c=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"ds-dormitory-left"},[o("div",{staticClass:"title",domProps:{innerHTML:t._s(t.mtitle)}}),t._t("inner")],2)},u=[];c._withStripped=!0;o(21),o(74);var m={name:"leftMenu",props:{title:{type:[String,Array],default:""}},computed:{mtitle:function(){var t=this.$route.query.opt;if("string"===typeof this.title)return'<label class="active">'.concat(this.title,"</label>");if(this.title instanceof Array){var e="";return this.title.forEach((function(o){e+='<label class="'.concat(o.opt===t?"active":"",'" data-opt="').concat(o.opt,'">').concat(o.title,"</label>")})),e}return""}},mounted:function(){this.bindLabelClickEvent()},watch:{"$route.query.opt":function(){this.bindLabelClickEvent()}},methods:{bindLabelClickEvent:function(){var t=this;setTimeout((function(){$(".title").children("label").on("click",(function(){var e=$(this).data("opt");t.$router.replace({query:{opt:e}})}))}),500)}}},d=m,f=o(0),h=Object(f["a"])(d,c,u,!1,null,null,null);h.options.__file="pc/dormitory/room/leftMenu.vue";var p=h.exports,v=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[t._v(t._s(t.title))]),o("div",{staticClass:"sec-box"},[o("color-state-list",{attrs:{"room-state-list":t.roomStateList}}),o("time-range",{attrs:{"only-choose-future":!t.queryTimeCouldChooseHistory,form:t.queryTime}}),o("dsf-button",{on:{click:t.doQuery}},[t._v("搜索")])],1)])},g=[];v._withStripped=!0;var y=o(14),b=o(592),R={queryRoomList:"queryRoomList",treeNextLevel:"treeNextLevel",treeCurrent:"treeCurrent",chosenRoomCheckOut:"chosenRoomCheckOut",reserveRoomCancel:"reserveRoomCancel",restoreSelectRoom:"restoreSelectRoom",restoreAllRoom:"restoreAllRoom",autoCheckIn:"autoCheckIn",refreshGroupList:"refreshGroupList",resetOccupiedRoom:"resetOccupiedRoom",resetCheckedRoom:"resetCheckedRoom",sureRoomResource:"sureRoomResource",autoRoomResource:"autoRoomResource"},I=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"date-box"},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间",readonly:this.readonlyArr[0],"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm","picker-options":t.pickerOption1},on:{change:t.changeTime1},model:{value:t.form.sDate,callback:function(e){t.$set(t.form,"sDate",e)},expression:"form.sDate"}}),o("span",{staticClass:"time-divider"},[t._v("至")]),o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",readonly:this.readonlyArr[1],"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm","picker-options":t.pickerOption2},model:{value:t.form.eDate,callback:function(e){t.$set(t.form,"eDate",e)},expression:"form.eDate"}})],1)},C=[];I._withStripped=!0;var k={name:"timeRange",props:{form:{type:Object,default:function(){return{sDate:"",eDate:""}}},readonlyArr:{type:Array,default:function(){return[!1,!1]}},onlyChooseFuture:{type:Boolean,default:!1}},data:function(){return{pickerOption1:{disabledDate:this.disabledDate1},pickerOption2:{disabledDate:this.disabledDate2}}},computed:{time1:function(){return new Date(this.form.sDate).getTime()},time2:function(){return new Date(this.form.eDate).getTime()}},methods:{disabledDate1:function(t){if(!this.onlyChooseFuture)return!1;var e=(new Date).Format("yyyy-MM-dd");e=new Date(e+" 00:00:00").getTime();var o=new Date(t).getTime();return o<e},disabledDate2:function(t){var e=new Date(t).getTime();return e<this.time1},changeTime1:function(){this.time1>=this.time2&&(this.form.eDate="")}}},L=k,S=Object(f["a"])(L,I,C,!1,null,null,null);S.options.__file="pc/dormitory/dialog/timeRange.vue";var D=S.exports,x=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ul",{staticClass:"ds-state-list"},t._l(t.roomStateList,(function(e,i){return o("li",{key:e.val},[o("label",{on:{click:function(o){return t.checkState(e,i)}}},[o("i",{style:t.getSty(e)}),o("span",[t._v(t._s(e.txt))])])])})),0)},O=[];x._withStripped=!0;o(36);var w={name:"colorStateList",props:{roomStateList:{type:Array,default:function(){return[]}},checkAble:{type:Boolean,default:!0}},created:function(){this.roomStateList.forEach((function(t){t.checked=!0}))},methods:{getSty:function(t){return{backgroundColor:t.checked?t.bgColor:"rgba(255,255,255,0)",border:t.checked?"none":"2px solid "+t.color}},checkState:function(t,e){if(this.checkAble){var o=_.cloneDeep(this.roomStateList),i=Object.assign({},t);i.checked=!i.checked,o.splice(e,1,i),this.$store.commit("dormitory/changeRoomStateList",o)}}}},T=w,j=Object(f["a"])(T,x,O,!1,null,null,null);j.options.__file="pc/dormitory/room/colorStateList.vue";var F=j.exports,q={name:"guestsTopTool",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}}},computed:Object(y["a"])(Object(y["a"])({},Object(b["mapState"])("dormitory",["roomStateList"])),{},{rightConfig:function(){return this.rightConfigPointer()}}),data:function(){return{title:"",queryTimeCouldChooseHistory:!1}},components:{timeRange:D,colorStateList:F},created:function(){Object.assign(this,this.rightConfig)},methods:{doQuery:function(){s["a"].emit(R.queryRoomList)}}},N=q,A=Object(f["a"])(N,v,g,!1,null,null,null);A.options.__file="pc/dormitory/room/guestsTopTool.vue";var V=A.exports,B=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[t._v(t._s(t.title))]),o("color-state-list",{attrs:{"room-state-list":t.roomStateList}}),o("inline-select-box")],1),t.team?o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[t._v("当前团体：")]),o("span",[t._v(t._s(t.team.teamName))]),o("span",{staticClass:"time"},[t._v(t._s(t.team.sDate))]),t._v("至 "),o("span",{staticClass:"time"},[t._v(t._s(t.team.eDate))])])]):t._e()])},P=[];B._withStripped=!0;var E=function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.showSelect?o("div",{staticClass:"select-box"},t._l(t.selectList,(function(e,i){return o("el-select",{key:i,attrs:{placeholder:e.placeholder},on:{change:function(e){return t.changeSelect(i)}},model:{value:e.value,callback:function(o){t.$set(e,"value",o)},expression:"comp.value"}},t._l(e.option,(function(t,e){return o("el-option",{key:t.buildingId,attrs:{value:t.buildingId,label:t.name}})})),1)})),1):t._e()},M=[];E._withStripped=!0;o(57),o(16);var G={name:"inlineSelectBox",inject:["rightConfigPointer"],computed:{rightConfig:function(){return this.rightConfigPointer()}},data:function(){return{selectList:[],showSelect:!1,currentSelect:null,firstTime:!0}},created:function(){var t=dsf.url.queryString("predis");Object.assign(this,this.rightConfig),"1"!==t?(this.showSelect=!0,this.selectList.forEach((function(t){t.value="",t.option=[]})),this.queryBuildList()):this.getFirstArea()},methods:{queryBuildList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,o=e+1;if(this.selectList[o]){var i={};this.currentSelect&&(i={buildingId:this.currentSelect.buildingId,type:+this.currentSelect.typeValue+1}),this.$http.get(this.apiBuildingList.url,i).done((function(e){var i,n,s=t.selectList.slice(o,o+1);1===o&&e.data.unshift({buildingId:t.selectList[o-1].value,name:"全部",typeText:"分区",typeValue:0}),2===o&&e.data.unshift({buildingId:t.selectList[o-1].value,name:"全部",typeText:"楼宇",typeValue:1}),s.option=e.data,t.selectList.splice(o,1,s),"全部"===(null===(i=t.currentSelect)||void 0===i?void 0:i.name)&&0===(null===(n=t.currentSelect)||void 0===n?void 0:n.typeValue)&&(t.selectList[2].option=[]),t.firstTime&&(t.firstTime=!1,t.selectList[0].value=e.data[0].buildingId,t.changeSelect(0))}))}},changeSelect:function(t){var e=this;this.currentSelect=this.selectList[t].option.find((function(o){return o.buildingId===e.selectList[t].value})),s["a"].emit(R.queryRoomList,this.currentSelect);for(var o=0;o<this.selectList.length;o++)if(!(o<=t)){var i=this.selectList.slice(o,o+1);i.option=[],i.value="",this.selectList.splice(o,1,i)}this.queryBuildList(t)},getFirstArea:function(){this.$http.get(this.apiBuildingList.url).done((function(t){var e=t.data[0];s["a"].emit(R.queryRoomList,e)}))}}},H=G,J=Object(f["a"])(H,E,M,!1,null,null,null);J.options.__file="pc/dormitory/room/inlineSelectBox.vue";var Q=J.exports,U={name:"resetGroupTopTool",inject:["rightConfigPointer"],props:{personList:{type:Array,default:function(){return[]}}},components:{colorStateList:F,inlineSelectBox:Q},data:function(){return{title:"",apiBuildingList:null,btnLoading:{checkOut:!1,cancel:!1,restore:!1,restoreAll:!1,auto:!1}}},computed:Object(y["a"])(Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},predis:function(){return dsf.url.queryString("predis")}},Object(b["mapState"])("dormitory",["roomStateList","activeTeamId"])),{},{team:function(){for(var t=null,e=0;e<this.personList.length;e++){var o=this.personList[e];if(o.teamId===this.activeTeamId){t=Object.assign({},o),t.sDate=o.sDate.replace(/:\d\d$/,""),t.eDate=o.eDate.replace(/:\d\d$/,"");break}}return t}}),created:function(){Object.assign(this,this.rightConfig)},methods:{preCheckOut:function(){s["a"].emit(R.chosenRoomCheckOut,this.btnLoading)},preCancel:function(){s["a"].emit(R.reserveRoomCancel,this.btnLoading)},preRestore:function(){s["a"].emit(R.restoreSelectRoom,this.btnLoading)},preRestoreAll:function(){s["a"].emit(R.restoreAllRoom,this.btnLoading)},preAuto:function(){s["a"].emit(R.autoCheckIn,this.btnLoading)}}},K=U,z=Object(f["a"])(K,B,P,!1,null,null,null);z.options.__file="pc/dormitory/room/resetGroupTopTool.vue";var W=z.exports,Y=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-tree",{ref:"tree",attrs:{data:t.treeList,props:t.leftProps,"icon-class":"el-icon-arrow-right","current-node-key":t.currentNodeKey,"node-key":t.mid,"default-expand-all":!1,"default-expanded-keys":t.expandedKeys,accordion:""},on:{"current-change":t.currentChange,"node-collapse":t.nodeCollapse}})},X=[];Y._withStripped=!0;var Z={name:"treeList",inject:["leftConfigPointer"],props:{treeList:{type:Array,default:function(){return[]}}},data:function(){return{apiTree:null,leftProps:null,level:null,defaultChosen:null,currentNodeKey:"",expandedKeys:[]}},computed:{leftConfig:function(){return this.leftConfigPointer()},mid:function(){return this.leftProps.id},mtype:function(){return this.leftProps.type},mchildren:function(){return this.leftProps.children}},watch:{treeList:function(){var t=this;this.$nextTick((function(){var e=dsf.url.queryString("buildingId");t.currentNodeKey=e||t.defaultChosen[t.mid]}))},currentNodeKey:function(t){this.$refs.tree.setCurrentKey(t);var e=this.$refs.tree.getCurrentNode();this.$store.commit("dormitory/currentFloor",{buildingId:e[this.mid],type:e[this.mtype]})}},created:function(){Object.assign(this,this.leftConfig),this.queryTree()},mounted:function(){var t=this;s["a"].on(R.treeNextLevel,(function(e){var o,i=_.cloneDeep(t.treeList),n=function i(n){for(var s=0;s<n.length;s++){var r=n[s],a=r[t.mchildren];_.isArray(a)&&a.length>0&&(e.id===r[t.mid]&&(o=a),i(a))}};n(i),e.callback(o)})),s["a"].on(R.treeCurrent,(function(e){var o,i=_.cloneDeep(t.treeList),n=function i(n){for(var s=0;s<n.length;s++){var r=n[s],a=r[t.mchildren];e.id===r[t.mid]&&(o=r),_.isArray(a)&&a.length>0&&i(a)}};n(i),e.callback(o)}))},methods:{queryTree:function(){var t=this,e=function(e){var o,i=0,n=[],s=function e(s){for(var r=0;r<s.length;r++){var a=s[r];_.isArray(a[t.mchildren])&&a[t.mchildren].length>0?(i<t.level&&(i+=1,a.mlevel=i,n.push(a[t.mid])),i===t.level&&!o&&(o=a),e(a[t.mchildren])):(a.mlevel=i+1,a.isLeaf=!0,!o&&(o=a))}};return s(e),{expandArr:n,defaultChosen:o}};this.$http.get(this.apiTree.url).done((function(o){var i=o.data;if(_.isFunction(t.apiTree.callback)&&(i=t.apiTree.callback(i)),_.isNumber(t.level)&&t.level>0){var n=e(i);t.expandedKeys=n.expandArr,t.defaultChosen=n.defaultChosen}t.$emit("update:treeList",i)})).error((function(){dsf.layer.message("查询左侧房间列表异常",!1)}))},currentChange:function(t){this.$store.commit("dormitory/currentFloor",{buildingId:t[this.mid],type:t[this.mtype]})},nodeCollapse:function(t,e){1===e.level&&e.childNodes.forEach((function(t){t.expanded=!1}))}}},tt=Z,et=Object(f["a"])(tt,Y,X,!1,null,null,null);et.options.__file="pc/dormitory/room/treeList.vue";var ot=et.exports,it=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"floor-container"},[o("floor-box",{attrs:{"floor-list":t.floorList,"active-room-id":t.activeRoomId},on:{"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e},"click-room":t.clickRoom}}),o("guests-opt-dialog",{attrs:{visible:t.guestsVisible,room:t.currentRoom,info:t.roomStatusInfo,"tree-list":t.treeList},on:{"update:visible":function(e){t.guestsVisible=e},"close-dialog":t.onCloseDialog}})],1)},nt=[];it._withStripped=!0;var st=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{attrs:{visible:t.visible,width:"40%","before-close":t.beforeClose,modal:!1,"append-to-body":!0,"lock-scroll":!0,"custom-class":"dsf-dormitory-dialog"},on:{"update:visible":function(e){t.visible=e},close:t.guestsClose},scopedSlots:t._u([{key:"title",fn:function(){return[o("div",{staticClass:"plain-title"},[o("span",[t._v("房间："+t._s(t.info.roomName))]),o("span",[t._v("房间床位："+t._s(t.info.emptyBedNum))])])]},proxy:!0},{key:"footer",fn:function(){return[o("div",{staticClass:"dialog-footer"},[o("el-button",{on:{click:t.closeDialog}},[t._v("确 定")])],1)]},proxy:!0}])},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingOccupyInfo,expression:"loadingOccupyInfo"}],staticClass:"list-box"},t._l(t.list,(function(e,i){return o("div",{key:i,staticClass:"item"},[o("i",{staticClass:"ico-point"}),o("p",[t._v(t._s(e.timeStr))]),o("ul",[t._l(e.person,(function(e,i){return o("li",{key:e.relId},[o("p",[t._v(" "+t._s(e.typeStr)+"："+t._s(e.personName)+"[ "+t._s(e.sexText)+" ] ")]),o("p",[t._v(" "+t._s(e.phone)+" ")]),o("p",[1===e.type?[o("span",{on:{click:function(o){return t.renewal(e)}}},[t._v("续房")]),o("span",{on:{click:function(o){return t.checkOut(e)}}},[t._v("退房")]),o("span",{on:{click:function(o){return t.changeRoom(e)}}},[t._v("换房")])]:t._e(),0===e.type?[o("span",{on:{click:function(o){return t.checkIn(e)}}},[t._v("入住")])]:t._e(),2===e.type?[o("span",{on:{click:t.reserve}},[t._v("预定")]),o("span",{on:{click:t.checkIn}},[t._v("入住")])]:t._e()],2)])})),t._l(e.release,(function(i,n){return o("li",{key:n},[o("p",[t._v("未入住：")]),o("p"),0!==t.info.statusValue?o("p",[o("span",{on:{click:function(o){return t.reserve(e)}}},[t._v("预定")]),o("span",{on:{click:function(o){return t.checkIn(e)}}},[t._v("入住")])]):o("p",[o("span",{staticClass:"warning"},[t._v("当前房间不可排")])])])}))],2)])})),0)]),o("action-dialog",{attrs:{visible:t.checkInVisible,title:"入住"},on:{"update:visible":function(e){t.checkInVisible=e},save:t.checkInSave,"dialog-close":function(e){return t.closeFormDialog("checkInForm")}},scopedSlots:t._u([{key:"body",fn:function(){return[o("el-form",{ref:"checkInForm",attrs:{model:t.checkInForm,rules:t.formRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{model:{value:t.checkInForm.personName,callback:function(e){t.$set(t.checkInForm,"personName",e)},expression:"checkInForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{model:{value:t.checkInForm.idCard,callback:function(e){t.$set(t.checkInForm,"idCard",e)},expression:"checkInForm.idCard"}})],1),o("el-form-item",{attrs:{label:"联系方式",prop:"phone"}},[o("el-input",{model:{value:t.checkInForm.phone,callback:function(e){t.$set(t.checkInForm,"phone",e)},expression:"checkInForm.phone"}})],1),o("el-form-item",{attrs:{label:"入住时间"}},[o("div",{staticClass:"date-box"},[o("span",[t._v(t._s(t.checkInForm.sDate))]),o("span",{staticClass:"text-divider"},[t._v("至")]),o("span",[t._v(t._s(t.checkInForm.eDate))])])])],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:t.reserveVisible,title:"预定"},on:{"update:visible":function(e){t.reserveVisible=e},save:t.reserveSave,"dialog-close":function(e){return t.closeFormDialog("reserveForm")}},scopedSlots:t._u([{key:"body",fn:function(){return[o("el-form",{ref:"reserveForm",attrs:{model:t.reserveForm,rules:t.formRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{model:{value:t.reserveForm.personName,callback:function(e){t.$set(t.reserveForm,"personName",e)},expression:"reserveForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{model:{value:t.reserveForm.idCard,callback:function(e){t.$set(t.reserveForm,"idCard",e)},expression:"reserveForm.idCard"}})],1),o("el-form-item",{attrs:{label:"联系方式",prop:"phone"}},[o("el-input",{model:{value:t.reserveForm.phone,callback:function(e){t.$set(t.reserveForm,"phone",e)},expression:"reserveForm.phone"}})],1),o("el-form-item",{attrs:{label:"预定时间"}},[o("div",{staticClass:"date-box"},[o("span",[t._v(t._s(t.reserveForm.sDate))]),o("span",{staticClass:"text-divider"},[t._v("至")]),o("span",[t._v(t._s(t.reserveForm.eDate))])])])],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:t.renewalVisible,title:"续房"},on:{"update:visible":function(e){t.renewalVisible=e},save:t.renewalSave,"dialog-close":function(e){return t.closeFormDialog("renewalForm")}},scopedSlots:t._u([{key:"body",fn:function(){return[o("el-form",{ref:"renewalForm",attrs:{model:t.renewalForm,rules:t.formRules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{attrs:{readonly:!0},model:{value:t.renewalForm.personName,callback:function(e){t.$set(t.renewalForm,"personName",e)},expression:"renewalForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{attrs:{readonly:!0},model:{value:t.renewalForm.idCard,callback:function(e){t.$set(t.renewalForm,"idCard",e)},expression:"renewalForm.idCard"}})],1),o("el-form-item",{staticClass:"justify",attrs:{label:"原入住时间"}},[o("time-range",{attrs:{form:t.renewalForm,"readonly-arr":[!0,!0]}})],1),o("el-form-item",{staticClass:"justify",attrs:{label:"续房入住时间",prop:"eDate"}},[o("time-range",{attrs:{form:t.newTimeForm,"readonly-arr":[!0,!1]}})],1)],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:t.changeRoomVisible,title:"换房",width:"80%","show-close":!1,top:"8vh"},on:{"update:visible":function(e){t.changeRoomVisible=e},save:t.changeRoomSave},scopedSlots:t._u([{key:"topTool",fn:function(){return[o("el-form",{attrs:{inline:!0}},[o("el-form-item",{attrs:{label:t.inlineForm[0].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.changeSelect(0)}},model:{value:t.inlineForm[0].value,callback:function(e){t.$set(t.inlineForm[0],"value",e)},expression:"inlineForm[0].value"}},t._l(t.treeList,(function(e,i){return o("el-option",{key:e[t.mid],attrs:{value:e[t.mid],label:e[t.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:t.inlineForm[1].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.changeSelect(1)}},model:{value:t.inlineForm[1].value,callback:function(e){t.$set(t.inlineForm[1],"value",e)},expression:"inlineForm[1].value"}},t._l(t.selectList1,(function(e,i){return o("el-option",{key:e[t.mid],attrs:{value:e[t.mid],label:e[t.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:t.inlineForm[2].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.changeSelect(2)}},model:{value:t.inlineForm[2].value,callback:function(e){t.$set(t.inlineForm[2],"value",e)},expression:"inlineForm[2].value"}},t._l(t.selectList2,(function(e,i){return o("el-option",{key:e[t.mid],attrs:{value:e[t.mid],label:e[t.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:"房间"}},[o("el-input",{model:{value:t.queryRoomName,callback:function(e){t.queryRoomName=e},expression:"queryRoomName"}})],1),o("el-form-item",[o("dsf-button",{on:{click:t.reloadQuery}},[t._v("重 置")]),o("dsf-button",{attrs:{icon:"sousuo"},on:{click:t.queryRoomList}})],1)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"time-item"},[o("label",[t._v("时间")]),o("time-range",{attrs:{form:t.newTimeForm}})],1)]},proxy:!0},{key:"floorBox",fn:function(){return[o("floor-box",{attrs:{"floor-list":t.floorList,"active-room-id":t.activeRoomId},on:{"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e}}})]},proxy:!0}])})],1)},rt=[];st._withStripped=!0;o(17),o(266);var at=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{visible:t.visible,width:t.width,"before-close":t.closeDialog,"append-to-body":!0,"lock-scroll":!0,"custom-class":"dsf-dormitory-dialog action-dialog","show-close":t.showClose,top:t.top},on:{"update:visible":function(e){t.visible=e}},scopedSlots:t._u([{key:"title",fn:function(){return[o("div",{staticClass:"bg-title"},[o("span",[t._v(t._s(t.title))]),o("div",{staticClass:"top-tool"},[t._t("topTool")],2)])]},proxy:!0},t.noFooter?null:{key:"footer",fn:function(){return[o("div",{staticClass:"action-footer"},[o("dsf-button",{on:{click:t.closeDialog}},[t._v("关 闭")]),o("dsf-button",{attrs:{loading:t.btnLoading.save},on:{click:t.save}},[t._v("保 存")])],1)]},proxy:!0}],null,!0)},[o("div",{staticClass:"custom-body"},[t._t("body")],2),t._t("inner"),o("div",{staticClass:"floor-container"},[t._t("floorBox")],2)],2)},lt=[];at._withStripped=!0;var ct={name:"actionDialog",props:{title:{type:String,required:!0},visible:{type:Boolean,default:!1,required:!0},width:{type:String,default:"40%"},showClose:{type:Boolean,default:!0},top:{type:String,default:"15vh"},noFooter:{type:Boolean,default:!1}},data:function(){return{btnLoading:{save:!1}}},methods:{closeDialog:function(){this.$emit("dialog-close"),this.$emit("update:visible",!1)},save:function(){this.$emit("save",this.btnLoading)}}},ut=ct,mt=Object(f["a"])(ut,at,lt,!1,null,null,null);mt.options.__file="pc/dormitory/dialog/actionDialog.vue";var dt=mt.exports,ft=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",t._l(t.floorList,(function(e,i){return o("div",{key:i,staticClass:"floor-box"},[o("div",{staticClass:"floor-title"},[t.multipleChoose?o("div",{staticClass:"check-box",on:{click:function(o){return o.stopPropagation(),t.checkAll(e)}}},[o("i",{staticClass:"iconfont",class:t.pCheckCss(e)}),o("span",[t._v("全选")])]):t._e(),o("span",[t._v(t._s(e.buildingText)+" / "+t._s(e.title))]),o("span",[t._v("（")]),o("span",{staticClass:"it"},[t._v("单间："+t._s(e.single))]),o("span",{staticClass:"it"},[t._v("标间："+t._s(e.standard))]),o("span",{staticClass:"it"},[t._v("套房："+t._s(e.suite))]),o("span",{staticClass:"it"},[t._v("多人间："+t._s(e.mul))]),o("span",[t._v("）")])]),o("div",{staticClass:"room-container",on:{click:t.emptyPlace}},[t._l(e[t.mchildren],(function(e,i){return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.judgeLoading(e[t.mroomId]),expression:"judgeLoading(room[mroomId])"}],key:i,staticClass:"room",class:t.roomCss(e),style:t.roomSty(e),attrs:{"data-id":e[t.mroomId]},on:{click:function(o){return o.stopPropagation(),t.clickRoom(e)}}},[t.roomCheckbox?o("div",{staticClass:"check-box",on:{click:function(o){return o.stopPropagation(),t.checkRoom(e)}}},[o("i",{staticClass:"iconfont",class:t.checkCss(e)})]):t._e(),o("div",{staticClass:"num",style:t.numSty(e)},[t._v(t._s(e[t.mroomNum]))]),o("div",{staticClass:"inner"},[o("p",[t._v(t._s(e.purposeText))]),o("p",[o("i",{directives:[{name:"show",rawName:"v-show",value:t.isAllocatedRoom(e.reserveId),expression:"isAllocatedRoom(room.reserveId)"}],staticClass:"iconfont icon-dui1"}),t._v(t._s(e.roomText))]),e.sexValue?1===parseInt(e.sexValue)?o("p",[t._v("女性")]):0===parseInt(e.sexValue)?o("p",[t._v("男性")]):t._e():o("p",[t._v("不限")])])])})),t._l(t.appendOcc,(function(t){return o("div",{key:i+"_"+t,staticClass:"occ"})}))],2)])})),0)},ht=[];ft._withStripped=!0;o(193),o(241),o(861),o(65);var pt={inject:["rightConfigPointer"],name:"floorBox",props:{floorList:{type:Array,default:function(){return[]}},chosenRoomId:{type:Array,default:function(){return[]}},multipleChoose:{type:Boolean,default:!1},loadingRoomId:{type:Array,default:function(){return[]}},activeRoomId:{type:String,default:""}},data:function(){return{apiRoomStatus:null,roomCheckbox:!0,appendOcc:[]}},computed:{rightConfig:function(){return this.rightConfigPointer()},stateList:function(){for(var t={},e=0;e<this.rightConfig.roomStateList.length;e++){var o=this.rightConfig.roomStateList[e];t[o.val]=o}return t},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias}},watch:{floorList:function(t){var e=this;this.stateRoomObj(t),this.$nextTick((function(){e.resize()}))},loadingRoomId:function(){var t=_.difference(this.chosenRoomId,this.loadingRoomId);this.$emit("update:chosenRoomId",t)},chosenRoomId:function(t){this.$store.commit("dormitory/chosenRoomId",t)}},created:function(){Object.assign(this,this.rightConfig)},methods:{isAllocatedRoom:function(t){var e=this.$route.query.opt;return"allocation"===e&&t===this.$route.query.reserveId},judgeLoading:function(t){return this.loadingRoomId.includes(t)},roomCss:function(t){return{chosen:this.chosenRoomId.includes(t[this.mroomId]),active:this.activeRoomId===t[this.mroomId]}},pCheckCss:function(t){for(var e=0,o=0;o<t[this.mchildren].length;o++)for(var i=t[this.mchildren][o],n=i[this.mroomId],s=0;s<this.chosenRoomId.length;s++){var r=this.chosenRoomId[s];if(n===r){e+=1;break}}return t.isAllCheck=e===t[this.mchildren].length,t.isAllCheck?"icon-kongjianyixuan":"icon-kongjianweixuan"},checkCss:function(t){return this.chosenRoomId.includes(t[this.mroomId])?"icon-kongjianyixuan":"icon-kongjianweixuan"},roomSty:function(t){var e,o,i,n,s=(null===(e=this.stateList[t.statusValue])||void 0===e?void 0:e.color)||"#000000",r=this.chosenRoomId.includes(t[this.mroomId])||this.activeRoomId===t[this.mroomId];return n=r?"4px solid "+s:"none",{background:(null===(o=this.stateList[t.statusValue])||void 0===o?void 0:o.bgColor)||"#555555",color:(null===(i=this.stateList[t.statusValue])||void 0===i?void 0:i.color)||"#000000",border:n}},numSty:function(t){var e;return{background:(null===(e=this.stateList[t.statusValue])||void 0===e?void 0:e.color)||"#000000"}},checkAll:function(t){var e=this,o=this.chosenRoomId.slice(0),i={},n=[];if(t.isAllCheck)for(var s in o.forEach((function(t){i[t]=t})),t[this.mchildren].forEach((function(t){i[t[e.mroomId]]&&(i[t[e.mroomId]]=!1)})),i)i[s]&&n.push(s);else{var r=t[this.mchildren].map((function(t){return t[e.mroomId]}));o.concat(r).forEach((function(t){i[t]=t})),n=Object.getOwnPropertyNames(i)}this.$emit("update:chosenRoomId",n)},clickRoom:function(t){this.loadingRoomId.includes(t[this.mroomId])||(this.$emit("update:activeRoomId",t[this.mroomId]),this.$emit("click-room",t))},resize:function(){var t=$(".room-container").width(),e=$(".room").width()+30,o=_.floor(t/e);if(o!==this.appendOcc.length){for(var i=[],n=0;n<o;n++)i.push(n);this.appendOcc=i}},emptyPlace:function(){this.$emit("update:activeRoomId","")},stateRoomObj:function(t){for(var e={},o=this.mroomId,i=this.mchildren,n=0;n<t.length;n++)for(var s=t[n],r=0;r<s[i].length;r++){var a=s[i][r];e[a[o]]=a}this.$store.commit("dormitory/roomObj",e)},checkRoom:function(t){var e=this;if(!this.loadingRoomId.includes(t[this.mroomId]))if(this.multipleChoose){var o=this.chosenRoomId.findIndex((function(o){return o===t[e.mroomId]}));-1===o?this.chosenRoomId.push(t[this.mroomId]):this.chosenRoomId.splice(o,1)}else this.$emit("update:chosenRoomId",[t[this.mroomId]])}},mounted:function(){var t=this;this.$nextTick((function(){window.addEventListener("resize",_.debounce((function(){t.resize()}),100))}))}},vt=pt,gt=Object(f["a"])(vt,ft,ht,!1,null,null,null);gt.options.__file="pc/dormitory/room/floorBox.vue";var yt=gt.exports,bt={name:"guestsOptDialog",inject:["leftConfigPointer","rightConfigPointer"],props:{info:{type:Object,default:function(){return{roomName:"",emptyBedNum:"",roomId:"",sDate:"",eDate:"",statusValue:null}}},visible:{type:Boolean,default:!1,required:!0},room:{type:Object},treeList:{type:Array,default:function(){return[]}}},components:{actionDialog:dt,floorBox:yt,timeRange:D},data:function(){var t=function(t,e,o){if(!e)return o(new Error("请输入手机号码"));var i=/^1[3-9]\d{9}$/.test(e);if(!i)return o(new Error("手机号码格式不正确"));o()};return{apiRoomStatus:null,apiRoomOccupyInfo:null,apiCheckIn:null,apiCheckOut:null,apiRenewal:null,apiReserve:null,apiChangeRoom:null,checkInVisible:!1,checkInForm:{},reserveVisible:!1,reserveForm:{},renewalVisible:!1,renewalForm:{},formRules:{personName:[{required:!0,message:"请输入姓名"}],idCard:[{required:!0,message:"请输入身份证"}],phone:[{validator:t,trigger:["blur","change"]},{required:!0}]},newTimeForm:{},changeRoomVisible:!1,queryInfo:{},list:[],isDataChanged:!1,selectList1:[],selectList2:[],inlineForm:[],originInlineForm:[],queryRoomName:"",currentSelectFloor:null,floorList:[],activeRoomId:"",loadingOccupyInfo:!0}},computed:Object(y["a"])(Object(y["a"])({},Object(b["mapGetters"])("dormitory",["roomStateDict"])),{},{leftConfig:function(){return this.leftConfigPointer()},rightConfig:function(){return this.rightConfigPointer()},mid:function(){return this.leftConfig.leftProps.id},mlabel:function(){return this.leftConfig.leftProps.label},mtype:function(){return this.leftConfig.leftProps.type},mroomId:function(){return this.apiRoomStatus.roomIdAlias}}),watch:{visible:function(t){t&&this.queryRoomOccupyInfo()}},created:function(){Object.assign(this,this.rightConfig),this.inlineForm=this.leftConfig.inlineForm,this.originInlineForm=_.cloneDeep(this.leftConfig.inlineForm)},methods:{changeSelect:function(t){var e=this,o=t;while(e["selectList"+(o+1)])e["selectList"+(o+1)]=[],e.inlineForm[o+1].value="",o++;var i={id:e.inlineForm[t].value,callback:function(t){e.currentSelectFloor=t,e.queryRoomList()}};s["a"].emit(R.treeCurrent,i);var n={id:e.inlineForm[t].value,callback:function(o){e["selectList"+(t+1)]=o}};s["a"].emit(R.treeNextLevel,n)},closeDialog:function(){this.$emit("update:visible",!1)},beforeClose:function(){this.closeDialog(),this.room.chosen=!1},renewal:function(t){var e=new Date(t.edate).getTime()+1e3,o=new Date(e);this.renewalForm={personName:t.personName,phone:t.phone,idCard:t.idCard,occupyId:t.occupyId,sDate:t.sdate,eDate:t.edate},this.newTimeForm={sDate:o,eDate:""},this.renewalVisible=!0},renewalSave:function(t){var e=this;this.$refs.renewalForm.validate().then((function(){if(e.newTimeForm.eDate){t.save=!0;var o={occupyId:e.renewalForm.occupyId,lastDate:e.renewalForm.eDate,curDate:e.newTimeForm.eDate,roomId:e.info.roomId};e.$http.post(e.apiRenewal.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.isDataChanged=!0,e.renewalVisible=!1,dsf.layer.message("续房成功"),e.queryRoomOccupyInfo()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("续房失败",!1)})).always((function(){setTimeout((function(){t.save=!1}),700)}))}else dsf.layer.message("请选择续房入住结束时间",!1)})).catch((function(t){}))},checkIn:function(t){var e,o;Rt(t)?dsf.layer.message("入住时间不能小于当前时间",!1):(this.checkInForm={personName:null===t||void 0===t?void 0:t.personName,idCard:null===t||void 0===t?void 0:t.idCard,phone:null===t||void 0===t?void 0:t.phone,sDate:null===t||void 0===t||null===(e=t.sdate)||void 0===e?void 0:e.replace(/:\d\d$/,""),eDate:null===t||void 0===t||null===(o=t.edate)||void 0===o?void 0:o.replace(/:\d\d$/,""),reserveId:null===t||void 0===t?void 0:t.relId,roomId:this.info.roomId},this.checkInVisible=!0)},checkInSave:function(t){var e=this;this.$refs.checkInForm.validate().then((function(){t.save=!0,e.$http.post(e.apiCheckIn.url,JSON.stringify(e.checkInForm),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.isDataChanged=!0,e.checkInVisible=!1,dsf.layer.message("入住成功"),e.queryRoomOccupyInfo()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("发生未知错误，入住失败",!1)})).always((function(){setTimeout((function(){t.save=!1}),700)}))})).catch((function(t){}))},checkOut:function(t){var e=this;dsf.layer.confirm({message:"您确定要退房吗？",type:"warning",customClass:"el-message-box-center"}).then((function(){var o={roomId:e.info.roomId,occupyId:t.relId};e.$http.post(e.apiCheckOut.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.isDataChanged=!0,dsf.layer.message("退房成功"),e.queryRoomOccupyInfo()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("退房失败",!1)}))})).catch((function(t){}))},reserve:function(t){var e,o;Rt(t)?dsf.layer.message("预定时间不能小于当前时间",!1):(this.reserveForm={personName:"",idCard:"",phone:"",sexValue:t.sexValue,sexText:t.sexText,sDate:null===t||void 0===t||null===(e=t.sdate)||void 0===e?void 0:e.replace(/:\d\d$/,""),eDate:null===t||void 0===t||null===(o=t.edate)||void 0===o?void 0:o.replace(/:\d\d$/,""),reserveId:null===t||void 0===t?void 0:t.relId,roomId:this.info.roomId},this.reserveVisible=!0)},reserveSave:function(t){var e=this;this.$refs.reserveForm.validate().then((function(){t.save=!0,e.$http.post(e.apiReserve.url,JSON.stringify(e.reserveForm),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.isDataChanged=!0,e.reserveVisible=!1,dsf.layer.message("预约成功"),e.queryRoomOccupyInfo()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("发生未知错误，预约失败",!1)})).always((function(){setTimeout((function(){t.save=!1}),700)}))})).catch((function(t){}))},reloadQuery:function(){this.inlineForm=_.cloneDeep(this.originInlineForm),this.selectList1=[],this.selectList2=[],this.queryRoomName="",this.inlineForm[0].value=this.treeList[0][this.mid],this.changeSelect(0)},changeRoom:function(t){var e=(new Date).Format("yyyy-MM-dd");this.newTimeForm={sDate:e+" 00:00:00",eDate:t.edate,occupyId:t.occupyId},this.floorList=[],this.activeRoomId="",this.changeRoomVisible=!0,this.inlineForm[0].value=this.treeList[0][this.mid],this.changeSelect(0)},queryRoomOccupyInfo:function(){var t=this;this.loadingOccupyInfo=!0;var e={roomId:this.info.roomId,sDate:this.info.sDate,eDate:this.info.eDate};this.$http.get(this.apiRoomOccupyInfo.url,e).done((function(e){var o=e.data;_.isFunction(t.apiRoomOccupyInfo.callback)&&(o=t.apiRoomOccupyInfo.callback(o)),t.list=o})).always((function(){t.loadingOccupyInfo=!1}))},guestsClose:function(){this.$emit("close-dialog",this.isDataChanged)},queryRoomList:function(){var t=this,e={buildingId:this.currentSelectFloor[this.mid],type:this.currentSelectFloor[this.mtype],sDate:this.newTimeForm.sDate,eDate:this.newTimeForm.eDate,name:this.queryRoomName};this.$http.get(this.apiRoomStatus.url,e).done((function(e){t.activeRoomId="",e.success?t.floorList=e.data.map((function(e){return e.roomDtos=e.roomDtos.filter((function(e){return e.statusValue===t.roomStateDict.normal||e.statusValue===t.roomStateDict.some})),e})):t.floorList=[]}))},changeRoomSave:function(t){var e=this;if(this.activeRoomId){t.save=!0;var o={occupyId:this.newTimeForm.occupyId,roomId:this.activeRoomId};this.$http.post(this.apiChangeRoom.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.isDataChanged=!0,e.changeRoomVisible=!1,dsf.layer.message("换房成功"),e.queryRoomOccupyInfo()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("换房失败",!1)})).always((function(){setTimeout((function(){t.save=!1}),700)}))}else dsf.layer.message("请先选择要换房的房间",!1)},closeFormDialog:function(t){this.$refs[t].clearValidate()}},mounted:function(){}};function Rt(t){if(!t)return!1;var e=(new Date).Format("yyyy-MM-dd hh:mm")+":00",o=t.edate.replace(/:\d\d$/g,"")+":00",i=new Date(e).getTime(),n=new Date(o).getTime();return i>n}var It=bt,_t=Object(f["a"])(It,st,rt,!1,null,null,null);_t.options.__file="pc/dormitory/dialog/guestsOptDialog.vue";var Ct=_t.exports,kt={name:"roomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},treeList:{type:Array}},data:function(){return{apiRoomStatus:null,originFloorList:[],guestsVisible:!1,currentRoom:null,roomStatusInfo:{},activeRoomId:""}},computed:Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(b["mapState"])("dormitory",["currentFloor","roomStateList"])),components:{guestsOptDialog:Ct,floorBox:yt},watch:{currentFloor:function(){this.queryRoomList()}},created:function(){Object.assign(this,this.rightConfig)},mounted:function(){var t=this;s["a"].on(R.queryRoomList,(function(){t.queryRoomList()}))},methods:{clickRoom:function(t){this.currentRoom=t,this.popGuests()},popGuests:function(){this.roomStatusInfo=Object(y["a"])({roomId:this.currentRoom[this.mroomId],roomName:this.currentRoom[this.mroomNum],emptyBedNum:this.currentRoom.beds,statusValue:this.currentRoom.statusValue},this.queryTime),this.guestsVisible=!0},queryRoomList:function(){var t=this,e=Object(y["a"])({},this.currentFloor);if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();e=a(e,o)}e=Object.assign({},e,this.queryTime),this.$http.get(this.apiRoomStatus.url,e).done((function(e){t.originFloorList=e.success?e.data:[],t.activeRoomId=""}))},onCloseDialog:function(t){this.chosenRoomId="",t&&this.queryRoomList()}}},Lt=kt,St=Object(f["a"])(Lt,it,nt,!1,null,null,null);St.options.__file="pc/dormitory/room/roomBox.vue";var Dt=St.exports,xt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[t._v(t._s(t.title))]),o("div",{staticClass:"sec-box"},[o("dsf-button",{attrs:{loading:t.btnLoading.checkOut},on:{click:t.preCheckOut}},[t._v("已选房间退房")]),"1"===t.predis?o("dsf-button",{attrs:{loading:t.btnLoading.cancel},on:{click:t.preCancel}},[t._v("预约房取消")]):t._e(),o("dsf-button",{attrs:{loading:t.btnLoading.restore},on:{click:t.preRestore}},[t._v("重置已选房间")]),o("dsf-button",{attrs:{loading:t.btnLoading.restoreAll},on:{click:t.preRestoreAll}},[t._v("重置全部")]),o("dsf-button",{attrs:{loading:t.btnLoading.auto},on:{click:t.preAuto}},[t._v("自动排房")])],1)]),o("div",{staticClass:"state-box"},[o("color-state-list",{attrs:{"room-state-list":t.roomStateList}}),o("inline-select-box")],1),t.team?o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[t._v("当前团体：")]),o("span",[t._v(t._s(t.team.teamName))]),o("span",{staticClass:"time"},[t._v(t._s(t.team.sDate))]),t._v("至 "),o("span",{staticClass:"time"},[t._v(t._s(t.team.eDate))])])]):t._e()])},Ot=[];xt._withStripped=!0;var wt={name:"groupTopTool",inject:["rightConfigPointer"],props:{personList:{type:Array,default:function(){return[]}}},components:{colorStateList:F,inlineSelectBox:Q},data:function(){return{title:"",apiBuildingList:null,btnLoading:{checkOut:!1,cancel:!1,restore:!1,restoreAll:!1,auto:!1}}},computed:Object(y["a"])(Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},predis:function(){return dsf.url.queryString("predis")}},Object(b["mapState"])("dormitory",["roomStateList","activeTeamId"])),{},{team:function(){for(var t=null,e=0;e<this.personList.length;e++){var o=this.personList[e];if(o.teamId===this.activeTeamId){t=Object.assign({},o),t.sDate=o.sDate.replace(/:\d\d$/,""),t.eDate=o.eDate.replace(/:\d\d$/,"");break}}return t}}),created:function(){Object.assign(this,this.rightConfig)},methods:{preCheckOut:function(){s["a"].emit(R.chosenRoomCheckOut,this.btnLoading)},preCancel:function(){s["a"].emit(R.reserveRoomCancel,this.btnLoading)},preRestore:function(){s["a"].emit(R.restoreSelectRoom,this.btnLoading)},preRestoreAll:function(){s["a"].emit(R.restoreAllRoom,this.btnLoading)},preAuto:function(){s["a"].emit(R.autoCheckIn,this.btnLoading)}}},Tt=wt,jt=Object(f["a"])(Tt,xt,Ot,!1,null,null,null);jt.options.__file="pc/dormitory/room/groupTopTool.vue";var Ft=jt.exports,$t=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"group-list-warp"},[o("el-collapse",{attrs:{value:t.activeTeamId,accordion:t.accordion},on:{change:t.changeCollapse}},t._l(t.personList,(function(e,i){return o("el-collapse-item",{key:e.teamId,attrs:{title:e.teamName,name:e.teamId}},[o("div",{staticClass:"group-person-box"},[o("ul",[t._l(e.boyList,(function(e,i){return o("li",{key:e.personId,attrs:{"data-id":e.personId,"data-name":e.personName}},[e.headImg?o("img",{attrs:{src:e.headImg,alt:"男性头像"}}):o("i",{staticClass:"icon-boy-head"}),o("span",[t._v(t._s(e.personName))])])})),e.boyList&&0!==e.boyList.length?t._e():o("div",[t._v("（已排完）")])],2),o("ul",[t._l(e.girlList,(function(e,i){return o("li",{key:e.personId,attrs:{"data-id":e.personId,"data-name":e.personName}},[e.headImg?o("img",{attrs:{src:e.headImg,alt:"女性头像"}}):o("i",{staticClass:"icon-girl-head"}),o("span",[t._v(t._s(e.personName))])])})),e.girlList&&0!==e.girlList.length?t._e():o("div",[t._v("（已排完）")])],2)])])})),1)],1)},qt=[];$t._withStripped=!0;var Nt={inject:["leftConfigPointer"],name:"groupList",props:{personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiGroupList:null,accordion:null}},computed:Object(y["a"])({leftConfig:function(){return this.leftConfigPointer()},sexRule:function(){return this.apiGroupList.sexRule}},Object(b["mapState"])("dormitory",["activeTeamId"])),watch:{personList:function(t){var e=this,o={};if(!t||0===t.length)return o;for(var i=0;i<t.length;i++){var n=t[i];if(n.person)for(var s=0;s<n.person.length;s++){var r=n.person[s];if(o[r.personId])return void dsf.layer.alert("团体人员列表，人员 personId 有重复的");o[r.personId]=r}}this.$emit("update:personObj",o),this.activeTeamId||this.$store.commit("dormitory/activeTeamId",t[0].teamId),this.$nextTick((function(){e.createInteraction()}))}},created:function(){Object.assign(this,this.leftConfig),this.queryList()},mounted:function(){var t=this;s["a"].on(R.refreshGroupList,(function(){t.queryList()}))},methods:{queryList:function(){var t=this,e={};if(_.isFunction(this.apiGroupList.query)){var o=this.apiGroupList.query();e=a(e,o)}this.$http.get(this.apiGroupList.url,e).done((function(e){var o=e.data;_.isFunction(t.apiGroupList.callback)&&(o=t.apiGroupList.callback(o));for(var i=0;i<o.length;i++){var n=o[i];if(n.boyList=[],n.girlList=[],_.isArray(n.person))for(var s=0;s<n.person.length;s++){var r=n.person[s];1!==r.occupy&&(r.sexValue===t.sexRule.male&&n.boyList.push(r),r.sexValue===t.sexRule.female&&n.girlList.push(r))}}t.$emit("update:personList",o)}))},changeCollapse:function(t){this.$store.commit("dormitory/activeTeamId",t),this.createInteraction()},createInteraction:function(){$(".group-person-box li").draggable({addClasses:!1,start:function(t){},helper:function(){var t=$(this).data("name"),e=$(this).data("id");return $('<div class="drag-item" data-id='.concat(e,">").concat(t,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(t,e){}})}}},At=Nt,Vt=Object(f["a"])(At,$t,qt,!1,null,null,null);Vt.options.__file="pc/dormitory/room/groupList.vue";var Bt=Vt.exports,Pt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"floor-container group"},[o("floor-box",{attrs:{"multiple-choose":!0,"floor-list":t.floorList,"chosen-room-id":t.chosenRoomId,"active-room-id":t.activeRoomId,"loading-room-id":t.loadingRoomId},on:{"update:chosenRoomId":function(e){t.chosenRoomId=e},"update:chosen-room-id":function(e){t.chosenRoomId=e},"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e},"click-room":t.clickRoom}}),o("action-dialog",{attrs:{title:"自动排房",visible:t.autoDialogVisible,top:"20px",width:"60%"},on:{"update:visible":function(e){t.autoDialogVisible=e},save:t.saveAuto},scopedSlots:t._u([{key:"body",fn:function(){return[o("el-form",{staticClass:"auto-checkin-form",attrs:{model:t.form,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"团体名称"}},[o("el-select",{attrs:{multiple:"",placeholder:"请选择团体"},on:{change:t.changeTeamSelect,"visible-change":t.selectExpand},model:{value:t.form.reserveIds,callback:function(e){t.$set(t.form,"reserveIds",e)},expression:"form.reserveIds"}},t._l(t.personList,(function(t){return o("el-option",{key:t.reserveId,attrs:{label:t.teamName,value:t.reserveId}})})),1)],1),o("el-form-item",{attrs:{label:"楼宇"}},[o("el-checkbox-group",{on:{change:t.changeBuildCheckGroup},model:{value:t.form.buildingIds,callback:function(e){t.$set(t.form,"buildingIds",e)},expression:"form.buildingIds"}},t._l(t.buildList,(function(e,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:e.buildingId}},[t._v(t._s(e.name))])],1)})),0)],1),o("el-form-item",{attrs:{label:"楼层"}},[t.rowList.length>0?o("div",{staticClass:"floor-checkbox-warp"},t._l(t.rowList,(function(e,i){return o("div",{key:i},[o("label",{staticClass:"floor-name"},[o("span",[t._v(t._s(e.floorName))])]),o("el-checkbox-group",{model:{value:t.form.floorIds,callback:function(e){t.$set(t.form,"floorIds",e)},expression:"form.floorIds"}},t._l(e.floorItems,(function(e,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:e.buildingId}},[t._v(t._s(e.name))])],1)})),0)],1)})),0):o("div",{staticClass:"no-check-group"},[t._v("请先选择楼宇")])]),o("el-form-item",{attrs:{label:"房间类型"}},[o("el-checkbox-group",{model:{value:t.form.types,callback:function(e){t.$set(t.form,"types",e)},expression:"form.types"}},t._l(t.roomTypesByAuto,(function(e,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:e.val}},[t._v(t._s(e.name))])],1)})),0)],1),o("el-form-item",{attrs:{label:"入住规则"}},[o("el-checkbox-group",{attrs:{value:t.form.rules}},t._l(t.rulesByAuto,(function(e,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:e.val,disabled:e.disabled,checked:e.default},on:{change:function(o){return t.changeRuleCheck(o,e)}}},[t._v(" "+t._s(e.name)+" ")])],1)})),0)],1),o("el-form-item",{attrs:{label:"入住时间"}},[t.timeForm.sDate?o("div",{staticClass:"date-box"},[o("span",[t._v(t._s(t.timeForm.sDate))]),o("span",{staticClass:"text-divider"},[t._v("至")]),o("span",[t._v(t._s(t.timeForm.eDate))])]):o("span",[t._v(" -- ")])])],1)]},proxy:!0}])}),o("room-history-dialog",{attrs:{visible:t.roomStatusVisible,info:t.roomStatusInfo},on:{"update:visible":function(e){t.roomStatusVisible=e},"dialog-close":function(e){t.activeRoomId=""}}})],1)},Et=[];Pt._withStripped=!0;o(44),o(257),o(133);var Mt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{visible:t.visible,width:"40%","custom-class":"dsf-dormitory-dialog","before-close":t.closeDialog,modal:!1},on:{"update:visible":function(e){t.visible=e},opened:t.queryRoomOccupyInfo},scopedSlots:t._u([{key:"title",fn:function(){return[o("div",{staticClass:"plain-title"},[o("span",[t._v("房间："+t._s(t.info.roomName))]),o("span",[t._v("房间床位："+t._s(t.info.emptyBedNum))])])]},proxy:!0},{key:"footer",fn:function(){return[o("div",{staticClass:"dialog-footer"},[o("el-button",{on:{click:t.closeDialog}},[t._v("确 定")])],1)]},proxy:!0}])},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingOccupyInfo,expression:"loadingOccupyInfo"}],staticClass:"list-box"},t._l(t.list,(function(e,i){return o("div",{key:i,staticClass:"item"},[o("i",{staticClass:"ico-point"}),o("p",[t._v(t._s(e.timeStr))]),o("ul",[t._l(e.person,(function(e,i){return o("li",{key:e.relId},[o("p",[t._v(" "+t._s(e.typeStr)+"："+t._s(e.personName)+"[ "+t._s(e.sexText)+" ] ")]),o("p",[t._v(" "+t._s(e.phone)+" ")]),o("p",{staticStyle:{"text-align":"right","padding-right":"10px"}},["resetGroup"===t.opt?o("span",{on:{click:function(o){return t.resetGroup(e)}}},[t._v("重置")]):t._e(),o("span",{on:{click:function(o){return t.go2Info(e)}}},[t._v("详情")])])])})),t._l(e.release,(function(e,i){return o("li",{key:i},[o("p",[t._v("未入住：")])])}))],2)])})),0)])},Gt=[];Mt._withStripped=!0;var Ht={name:"roomHistoryDialog",inject:["rightConfigPointer"],props:{info:{type:Object,default:function(){return{roomName:"",emptyBedNum:"",roomId:"",sDate:"",eDate:""}}},visible:{type:Boolean,default:!1,required:!0}},computed:{rightConfig:function(){return this.rightConfigPointer()},opt:function(){return this.$route.query.opt}},data:function(){return{apiRoomOccupyInfo:null,roomStatusDetailClick:null,apiResetPerson:null,loadingOccupyInfo:!1,list:[]}},created:function(){Object.assign(this,this.rightConfig)},methods:{closeDialog:function(){this.$emit("dialog-close"),this.$emit("update:visible",!1)},queryRoomOccupyInfo:function(){var t=this;this.loadingOccupyInfo=!0;var e={roomId:this.info.roomId,sDate:this.info.sDate,eDate:this.info.eDate};this.$http.get(this.apiRoomOccupyInfo.url,e).done((function(e){var o=e.data;_.isFunction(t.apiRoomOccupyInfo.callback)&&(o=t.apiRoomOccupyInfo.callback(o)),t.list=o})).always((function(){t.loadingOccupyInfo=!1}))},go2Info:function(t){_.isFunction(this.roomStatusDetailClick)&&this.roomStatusDetailClick.call(this,t)},resetGroup:function(t){var e=this,o={personId:t.personId};this.$http.post(this.apiResetPerson.url,o).done((function(t){t.success?(e.queryRoomOccupyInfo(),dsf.layer.message("人员重置成功")):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("人员重置失败",!1)}))}}},Jt=Ht,Qt=Object(f["a"])(Jt,Mt,Gt,!1,null,null,null);Qt.options.__file="pc/dormitory/dialog/roomHistoryDialog.vue";var Ut=Qt.exports,Kt={name:"groupRoomBox",inject:["rightConfigPointer"],components:{roomHistoryDialog:Ut,floorBox:yt,actionDialog:dt},props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiRoomStatus:null,dropAble:null,apiTeamCheckin:null,apiTeamCheckOut:null,apiRestoreSelectRoom:null,apiBuildingList:null,apiAutoCheckIn:null,apiReserveCancel:null,roomTypesByAuto:null,rulesByAuto:null,originFloorList:[],chosenRoomId:[],activeRoomId:"",currentFloor:null,loadingRoomId:[],autoDialogVisible:!1,form:{},buildList:[],rowList:[],timeForm:{},roomStatusVisible:!1,roomStatusInfo:{},firstQueryRoomList:!0}},computed:Object(y["a"])(Object(y["a"])({},Object(b["mapState"])("dormitory",["activeTeamId","roomStateList"])),{},{rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},roomObj:function(){var t={},e=this.mid,o=this.mchildren;if(!this.floorList||0===this.floorList.length)return t;for(var i=0;i<this.floorList.length;i++)for(var n=this.floorList[i],s=0;s<n[o].length;s++){var r=n[o][s];if(t[r[e]])return void dsf.layer.alert("房间roomId有重复的");t[r[e]]=r}return t},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}}),watch:{floorList:function(){var t=this;this.$nextTick((function(){t.createInteraction()}))},activeTeamId:function(){this.queryRoomList()},autoDialogVisible:function(t){t&&$(".el-select-dropdown__list").children("li.hover").removeClass("hover")},roomStateList:function(){this.chosenRoomId=[]}},created:function(){Object.assign(this,this.rightConfig);var t=(new Date).Format("yyyy-MM-dd"),e=dsf.url.queryString("sDate"),o=dsf.url.queryString("eDate"),i=e?decodeURIComponent(e):t+" 00:00:00",n=o?decodeURIComponent(o):t+" 23:59:59";this.startTime=i,this.endTime=n},mounted:function(){var t=this;this.GetAllBuildList(),s["a"].on(R.queryRoomList,(function(e){t.currentFloor=e,t.firstQueryRoomList||t.queryRoomList()})),s["a"].on(R.chosenRoomCheckOut,(function(e){t.chosenRoomCheckOut(e)})),s["a"].on(R.reserveRoomCancel,(function(e){t.reserveRoomCancel(e)})),s["a"].on(R.restoreSelectRoom,(function(e){t.restoreSelectRoom(e)})),s["a"].on(R.restoreAllRoom,(function(e){t.restoreAllRoom(e)})),s["a"].on(R.autoCheckIn,(function(){if(_.isArray(t.floorList)&&0!==t.floorList.length){var e,o;t.rowList=[],_.isArray(t.personList)?(o=t.activeTeamId?zt.call(t):t.personList[0],e=[o.reserveId],t.timeForm={sDate:o.sDate.replace(/:\d\d$/,""),eDate:o.eDate.replace(/:\d\d$/,"")}):(e=[],t.timeForm={sDate:"",eDate:""});var i=[];t.rulesByAuto.forEach((function(t){"checked"===t.default&&i.push(t.val)})),t.form={reserveIds:e,buildingIds:[],floorIds:[],types:[],rules:i},t.autoDialogVisible=!0}else dsf.layer.message("该团体未分配房源，无法自动排房",!1)}))},methods:{reserveRoomCancel:function(t){var e=this,o=zt.call(this);if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;if(o){t.cancel=!0,this.loadingRoomId=this.chosenRoomId;var i={roomIds:this.chosenRoomId,reserveId:o.reserveId};this.$http.post(this.apiReserveCancel.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("取消预约房成功"),e.queryRoomList(),s["a"].emit(R.refreshGroupList)):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("取消预约房失败",!1)})).always((function(){t.cancel=!1,e.loadingRoomId=[]}))}else dsf.layer.message("没有选择指定的团体",!1)},selectExpand:function(t){$(".el-select-dropdown__list").children("li.hover").removeClass("hover")},clickRoom:function(t){this.roomStatusInfo=Object(y["a"])({roomId:t[this.mid],roomName:t[this.mnum],emptyBedNum:t.beds},this.queryTime);var e=zt.call(this);e&&(this.roomStatusInfo.sDate=e.sDate,this.roomStatusInfo.eDate=e.eDate),this.roomStatusVisible=!0},queryRoomList:function(){var t,e,o=this,i=zt.call(this),n={buildingId:null===(t=this.currentFloor)||void 0===t?void 0:t.buildingId,type:null===(e=this.currentFloor)||void 0===e?void 0:e.typeValue,sDate:i?i.sDate:this.startTime,eDate:i?i.eDate:this.endTime};if(_.isFunction(this.apiRoomStatus.query)){var s=this.apiRoomStatus.query();n=a(n,s)}this.$http.get(this.apiRoomStatus.url,n).done((function(t){o.originFloorList=t.success?t.data:[],o.chosenRoomId=[]})).always((function(){o.firstQueryRoomList=!1}))},drop2room:function(t,e){var o=this,i=e[this.mid];this.loadingRoomId.push(i);var n={personId:t.personId,personName:t.personName,sexValue:t.sexValue,sexText:t.sexText,reserveId:t.reserveId,roomId:i};this.$http.post(this.apiTeamCheckin.url,JSON.stringify(n),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("入住成功"),s["a"].emit(R.refreshGroupList),o.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("入住失败",!1)})).always((function(){var t=o.loadingRoomId.findIndex((function(t){return t===i}));o.loadingRoomId.splice(t,1)}))},createInteraction:function(){var t=this;$(".floor-container .room").droppable({addClasses:!1,tolerance:"pointer",over:function(t,e){var o=$(t.target);o.css({"box-shadow":"0 0 5px inset #409eff"})},drop:function(e,o){var i=$(e.target);i.css("box-shadow","none");var n=i.data("id"),s=o.helper.data("id");if(!t.loadingRoomId.includes(n)){var r=t.roomObj[n],a=t.personObj[s],l=!1;if(_.isFunction(t.dropAble)&&(l=t.dropAble(a,r)),l){var c={type:"warning"};dsf.layer.confirm(Object.assign(l,c))}else t.drop2room(a,r)}},out:function(t,e){var o=$(t.target);o.css("box-shadow","none")}})},chosenRoomCheckOut:function(t){var e=this;if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;var o=zt.call(this);if(o){t.checkOut=!0,this.loadingRoomId=this.chosenRoomId;var i={reserveId:o.reserveId,roomIds:this.chosenRoomId};this.$http.post(this.apiTeamCheckOut.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("退房成功"),e.queryRoomList(),s["a"].emit(R.refreshGroupList)):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("退房失败",!1)})).always((function(){t.checkOut=!1,e.loadingRoomId=[]}))}else dsf.layer.message("没有选择指定的团体",!1)},restoreSelectRoom:function(t){var e=this;if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;var o=zt.call(this);if(o){var i="";this.chosenRoomId.forEach((function(t){var o=e["roomObj"][t][e.mnum];i+="<span>".concat(o,"号房间</span>")}));var n=function(){e.loadingRoomId=e.chosenRoomId,t.restore=!0;var i={reserveId:o.reserveId,roomIds:e.chosenRoomId};e.$http.post(e.apiRestoreSelectRoom.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("重置已选房间成功"),e.queryRoomList(),s["a"].emit(R.refreshGroupList)):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("重置已选房间失败",!1)})).always((function(){t.restore=!1,e.loadingRoomId=[]}))};dsf.layer.confirm({message:"<p>您即将重置<b>".concat(o.teamName,'</b>的：</p><p class="room-msg">').concat(i,"</p><p>是否继续？</p>"),customClass:"dormitory-restore-select-room-confirm"}).then((function(){n()})).catch((function(){}))}else dsf.layer.message("没有选择指定的团体",!1)},restoreAllRoom:function(t){var e=this,o=zt.call(this);o?dsf.layer.confirm({message:"<p>当前操作会重置<b>".concat(o.teamName,"</b>的所有房间</p><p>是否继续？</p>")}).then((function(){t.restoreAll=!0;var i={reserveId:o.reserveId};e.$http.post(e.apiRestoreSelectRoom.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("重置全部房间成功"),e.queryRoomList(),s["a"].emit(R.refreshGroupList)):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("重置全部房间失败",!1)})).always((function(){t.restoreAll=!1}))})).catch((function(){})):dsf.layer.message("没有选择指定的团体",!1)},GetAllBuildList:function(){var t=this;this.$http.get(this.apiBuildingList.url,{type:1}).done((function(e){t.buildList=e.data}))},changeBuildCheckGroup:function(t){var e=this,o=function(t,o){e.form.floorIds=e.form.floorIds.filter((function(t){return!!o[t]})),e.rowList=t};Wt.call(this,t,o)},saveAuto:function(t){var e=this;if(this.form.buildingIds&&0!==this.form.buildingIds.length)if(this.form.reserveIds&&0!==this.form.reserveIds.length){if(Yt.call(this))if(Xt.call(this)){t.save=!0;var o=[];this.personList.forEach((function(t){e.form.reserveIds.includes(t.reserveId)&&o.push(t.teamName)}));var i=Object(y["a"])(Object(y["a"])(Object(y["a"])({},this.form),this.timeForm),{},{teamNames:o});this.$http.post(this.apiAutoCheckIn.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.autoDialogVisible=!1,dsf.layer.message("自动排房成功"),e.queryRoomList(),s["a"].emit(R.refreshGroupList)):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("自动排房失败",!1)})).always((function(){t.save=!1}))}else dsf.layer.message("选择的团体是空的，没有可以排房的人员",!1)}else dsf.layer.message("自动排房至少需要选择一个团体",!1);else dsf.layer.message("楼宇不能为空",!1)},changeRuleCheck:function(t,e){if(t){if(!e.atomicity)return void this.form.rules.push(e.val);var o=[];this.rulesByAuto.forEach((function(t){t.atomicity===e.atomicity&&o.push(t.val)})),this.form.rules=this.form.rules.filter((function(t){return!o.includes(t)})),this.form.rules.push(e.val)}else this.form.rules=this.form.rules.filter((function(t){return t!==e.val}))},changeTeamSelect:function(t){var e=Yt.call(this);if(e){if(0===t.length&&(this.timeForm={sDate:"",eDate:""}),1===t.length){var o=this.personList.find((function(e){return e.reserveId===t[0]}));this.timeForm={sDate:o.sDate,eDate:o.eDate}}}else this.form.reserveIds.pop()}}};function zt(){var t=this;return!!this.activeTeamId&&this.personList.find((function(e){return e.teamId===t.activeTeamId}))}function Wt(t,e){for(var o=this,i=[],n=function(e){var n=new Promise((function(i){o.$http.get(o.apiBuildingList.url,{buildingId:t[e],type:2}).done((function(n){var s=o.buildList.find((function(o){return o.buildingId===t[e]}));i({floorName:s.name,floorItems:n.data})}))}));i.push(n)},s=0;s<t.length;s++)n(s);Promise.all(i).then((function(t){for(var o={},i=0;i<t.length;i++)for(var n=t[i].floorItems,s=0;s<n.length;s++){var r=n[s];if(o[r.buildingId])return dsf.error("楼层buildingId 有重复的"),!1;o[r.buildingId]=r}e(t,o)}))}function Yt(){var t=this;if(!this.form.reserveIds||0===this.form.reserveIds.length)return!0;var e,o=this.personList.filter((function(e){return t.form.reserveIds.includes(e.reserveId)})),i=o[0].sDate.replace(/:\d\d$/,""),n=o[0].eDate.replace(/:\d\d$/,""),s=o.some((function(t){e=t;var o=t.sDate.replace(/:\d\d$/,""),s=t.eDate.replace(/:\d\d$/,"");return o!==i||s!==n}));return!s||(dsf.layer.message("".concat(e.teamName," 与 ").concat(o[0].teamName," 的入住时间不符合"),!1),!1)}function Xt(){var t=this;return this.personList.some((function(e){var o;if(t.form.reserveIds.includes(e.reserveId)&&(null===e||void 0===e||null===(o=e.person)||void 0===o?void 0:o.length)>0)return e.person.some((function(t){return 0===+t.occupy}))}))}var Zt=Kt,te=Object(f["a"])(Zt,Pt,Et,!1,null,null,null);te.options.__file="pc/dormitory/room/groupRoomBox.vue";var ee=te.exports,oe=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"floor-container group"},[o("floor-box",{attrs:{"multiple-choose":!1,"floor-list":t.floorList,"active-room-id":t.activeRoomId,"loading-room-id":t.loadingRoomId},on:{"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e},"click-room":t.clickRoom}}),o("room-history-dialog",{attrs:{visible:t.roomStatusVisible,info:t.roomStatusInfo},on:{"update:visible":function(e){t.roomStatusVisible=e},"dialog-close":t.closeDialog}})],1)},ie=[];oe._withStripped=!0;var ne={name:"groupRoomBox",inject:["rightConfigPointer"],components:{roomHistoryDialog:Ut,floorBox:yt},props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiRoomStatus:null,dropAble:null,apiTeamCheckin:null,apiBuildingList:null,originFloorList:[],loadingRoomId:[],roomStatusVisible:!1,roomStatusInfo:{},firstQueryRoomList:!0}},computed:Object(y["a"])(Object(y["a"])({},Object(b["mapState"])("dormitory",["activeTeamId","roomStateList"])),{},{rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},roomObj:function(){var t={},e=this.mid,o=this.mchildren;if(!this.floorList||0===this.floorList.length)return t;for(var i=0;i<this.floorList.length;i++)for(var n=this.floorList[i],s=0;s<n[o].length;s++){var r=n[o][s];if(t[r[e]])return void dsf.layer.alert("房间roomId有重复的");t[r[e]]=r}return t},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}}),watch:{floorList:function(){var t=this;this.$nextTick((function(){t.createInteraction()}))},activeTeamId:function(){this.queryRoomList()}},created:function(){Object.assign(this,this.rightConfig);var t=(new Date).Format("yyyy-MM-dd"),e=dsf.url.queryString("sDate"),o=dsf.url.queryString("eDate"),i=e?decodeURIComponent(e):t+" 00:00:00",n=o?decodeURIComponent(o):t+" 23:59:59";this.startTime=i,this.endTime=n},mounted:function(){var t=this;s["a"].on(R.queryRoomList,(function(e){t.currentFloor=e,t.firstQueryRoomList||t.queryRoomList()}))},methods:{clickRoom:function(t){this.roomStatusInfo=Object(y["a"])({roomId:t[this.mid],roomName:t[this.mnum],emptyBedNum:t.beds},this.queryTime);var e=se.call(this);e&&(this.roomStatusInfo.sDate=e.sDate,this.roomStatusInfo.eDate=e.eDate),this.roomStatusVisible=!0},queryRoomList:function(){var t,e,o=this,i=se.call(this),n={buildingId:null===(t=this.currentFloor)||void 0===t?void 0:t.buildingId,type:null===(e=this.currentFloor)||void 0===e?void 0:e.typeValue,sDate:i?i.sDate:this.startTime,eDate:i?i.eDate:this.endTime};if(_.isFunction(this.apiRoomStatus.query)){var s=this.apiRoomStatus.query();n=a(n,s)}this.$http.get(this.apiRoomStatus.url,n).done((function(t){o.originFloorList=t.success?t.data:[]})).always((function(){o.firstQueryRoomList=!1}))},drop2room:function(t,e){var o=this,i=e[this.mid];this.loadingRoomId.push(i);var n={personId:t.personId,personName:t.personName,sexValue:t.sexValue,sexText:t.sexText,reserveId:t.reserveId,roomId:i};this.$http.post(this.apiTeamCheckin.url,JSON.stringify(n),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("入住成功"),s["a"].emit(R.refreshGroupList),o.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("入住失败",!1)})).always((function(){var t=o.loadingRoomId.findIndex((function(t){return t===i}));o.loadingRoomId.splice(t,1)}))},createInteraction:function(){var t=this;$(".floor-container .room").droppable({addClasses:!1,tolerance:"pointer",over:function(t,e){var o=$(t.target);o.css({"box-shadow":"0 0 5px inset #409eff"})},drop:function(e,o){var i=$(e.target);i.css("box-shadow","none");var n=i.data("id"),s=o.helper.data("id");if(!t.loadingRoomId.includes(n)){var r=t.roomObj[n],a=t.personObj[s],l=!1;if(_.isFunction(t.dropAble)&&(l=t.dropAble(a,r)),l){var c={type:"warning"};dsf.layer.confirm(Object.assign(l,c))}else t.drop2room(a,r)}},out:function(t,e){var o=$(t.target);o.css("box-shadow","none")}})},closeDialog:function(){this.activeRoomId="",this.queryRoomList()}}};function se(){var t=this;return!!this.activeTeamId&&this.personList.find((function(e){return e.teamId===t.activeTeamId}))}var re=ne,ae=Object(f["a"])(re,oe,ie,!1,null,null,null);ae.options.__file="pc/dormitory/room/resetGroupRoomBox.vue";var le=ae.exports,ce=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[t._v(t._s(t.title))]),o("div",{staticClass:"sec-box"},[o("dsf-button",{attrs:{loading:t.btnLoading.occupied},on:{click:function(e){return t.preClick("resetOccupiedRoom")}}},[t._v("重置已配房源")]),o("dsf-button",{attrs:{loading:t.btnLoading.checked},on:{click:function(e){return t.preClick("resetCheckedRoom")}}},[t._v("重置已选房源")]),o("dsf-button",{attrs:{loading:t.btnLoading.sure},on:{click:function(e){return t.preClick("sureRoomResource")}}},[t._v("确定分配")]),o("dsf-button",{attrs:{loading:t.btnLoading.auto},on:{click:function(e){return t.preClick("autoRoomResource")}}},[t._v("自动分配")])],1)]),o("div",{staticClass:"msg-box"},[o("color-state-list",{attrs:{"room-state-list":t.roomStateList}}),o("div",{staticClass:"msg"},[o("label",[t._v("已分配")]),t._l(t.computeAssign,(function(e,i){return o("span",{key:i},[t._v(t._s(e.name)+"："),o("b",[t._v(t._s(e.num))]),t._v("间")])}))],2)],1),o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[t._v("当前团体：")]),o("span",[t._v(t._s(t.team.teamName))]),o("span",{staticClass:"time"},[t._v(t._s(t.team.sDate))]),t._v("至 "),o("span",{staticClass:"time"},[t._v(t._s(t.team.eDate))])]),o("div",{staticClass:"msg"},[o("label",[t._v("该次需要")]),t._l(t.computeReserve,(function(e,i){return o("span",{key:i},[t._v(t._s(e.name)+"："),o("b",[t._v(t._s(e.num))]),t._v("间")])})),o("span",[t._v("共"+t._s(t.allNeedReserve)+"间客房")])],2),o("div",{staticClass:"msg"},[o("label",[t._v("已选取")]),o("span",[t._v("床位："),o("b",{staticClass:"blue"},[t._v(t._s(t.chosenBedNum))]),t._v("个")]),t._l(t.chosenRoomNum,(function(e,i){return o("span",{key:i},[t._v(t._s(e.name)+"："),o("b",{staticClass:"blue"},[t._v(t._s(t.msgChosenNum[e.code]))]),t._v("间")])}))],2)])])},ue=[];ce._withStripped=!0;o(69);var me={name:"allocationTopTool",inject:["rightConfigPointer"],components:{colorStateList:F,inlineSelectBox:Q},computed:Object(y["a"])(Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},roomTypeObj:function(){for(var t={},e=0;e<this.roomTypes.length;e++){var o=this.roomTypes[e];if(t[o.val])return dsf.error("roomTypes 有重复的val"),{};t[o.val]=o}return t}},Object(b["mapState"])("dormitory",["chosenRoomId","roomObj","roomStateList"])),{},{chosenRoomNum:function(){var t=this;return this.roomTypes.filter((function(e){return t.msgChosenNum[e.code]>0}))},computeReserve:function(){for(var t=[],e=0;e<this.roomTypes.length;e++){var o=this.roomTypes[e],i=this.mReserve[o.code];if(i&&!(i<=0)){var n={name:o.name,num:i};t.push(n)}}return t},computeAssign:function(){for(var t=[],e=0;e<this.roomTypes.length;e++){var o=this.roomTypes[e],i=this.mAssign[o.code];if(i&&!(i<=0)){var n={name:o.name,num:i};t.push(n)}}return t},chosenBedNum:function(){var t=this;if(_.isArray(this.chosenRoomId)&&this.chosenRoomId.length>0){var e=0;return this.chosenRoomId.forEach((function(o){e+=parseInt(t.roomObj[o]["beds"])})),e}return 0},team:function(){var t=this.$route.query;return{teamName:t.name,sDate:decodeURIComponent(t.sDate),eDate:decodeURIComponent(t.eDate)}}}),data:function(){return{title:"",roomTypes:null,apiRoomReserveInfo:null,btnLoading:{occupied:!1,checked:!1,sure:!1,auto:!1},msgChosenNum:{},mReserve:{},mAssign:{},allNeedReserve:null}},watch:{chosenRoomId:function(t){this.computeRoomNum(t)}},created:function(){Object.assign(this,this.rightConfig),this.queryReserveInfo()},methods:{preClick:function(t){var e="autoRoomResource"===t?this.mReserve:this.btnLoading;s["a"].emit(R[t],e)},computeRoomNum:function(t){this.msgChosenNum={};for(var e=0;e<t.length;e++){var o=t[e],i=this.roomObj[o],n=this.roomTypeObj[i.roomType].code;this.msgChosenNum[n]=this.msgChosenNum[n]&&this.msgChosenNum[n]>0?this.msgChosenNum[n]+1:1}},queryReserveInfo:function(){var t=this,e={};if(_.isFunction(this.apiRoomReserveInfo.query)){var o=this.apiRoomReserveInfo.query();e=a(e,o)}this.$http.get(this.apiRoomReserveInfo.url,e).done((function(e){t.mReserve=e.data.reserve,t.mAssign=e.data.assign;for(var o=0,i=0;i<t.roomTypes.length;i++){var n=t.roomTypes[i];o+=parseInt(t.mReserve[n.code])}t.allNeedReserve=o}))}}},de=me,fe=Object(f["a"])(de,ce,ue,!1,null,null,null);fe.options.__file="pc/dormitory/room/allocationTopTool.vue";var he=fe.exports,pe=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"floor-container allocation"},[o("floor-box",{attrs:{"floor-list":t.floorList,"chosen-room-id":t.chosenRoomId,"active-room-id":t.activeRoomId,"loading-room-id":t.loadingRoomId,"multiple-choose":!0},on:{"update:chosenRoomId":function(e){t.chosenRoomId=e},"update:chosen-room-id":function(e){t.chosenRoomId=e},"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e},"click-room":t.clickRoom}}),o("action-dialog",{attrs:{title:"自动分配房间",visible:t.autoDialogVisible,width:"30%"},on:{"update:visible":function(e){t.autoDialogVisible=e},save:t.saveAuto},scopedSlots:t._u([{key:"body",fn:function(){return[o("el-form",{ref:"form",staticClass:"auto-checkin-form",attrs:{model:t.form,"label-width":"80px"}},t._l(t.roomTypes,(function(e,i){return o("el-form-item",{key:i,attrs:{label:e.name}},[o("el-input-number",{attrs:{controls:!1,precision:0},model:{value:t.form[e.code],callback:function(o){t.$set(t.form,e.code,o)},expression:"form[item.code]"}})],1)})),1)]},proxy:!0}])}),o("room-history-dialog",{attrs:{visible:t.roomStatusVisible,info:t.roomStatusInfo},on:{"update:visible":function(e){t.roomStatusVisible=e},"dialog-close":function(e){t.activeRoomId=""}}})],1)},ve=[];pe._withStripped=!0;var ge={name:"allocationRoomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}}},data:function(){return{apiRoomStatus:null,roomTypes:null,apiResetRoomStatus:null,apiAssignRoomStatus:null,apiAutoAssign:null,startTime:"",endTime:"",originFloorList:[],chosenRoomId:[],activeRoomId:"",loadingRoomId:[],autoDialogVisible:!1,form:{},roomStatusVisible:!1,roomStatusInfo:{}}},computed:Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(b["mapState"])("dormitory",["currentFloor","roomStateList"])),watch:{currentFloor:function(){this.queryRoomList()},roomStateList:function(){this.chosenRoomId=[]}},components:{roomHistoryDialog:Ut,ActionDialog:dt,floorBox:yt,actionDialog:dt},created:function(){Object.assign(this,this.rightConfig);var t=(new Date).Format("yyyy-MM-dd");this.startTime=t+" 00:00:00",this.endTime=t+" 23:59:59"},mounted:function(){var t=this;s["a"].on(R.resetOccupiedRoom,(function(e){t.preResetOccupiedRoom(e)})),s["a"].on(R.resetCheckedRoom,(function(e){t.chosenRoomId&&0!==t.chosenRoomId.length?t.resetCheckedRoom(e):dsf.layer.message("未选择任何房间",!1)})),s["a"].on(R.sureRoomResource,(function(e){t.preSureRoomResource(e)})),s["a"].on(R.autoRoomResource,(function(e){for(var o={},i=0;i<t.roomTypes.length;i++){var n=t.roomTypes[i],s=e[n.code];o[n.code]=s&&+s>0?+s:void 0}t.form=o,t.autoDialogVisible=!0}))},methods:{clickRoom:function(t){this.roomStatusInfo=Object(y["a"])({roomId:t[this.mid],roomName:t[this.mnum],emptyBedNum:t.beds},this.queryTime),this.roomStatusVisible=!0},queryRoomList:function(){var t=this,e=Object(y["a"])(Object(y["a"])({},this.currentFloor),{},{sDate:this.startTime,eDate:this.endTime});if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();e=a(e,o)}this.$http.get(this.apiRoomStatus.url,e).done((function(e){t.originFloorList=e.success?e.data:[],t.chosenRoomId=[]}))},preResetOccupiedRoom:function(t){var e=this;dsf.layer.confirm({message:"该操作会重置所有已分配的房源，是否继续？"}).then((function(){e.resetOccupiedRoom(t)})).catch((function(){}))},resetOccupiedRoom:function(t){var e=this;t.occupied=!0;var o={};if(_.isFunction(this.apiResetRoomStatus.query)){var i=this.apiResetRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiResetRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("重置已分配房源成功"),e.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("重置已分配房源失败",!1)})).always((function(){t.occupied=!1}))},resetCheckedRoom:function(t){var e=this;t.checked=!0,this.loadingRoomId=this.chosenRoomId;var o={roomIds:this.chosenRoomId};if(_.isFunction(this.apiResetRoomStatus.query)){var i=this.apiResetRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiResetRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("所有选择的房源，重置成功"),e.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("重置已选择房源失败",!1)})).always((function(){t.checked=!1,e.loadingRoomId=[]}))},preSureRoomResource:function(t){var e=this;if(this.chosenRoomId&&0!==this.chosenRoomId.length){var o=ye(this.floorList,this.mid),i=[],n="",s="";if(this.chosenRoomId.forEach((function(t){var r=o[t];1!==r.statusValue?s+="<span>"+r[e.mnum]+"</span>":(i.push(t),n+="<span>"+r[e.mnum]+"</span>")})),0!==s.length){var r='<p class="room-msg un-pass">'.concat(s,"</p>"),a='<p class="room-msg pass">'.concat(n,"</p>"),l=0===i.length?"没有可以分配的房间":"是否继续分配以下房间？".concat(a);dsf.layer.confirm({message:"以下房间不可以被分配：".concat(r).concat(l),customClass:"dormitory-restore-select-room-confirm"}).then((function(){e.chosenRoomId=i,i.length>0&&e.sureRoomResource(t)})).catch((function(){}))}else this.sureRoomResource(t)}else dsf.layer.message("未选择任何房间",!1)},sureRoomResource:function(t){var e=this;t.sure=!0,this.loadingRoomId=this.chosenRoomId;var o={roomIds:this.chosenRoomId};if(_.isFunction(this.apiAssignRoomStatus.query)){var i=this.apiAssignRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiAssignRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(dsf.layer.message("所有选择的房源，分配成功"),e.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("分配已选择房源失败",!1)})).always((function(){t.sure=!1,e.loadingRoomId=[]}))},saveAuto:function(t){var e=this;t.save=!0;for(var o=[],i=0;i<this.roomTypes.length;i++){var n=this.roomTypes[i];if(this.form[n.code]&&!(parseInt(this.form[n.code])<=0)){var s={type:n.val,amount:this.form[n.code]};o.push(s)}}var r={roomTypes:o};if(_.isFunction(this.apiAutoAssign.query)){var a=this.apiAutoAssign.query();r=Object.assign({},r,a)}this.$http.post(this.apiAutoAssign.url,JSON.stringify(r),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(t){t.success?(e.autoDialogVisible=!1,dsf.layer.message("自动分配房源成功"),e.queryRoomList()):dsf.layer.message(t.message,!1)})).error((function(t){dsf.layer.message("自动分配房源失败",!1)})).always((function(){t.save=!1}))}}};function ye(t,e){for(var o={},i=0;i<t.length;i++)for(var n=t[i],s=0;s<n.roomDtos.length;s++){var r=n.roomDtos[s];o[r[e]]=r}return o}var be=ge,Re=Object(f["a"])(be,pe,ve,!1,null,null,null);Re.options.__file="pc/dormitory/room/allocationRoomBox.vue";var Ie=Re.exports,_e=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"floor-container"},[o("floor-box",{attrs:{"floor-list":t.floorList,"active-room-id":t.activeRoomId},on:{"update:activeRoomId":function(e){t.activeRoomId=e},"update:active-room-id":function(e){t.activeRoomId=e},"click-room":t.clickRoom}}),o("room-history-dialog",{attrs:{visible:t.roomStatusVisible,info:t.roomStatusInfo},on:{"update:visible":function(e){t.roomStatusVisible=e},"dialog-close":t.onCloseDialog}}),o("action-dialog",{attrs:{title:"房间动态信息",visible:t.roomMonthVisible,"no-footer":!0},on:{"update:visible":function(e){t.roomMonthVisible=e},"dialog-close":t.onCloseDialog},scopedSlots:t._u([{key:"inner",fn:function(){return[o("div",{staticClass:"month-box"},[o("div",{staticClass:"month-title"},[o("span",[t._v(t._s(t.monthRoomInfo.title))]),o("span",[t._v(t._s(t.monthRoomInfo.type))])]),o("div",{staticClass:"month-body"},t._l(t.monthArr,(function(e,i){return o("div",{key:i,style:t.mSty(e)},[t._v(t._s(e.text))])})),0)]),o("div",{staticClass:"month-footer"},[o("color-state-list",{attrs:{"room-state-list":t.monthStateList,"check-able":!1}})],1)]},proxy:!0}])})],1)},Ce=[];_e._withStripped=!0;var ke={name:"roomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},treeList:{type:Array},roomStateList:{type:Array,default:function(){return[]}}},data:function(){return{apiRoomStatus:null,apiOneMonthRoomInfo:null,originFloorList:[],roomStatusVisible:!1,roomStatusInfo:{},activeRoomId:"",timeDistance:0,timeTicker:null,roomMonthVisible:!1,monthRoomInfo:{},monthArr:[]}},computed:Object(y["a"])({rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias},monthStateList:function(){return this.roomStateList.slice(0,3)},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(b["mapState"])("dormitory",["currentFloor","roomStateList"])),components:{roomHistoryDialog:Ut,floorBox:yt,actionDialog:dt,colorStateList:F},watch:{currentFloor:function(){this.queryRoomList()}},created:function(){Object.assign(this,this.rightConfig)},beforeDestroy:function(){this.timeTicker&&(clearTimeout(this.timeTicker),this.timeTicker=null)},mounted:function(){var t=this;s["a"].on(R.queryRoomList,(function(){t.queryRoomList()}))},methods:{clickRoom:function(t){var e=this;this.timeDistance+=1,this.timeTicker||(this.timeTicker=setTimeout((function(){e.timeDistance>=2?e.dbClickRoom(t):e.singleClickRoom(t),e.timeDistance=0,clearTimeout(e.timeTicker),e.timeTicker=null}),250))},dbClickRoom:function(t){var e=this,o={roomId:t[this.mroomId]};this.$http.get(this.apiOneMonthRoomInfo.url,o).done((function(o){if(o.success){e.monthRoomInfo={title:"".concat(t.buildingText," / ").concat(t.floorText," / ").concat(t.name),type:t.roomText};var i=o.data;_.isFunction(e.apiOneMonthRoomInfo.callback)&&(i=e.apiOneMonthRoomInfo.callback(i)),e.monthArr=i,e.roomMonthVisible=!0}else dsf.layer.message("查询此房间一个月房态失败：\n"+o.message,!1)}))},singleClickRoom:function(t){this.roomStatusInfo=Object(y["a"])({roomId:t[this.mroomId],roomName:t[this.mroomNum],emptyBedNum:t.beds},this.queryTime),this.roomStatusVisible=!0},queryRoomList:function(){var t=this,e=Object(y["a"])({},this.currentFloor);if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();e=a(e,o)}e=Object.assign({},e,this.queryTime),this.$http.get(this.apiRoomStatus.url,e).done((function(e){t.originFloorList=e.success?e.data:[],t.activeRoomId=""}))},onCloseDialog:function(){this.activeRoomId=""},mSty:function(t){return{backgroundColor:t.bgColor}}}},Le=ke,Se=Object(f["a"])(Le,_e,Ce,!1,null,null,null);Se.options.__file="pc/dormitory/room/stateRoomBox.vue";var De=Se.exports,xe=o(862),Oe={name:"DsfDormitory",provide:function(){var t=this;return{leftConfigPointer:function(){return t.leftConfig},rightConfigPointer:function(){return t.rightConfig}}},components:{leftMenu:p},data:function(){return{leftMenuTitle:"",commonProps:{queryTime:{},treeList:[],personObj:{},personList:[]},dynamicLeft:null,dynamicTop:null,dynamicRoom:null,leftConfig:null,rightConfig:null}},watch:{"$route.query.opt":function(){this.createDormitory()}},methods:{initGuestLayout:function(){this.dynamicTop=V,this.dynamicLeft=ot,this.dynamicRoom=Dt},initGroup:function(){this.dynamicTop=Ft,this.dynamicLeft=Bt,this.dynamicRoom=ee},initAllocation:function(){this.dynamicTop=he,this.dynamicLeft=ot,this.dynamicRoom=Ie},initStatus:function(){this.dynamicTop=V,this.dynamicLeft=ot,this.dynamicRoom=De},initResetGroup:function(){this.dynamicTop=W,this.dynamicLeft=Bt,this.dynamicRoom=le},renderInner:function(){r(),this.commonProps.queryTime=we.call(this);var t=this.$route.query.opt;switch(t){case"guests":this.initGuestLayout();break;case"group":this.initGroup();break;case"allocation":this.initAllocation();break;case"roomStatus":this.initStatus();break;case"resetGroup":this.initResetGroup();break}var e=this.leftConfig.title,o=this.rightConfig.roomStateList;this.leftMenuTitle=e,this.$store.commit("dormitory/changeRoomStateList",o),this.$nextTick((function(){$(window).off("scroll").on("scroll",(function(){var t=$(window).scrollLeft();$(".top-tool-container").css("margin-left",-t)}))}))},createDormitory:function(){s["a"].clear(),this.$store.commit("dormitory/activeTeamId",""),this.leftConfig=new xe["a"](leftTreeConfig,this.$route.query.opt),this.rightConfig=new xe["a"](rightLayoutConfig,this.$route.query.opt),this.renderInner()}},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/dormitory/leftTree.js"),o=dsf.url.getWebPath("$/seat_config/dormitory/rightLayout.js");this.$http.importFiles([e,o]).then((function(e){t.createDormitory()}))}};function we(){var t=dsf.config.setting_sgcp_sdate,e=dsf.config.setting_sgcp_edate,o=(new Date).Format("yyyy-MM-dd"),i=new Date((new Date).getTime()+864e5).Format("yyyy-MM-dd"),n=t?o+" "+t:o+" 00:00:00",s=e?i+" "+e:o+" 23:59:59",r={sDate:n,eDate:s},l=this.rightConfig.defaultQueryByUrl,c={sDate:decodeURIComponent(dsf.url.queryString(l["startTime"])),eDate:decodeURIComponent(dsf.url.queryString(l["endTime"]))};return a(r,c)}var Te=Oe,je=(o(876),Object(f["a"])(Te,i,n,!1,null,null,null));je.options.__file="pc/dormitory/dormitory.vue";e["default"]=je.exports}}]);
//# sourceMappingURL=dsf-platform.Dormitory.js.map