/*! Build time : Mon Jan 18 2021 19:25:36 GMT+0800 (中国标准时间) */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Flow"],{"0e05":function(e,t,n){"use strict";n("a1a1")},"0e0b":function(e,t,n){"use strict";n("1a90")},"1a90":function(e,t,n){},"4c53":function(e,t,n){"use strict";var i=n("23e7"),s=n("857a"),o=n("af03");i({target:"String",proto:!0,forced:o("sub")},{sub:function(){return s(this,"sub","","")}})},"5a4d":function(e,t,n){},"82c8":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_workflow ds-designer",attrs:{id:"desginer"}},[n("div",{staticClass:"designer-head"},[n("div",{staticClass:"desginer_tools"},[n("a",{staticClass:"ds-button--icon-text",on:{click:e.doSave}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("保存")])]),e._m(0),e._m(1),e._m(2),e._m(3),n("a",{staticClass:"ds-button--icon-text",class:{selected:e.isDrawLine},on:{click:e.drawLine}},[n("i",{staticClass:"iconfont icon-liujisuan"}),n("span",[e._v("连线")])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),e._m(4),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.addLane("vertical")}}},[n("span",[e._v("泳道(垂直)")])]),n("dd",{on:{click:function(t){return e.addLane("horizontal")}}},[n("span",[e._v("泳道(水平)")])])])]),n("a",{staticClass:"ds-button--icon-text scale"},[n("div",{staticClass:"scale-com"},[n("i",{staticClass:"el-icon-minus",class:{disabled:e.scale<=.4},on:{click:function(t){return e.rootScale("down")}}}),n("span",{staticClass:"percent"},[e._v(e._s(Math.round(100*e.scale))+"%")]),n("i",{staticClass:"el-icon-plus",class:{disabled:e.scale>=2},on:{click:function(t){return e.rootScale("up")}}})]),n("span",[e._v("缩放")])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-dakai"}),e._m(5),n("dl",{staticClass:"layui-nav-child"},[n("p",{on:{click:function(t){return e.exportFlow()}}},[n("span",[e._v("创建组")])]),n("p",{staticClass:"label",on:{click:function(t){return e.saveAsFlow()}}},[n("span",[e._v("保存为组件")])]),n("p",{on:{click:function(t){return e.openFlow()}}},[n("span",[e._v("选择组")])])])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),e._m(6),n("dl",{staticClass:"layui-nav-child"},[e._m(7),n("p",{staticClass:"child"},[e._v("DFR")]),n("p",{staticClass:"child"},[e._v("BPMN2.0")]),n("p",{staticClass:"child"},[e._v("XML")]),n("p",{staticClass:"label child",on:{click:function(t){return e.exportFlowJson()}}},[e._v("JSON")]),e._m(8),n("p",{staticClass:"child"},[e._v("DFR")]),n("p",{staticClass:"child"},[e._v("BPMN2.0")]),n("p",{staticClass:"child"},[e._v("XML")]),n("p",{staticClass:"label child"},[e._v("JSON")]),n("p",{staticClass:"label",on:{click:function(t){return e.startTestFlow()}}},[n("span",[e._v("仿真测试")])]),n("p",{on:{click:function(t){return e.monitorFlow()}}},[n("span",[e._v("浏览监控")])])])]),e.$store.state.flow.selectedList&&e.$store.state.flow.selectedList.length>1?n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),e._m(9),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.alignment("left")}}},[n("span",[e._v("左对齐(L)")])]),n("dd",{on:{click:function(t){return e.alignment("center")}}},[n("span",[e._v("水平居中(C)")])]),n("dd",{on:{click:function(t){return e.alignment("right")}}},[n("span",[e._v("右对齐(R)")])]),n("dd",{on:{click:function(t){return e.alignment("top")}}},[n("span",[e._v("顶端对齐(T)")])]),n("dd",{on:{click:function(t){return e.alignment("middle")}}},[n("span",[e._v("垂直居中(M)")])]),n("dd",{on:{click:function(t){return e.alignment("bottom")}}},[n("span",[e._v("底端对齐(B)")])]),n("dd",{on:{click:function(t){return e.alignment("horizontal")}}},[n("span",[e._v("横向分布(H)")])]),n("dd",{on:{click:function(t){return e.alignment("vertical")}}},[n("span",[e._v("纵向分布(V)")])])])]):e._e()])]),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"designer-center"},[n("div",{ref:"ds_page",staticClass:"ds_control ds_page layui-form leftRight_ design",on:{scroll:function(t){return e.onScroll(t)}}},[n("div",{ref:"container",staticClass:"flow",style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale),transform:"scale("+e.scale+") translateZ(0)",transformOrigin:"left top"},attrs:{id:"flow_box"}},[n("div",{ref:"root",staticClass:"root",class:{has_v_head:e.lanes&&e.lanes.vertical.length>0,has_h_head:e.lanes&&e.lanes.horizontal.length>0},style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale)}},[e.baseLine.showV?n("span",{staticClass:"baseLine_v",style:{transform:"translate3d("+e.baseLine.left+"px, 0, 0)"}}):e._e(),e.baseLine.showH?n("span",{staticClass:"baseLine_h",style:{transform:"translate3d(0, "+e.baseLine.top+"px, 0)"}}):e._e(),n("flow-content",{ref:"flowContent",attrs:{"flow-info":e.flowInfo,"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,lanes:e.lanes,events:e.events,checked:e.checked,config:e.config}}),n("div",{ref:"backLayout",staticClass:"backgroundLayout"},[n("div",{ref:"v_lane",staticClass:"v_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.vertical,checked:e.checked},on:{addLane:e.addLane}})],1),n("div",{ref:"h_lane",staticClass:"h_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.horizontal,checked:e.checked},on:{addLane:e.addLane}})],1)])],1)])])]),n("div",{staticClass:"designer-left",staticStyle:{"margin-top":"60px"}},[n("div",{staticClass:"designer-left-tools"},[n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[e._l(e.flowTools,(function(t,i){return n("el-collapse-item",{key:i,attrs:{title:t.title,name:i}},[n("div",{staticClass:"layui-colla-content layui-show"},[e._l(t.data,(function(t){return n("div",{key:t.type,staticClass:"ds_tool_item nodeButton",attrs:{title:t.name,sort:t.sort,nodetype:t.type,draggable:"true"},on:{dragstart:function(n){return e.dragTool(n,t)}}},[n("img",{attrs:{src:t.img,draggable:"false"}}),e._v(" "+e._s(t.name)+" ")])})),n("div",{staticStyle:{clear:"both"}})],2)])})),n("el-collapse-item",{attrs:{title:"边界事件",name:"5"}},[n("div",{staticClass:"layui-colla-content layui-show"},e._l(e.boundaryEvents,(function(t){return n("div",{key:t.type,staticClass:"nodeButton ds_tool_event",attrs:{title:t.name,nodetype:t.type}},[n("div",{staticClass:"tool_event_drag",attrs:{draggable:"true"},on:{dragstart:function(n){return e.dragBoundaryEvent(n,t)}}},[n("img",{attrs:{src:t.url,draggable:"false"}})]),n("span",[e._v(e._s(t.name))])])})),0)])],2)],1)]),n("div",{staticClass:"designer-right",attrs:{id:"propertyBox"}},[n("flow-info",{attrs:{checked:e.checked,nodes:e.nodes,lines:e.lines,"flow-info":e.flowInfo}})],1)])])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("发布")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),n("span",[e._v(" 版本 "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("p",{staticClass:"label"},[n("span",[e._v("当前版本")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",{staticClass:"label"},[n("span",[e._v("历史版本")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-shebeikaifa1"}),n("span",[e._v("模板库")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("关闭")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 泳道 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 组件 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 更多 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"title"},[n("span",[e._v("导出")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"title"},[n("span",[e._v("导入")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 对齐方式 "),n("i",{staticClass:"iconfont icon-xia1"})])}],o=(n("99af"),n("7db0"),n("c740"),n("4160"),n("a630"),n("c975"),n("d81d"),n("a434"),n("b0c0"),n("a9e3"),n("b680"),n("d3b7"),n("acd8"),n("6062"),n("3ca3"),n("4c53"),n("159b"),n("ddb0"),n("4795"),n("2909")),a=(n("96cf"),n("1da1")),l=n("5530"),r=n("2f62"),c=n("e77e"),d=n("80ae"),u=n("55c1"),h=n("531e"),f=n("3b6b"),p=function(e){var t=Object.assign({size:260,direction:u["a"].vertical},e);this.id=t.id||null,this.name=t.name||"",this.index=t.index,this.direction=t.direction,this.isRender=!1,this.size=t.size,t.attributes?this.attributes=Object(l["a"])({},t.attributes):(this.attributes=Object(h["b"])(Object(f["d"])()),this.attributes.Name=this.name,this.attributes.ID=this.id)},v=p,b=n("b6e4"),g=n("c6f6"),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_attr_root"},[n("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.status,expression:"status === 'base'"}],staticClass:"base"},[n("p",{staticClass:"title"},[n("span",[e._v("常用")]),n("el-button",{staticClass:"el-button-all",attrs:{size:"mini",round:""},on:{click:function(t){e.status="advanced"}}},[n("span",[e._v("全部")]),n("i",{staticClass:"el-icon-arrow-right"})])],1),n("div",{staticClass:"el-collapse-item__content"},e._l(e.data,(function(t,i){return n("el-form",{key:i,staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,i){return n("div",{key:i,staticClass:"property-item"},[!t.hide&&t.isBase?n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},on:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:1,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:e.subIsDisabled||!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{disabled:e.subIsDisabled,type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2,disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-radio",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:[t.class],attrs:{type:"plain",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" "+e._s(e.subIsDisabled?"查看":"设置")+" ")]):e._e()],1):e._e()],1)})),0)})),1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:"advanced"===e.status,expression:"status === 'advanced'"}],staticClass:"advanced"},[n("p",{staticClass:"title"},[n("span",[e._v("全部")]),n("el-button",{staticClass:"el-button-base",attrs:{size:"mini",round:""},on:{click:function(t){e.status="base"}}},[n("i",{staticClass:"el-icon-arrow-left"}),n("span",[e._v("常用")])])],1),n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.data,(function(t){return n("el-collapse-item",{key:t.name,attrs:{title:t.name,name:t.name}},[n("el-form",{staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,i){return n("div",{key:i,staticClass:"property-item"},[t.hide?e._e():n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},on:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:1,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:e.subIsDisabled||!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{disabled:e.subIsDisabled,type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2,disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-radio",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:t.class,attrs:{type:"plain",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" "+e._s(e.subIsDisabled?"查看":"设置")+" ")]):e._e()],1)],1)})),0)],1)})),1)],1)])},y=[],x=(n("a15b"),n("b64b"),n("ac1f"),n("1276"),n("51358")),w={name:"FlowInfo",components:{DsfDesignerDialog:x["a"]},props:{checked:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}},nodes:{type:Array,default:function(){return[]}},lines:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:["1"],curSelectObj:null,curNodeObj:null,curElement:null,AppInfo:null,data:[],status:"base",showHeplerMark:!1,subIsDisabled:!1}},computed:{minValue:function(){return function(e,t){return 0===t?Number(e.oldValue.split(".")[0]):e.value0>Number(e.oldValue.split(".")[0])&&1===t?0:Number(e.oldValue.split(".")[1])}}},watch:{checked:function(e){this.loadPropertyWindow(e),this.subIsDisabled=this.disabledSub()}},mounted:function(){var e=this;this.$bus.$on("updateNodeName",(function(t,n){n||e.loadPropertyWindow(t)}))},methods:{disabledSub:function(){if(this.curSelectObj&&this.curSelectObj.parentNodeId){var e=Object(h["d"])(this.nodes,this.curSelectObj.parentNodeId);return Object(h["i"])(e)}return!1},show:function(e){return!e.nodeType&&"Version"!==e.nodeName2&&!e.editor&&"dialog"!==e.type||!e.unit&&"text"===e.editor||"numberbox"===e.editor},loadPropertyWindow:function(e){0!==Object.keys(e).length&&(this.curSelectObj=e||null,this.curNodeObj=e?e.attributes:null,this.loadPropertyDom(e?this.setPropertyData(e):[]))},showHelp:function(e){this.$set(e,"showHeplerMark",!0)},setPropertyData:function(e){var t=null;if(e instanceof d["a"])if("101"==e.type)t=Object(f["n"])();else if("102"==e.type)t=Object(f["c"])();else if("103"==e.type){var n={name:"脚本任务",type:"103",language:"java"};t=Object(f["l"])(n)}else if("104"===e.type)t=Object(f["o"])();else if("105"===e.type)t=Object(f["j"])();else if("106"===e.type){var i={name:"python任务",type:"106",language:"python"};t=Object(f["l"])(i)}else if("107"===e.type){var s={name:"shell任务",type:"107",language:"shell"};t=Object(f["l"])(s)}else if("108"===e.type){var o={name:"SQL任务",type:"108",language:"SQL"};t=Object(f["l"])(o)}else t="201"==e.type?Object(f["m"])():"299"==e.type?Object(f["q"])():"301"==e.type?Object(f["g"])():"302"==e.type?Object(f["h"])():Object(f["k"])();else t=e instanceof b["a"]?Object(f["i"])():e instanceof v?Object(f["d"])():e instanceof g["a"]?Object(f["b"])():Object(f["a"])();var a=e.attributes,l=null,r=-1;t.json=[];for(var c=0;c<t.rows.length;c++)1==t.rows[c].nodeLevel?t.rows[c].value=a[t.rows[c].nodeName]:2==t.rows[c].nodeLevel?a[t.rows[c].nodeName1]?t.rows[c].value=a[t.rows[c].nodeName1][t.rows[c].nodeName2]:t.rows[c].value="":3==t.rows[c].nodeLevel&&(a[t.rows[c].nodeName1]&&a[t.rows[c].nodeName1][t.rows[c].nodeName2]?t.rows[c].value=a[t.rows[c].nodeName1][t.rows[c].nodeName2][t.rows[c].nodeName3]:t.rows[c].value=""),t.rows[c].group!=l&&(r++,l=t.rows[c].group,t.json[r]={name:l,attributes:[]}),t.json[r]["attributes"].push(t.rows[c]);return t.json},loadPropertyDom:function(e){var t=this,n=[];e.forEach((function(e){e.attributes.forEach((function(e){e.editor&&"checkbox"===e.editor.type?e.value=e.value||[]:e.editor&&"checkbox"!==e.editor.type?e.value=e.editor&&e.editor.options&&e.value?Number(e.value):e.value:"flow"===e.nodeType&&"Version"===e.nodeName2?(e.oldValue=e.value,e.value0=e.value.split(".")[0],e.value1=e.value.split(".")[1],e.value2=e.value.split(".")[2]):e.value=e.value,e.showRob&&n.push(e)}))})),this.data=e,n&&n.length>0&&n.forEach((function(e){t.showRob(e)})),this.activeNames=[this.data[0].name]},changeVesion:function(e,t){e&&(0===t&&(e.value1=0,e.value2="0001"),e.value=e.value0+"."+e.value1+"."+e.value2,this.changeProperty(e))},changeProperty:function(e){if(e.nodeName2&&"Name"==e.nodeName2&&(this.curSelectObj instanceof d["a"]&&(this.curSelectObj.name=e.value,this.$bus.$emit("updateNodeName".concat(this.isSub?this.parentNode.id:""),this.curSelectObj,!0)),this.curSelectObj instanceof v&&(this.curSelectObj.name=e.value),this.curSelectObj instanceof b["a"]&&(this.curSelectObj.name=e.value)),e.showRob&&"GatherRule"==e.showRob&&this.curSelectObj instanceof b["a"]&&(this.curSelectObj.type=e.value),"InLine"===e.nodeName1&&"Type"===e.nodeName2){var t=Object(f["e"])(e.value),n=[],i=this.curNodeObj.InLine.RangeRule&&this.curNodeObj.InLine.RangeRule.Rule;i&&i.length>0&&(i.forEach((function(e,t){n.push(e.name+"/"+Object(f["f"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(t,": ").concat(n.join(",")))}if("InLine"===e.nodeName1&&"RangeRule"===e.nodeName2&&e.value&&e.value.Rule&&e.value.Rule.length>0){var s=Object(f["e"])(this.curNodeObj.InLine.Type),o=[];e.value.Rule.forEach((function(e,t){o.push(e.name+"/"+Object(f["f"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(s,": ").concat(o.join(","))}this.showRob(e),1==e.nodeLevel?this.curNodeObj[e.nodeName]=e.value:2==e.nodeLevel?this.curNodeObj[e.nodeName1][e.nodeName2]=e.value:3==e.nodeLevel&&(this.curNodeObj[e.nodeName1][e.nodeName2][e.nodeName3]=e.value)},showRob:function(e){var t=this;e.showRob&&this.data.forEach((function(n){n.attributes.forEach((function(n){var i=e.showRob.split(",");i.forEach((function(i){if(n.nodeName2===i||n.nodeName3===i)if("RushInfo"===i)5===e.value?Object.assign(n,{name:"人数",value:1,max:999999,unit:"（人）",hide:!1}):6===e.value?Object.assign(n,{name:"比例",value:60,max:100,unit:"%",hide:!1}):n.hide=!0;else if("GatherRule"===i)1===e.value||2===e.value?n.hide=!1:n.hide=!0;else if("Params"===i)0===e.value||1===e.value?n.hide=!1:n.hide=!0;else if("Content"===i)2===e.value?n.hide=!1:n.hide=!0;else if("Value"===i)0!==e.value?n.hide=!1:n.hide=!0;else if("IsEnbled"===i)e.value&&t.curSelectObj.attributes.BaseInfo&&0===t.curSelectObj.attributes.BaseInfo.Mode?n.hide=!1:n.hide=!0;else if("OpinionNodeID"===i){var s=t.curSelectObj.attributes.BaseInfo;setTimeout((function(){0===s.Mode&&s.SubWFID&&1===s.Merge.IsEnbled?n.hide=!1:n.hide=!0}),0)}}))}))}))},doOpenDialog:function(e){var t=this,n=e,i={code:n.value&&n.value.Expression||"",language:"java",checked:this.checked,value:n.value};n.config&&n.config.content&&("RangeRule"===n.config.content?(i.nodes=this.nodes,i.value=n.value||{}):"Summary"===n.config.content||"SendCondition"===n.config.content?(i.lines=this.lines,i.value=n.value||{}):"EventSetting"===n.config.content?i.isEvent=!0:"SetSubFlow"===n.config.content?i.mode=this.curSelectObj.attributes.BaseInfo.Mode:"SetOpinionNode"===n.config.content&&(i.subNodes=this.curSelectObj.nodes)),dsf.layer.pc.openDialog({title:n.name,width:n.config.width,height:n.config.height,overflow:"hidden",content:n.config.content,params:i,btns:[{class:this.subIsDisabled?"hide":"",text:"确定",handler:function(e){if("SetSubFlow"===n.config.content){if(e.validate()){var i=e.yes();return n.value=i.SubWFID,t.curSelectObj.attributes.BaseInfo.Mode=i.Mode,t.curSelectObj.attributes.BaseInfo.SubWFName=i.SubWFName,t.curSelectObj.attributes.BaseInfo.OpinionNodeID=null,t.curSelectObj.attributes.BaseInfo.OpinionNodeName=null,i.SubWFID?t.$http.get("wfm/getWFDefinition",{sID:i.SubWFID}).then((function(e){return t.changeProperty(n),t.$bus.$emit("initSubNode",t.curSelectObj,e.data.data.WorkFlow&&e.data.data.WorkFlow.ElementList||[]),!0})).catch((function(e){})):(t.$bus.$emit("initSubNode",t.curSelectObj,[]),!0)}return!1}if("SetOpinionNode"===n.config.content){var s=e.yes();n.value=s.id,t.curSelectObj.attributes.BaseInfo.OpinionNodeName=s.name,t.changeProperty(n)}else n.value=e.getContent(),t.changeProperty(n)}},{text:"取消"}]}),"SetSubFlow"!==n.config.content||n.value||dsf.layer.message("请慎重操作，选择子流程任务后，将自动获取子流程任务，覆盖子流程")}}},N=w,O=(n("ef29"),n("2877")),$=Object(O["a"])(N,m,y,!1,null,"0b6c4c1a",null),j=$.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"svgRoot",staticClass:"svgRoot"},[n("lines",{ref:"lines",attrs:{"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,events:e.events,checked:e.checked,config:e.config}}),n("nodes",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,checked:e.checked,config:e.config}}),n("events",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,events:e.events,checked:e.checked,config:e.config}})],1)},_=[],C=n("bd20"),I=n("7a66"),E=n("9e79"),L={name:"FlowContent",components:{Lines:C["a"],Events:I["a"],subprocess:E["a"]},props:{flowInfo:{type:Object,default:function(){return{}}},lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},lanes:{type:Object,default:function(){return{}}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},config:{type:Object,default:function(){return{}}}},data:function(){return{}},watch:{flowInfo:function(e){e&&this.init()}},created:function(){},mounted:function(){},methods:{init:function(){this.initFlow()},initFlow:function(){flow={attributes:Object.assign(Object(h["b"])(Object(f["a"])()),this.flowInfo)}}}},S=L,P=(n("0e05"),Object(O["a"])(S,k,_,!1,null,null,null)),M=P.exports,D=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"lanes"},e._l(e.lanes,(function(t,s){return i("div",{key:t.id||s,staticClass:"lane",class:{selected:e.checked===t},style:{left:e.toPx(t.left),top:e.toPx(t.top),width:"vertical"===t.direction?e.toPx(t.size):"",height:"horizontal"===t.direction?e.toPx(t.size):""},attrs:{index:s},on:{click:function(n){return e.selectLane(n,t)}}},[i("div",{staticClass:"head"},[i("div",{staticClass:"title"},[i("el-popover",{attrs:{placement:"vertical"===t.direction?"bottom":"right",title:"修改名称",width:"200",trigger:"manual"},model:{value:t.isEdit,callback:function(n){e.$set(t,"isEdit",n)},expression:"lane.isEdit"}},[i("div",{staticClass:"el-input"},[t.isEdit?i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"lane.name"},{name:"focus",rawName:"v-focus"}],staticClass:"el-input__inner",attrs:{autofocus:"",type:"text",placeholder:"请输入内容"},domProps:{value:t.name},on:{change:function(n){t.attributes.Name=t.name,e.hideEdit()},input:function(n){n.target.composing||e.$set(t,"name",n.target.value)}}}):e._e()]),i("span",{staticClass:"textContent ellipsis",style:{width:e.toPx(t.size),transform:"horizontal"===t.direction?"rotate(-90deg) translateX(-"+t.size+"px)":""},attrs:{slot:"reference"},on:{dblclick:function(n){return e.edit(t)}},slot:"reference"},[e._v(" "+e._s(t.name)+" ")])]),i("img",{staticClass:"plus left",attrs:{src:n("b800")},on:{click:function(n){return e.addLane(t.direction,s)}}}),i("img",{staticClass:"plus right",attrs:{src:n("b800")},on:{click:function(n){return e.addLane(t.direction,s+1)}}}),i("span",{staticClass:"resizeLane",on:{mousedown:function(n){return e.dragLane(n,t)}}})],1)]),i("div",{staticClass:"bg/"}),i("div",{staticClass:"laneSelected"})])})),0)},T=[],z={name:"Lanes",props:{lanes:{type:Array,default:function(){return[]}},checked:{type:Object,default:function(){return{}}}},data:function(){return{current:null,minSize:100}},mounted:function(){var e=this;document.addEventListener("mousedown",(function(t){var n=t.target;"tooltip"!==n.getAttribute("role")&&"tooltip"!==n.parentElement.getAttribute("role")&&"tooltip"!==n.parentElement.parentElement.getAttribute("role")&&e.hideEdit()})),document.addEventListener("mousemove",(function(t){e.moveLane(t)})),document.addEventListener("mouseup",(function(t){e.dropLane(t)}))},methods:{toPx:function(e){return"".concat(e,"px")},selectLane:function(e,t){this.$bus.$emit("update-checked",t),e.stopPropagation()},addLane:function(e,t){this.$emit("addLane",e,t)},dragLane:function(e,t){this.$bus.$emit("update-checked",t),this.current=Object(l["a"])({},t),this.$bus.$emit("update-baseLine",{show:this.current.direction,top:0,left:0})},dropLane:function(e){if(this.current){var t=this.$store.state.flow.page,n=this.$store.state.flow.svgRoot,i=this.$store.state.flow.page.scale;this.current.direction===u["a"].vertical?this.current.size=(e.pageX-this.current.left-t.left+n.scrollLeft)/i:this.current.size=(e.pageY-this.current.top-t.top+n.scrollTop)/i,this.current.size=this.current.size>this.minSize?this.current.size:this.minSize,this.$bus.$emit("update-baseLine",{showV:!1,showH:!1,top:0,left:0}),this.$store.commit("flow/changeLane",this.current),this.$bus.$emit("resize"),this.current=null}},moveLane:function(e){if(!this.current)return!1;var t,n=this.$store.state.flow.page,i=this.$store.state.flow.svgRoot,s=this.$store.state.flow.page.scale;if(this.current.direction===u["a"].vertical){var o=this.current.left+this.minSize,a=e.pageX-n.left+i.scrollLeft;t={top:10,left:(a>o*s?a:o*s)/s}}else{var l=this.current.top+this.minSize,r=e.pageY-n.top+i.scrollTop;t={top:(r>l*s?r*s:l)/s,left:10}}var c=Object.assign(t,{showV:"vertical"===this.current.direction,showH:"horizontal"===this.current.direction});this.$bus.$emit("update-baseLine",c),this.$bus.$emit("autoScroll",{type:"lane",data:this.current,mouse:{x:e.pageX,y:e.pageY}})},edit:function(e){this.lanes.forEach((function(t){t.isEdit=e===t}))},hideEdit:function(){this.lanes.forEach((function(e){e.isEdit=!1}))}}},F=z,R=(n("95b1"),Object(O["a"])(F,D,T,!1,null,"1e31fce0",null)),B=R.exports,A=n("4267");n("b032"),n("8a5f");window.flow=null;var G={name:"Flow",components:{FlowInfo:j,FlowContent:M,Lanes:B},data:function(){return{activeNames:[0],isDrawLine:!1,dragNode:null,dragEvent:null,endTarget:null,width:0,height:0,maxWidth:0,maxHeight:0,flow:null,flowInfo:null,config:null,sID:this.$route.query&&this.$route.query.id||"5b2d48d830c44b509d4fa730fa9d0b9b",nodes:[],lines:[],events:[],distance:30,cloneObj:null,crashNode:null,scale:this.$store.state.flow.page.scale,dragSize:20,maxSizeOffset:50,flowTools:f["r"],boundaryEvents:f["p"],checked:null,baseLine:{show:"",top:0,left:0},showLineV:!1,showLineH:!1,isGlobalPosMove:!1,globalPos:null,globalMoveLastMouse:null,globalRect:null,isGlobalSelect:!1,selectGlobalPos:null,selectGlobalPonits:{start:{x:0,y:0},end:{x:0,y:0}},globalSelect:null,isCtrlKey:!1,ctrlCopyNodes:null,isCopyNodes:!1,copyNodesPos:null,copyNodes:[],hasMoved:!1}},computed:Object(l["a"])({},Object(r["b"])({lanes:function(e){return e.flow.lanes}})),created:function(){},mounted:function(){this.reset(),this.init(),this.flow=this.$store.state.flow},methods:Object(l["a"])({toPx:h["h"],verifySub:h["i"],reset:function(){var e=this.$refs.ds_page;this.$store.commit("flow/setPage",{width:e.clientWidth,height:e.clientHeight})},init:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initData();case 2:e.loadElement(),e.initEvent();case 4:case"end":return t.stop()}}),t)})))()},initData:function(){var e=this;return this.$http.all([this.$http.get("./static/pd_attributes/dsf.flow.json"),this.$http.get("wfm/getWFDefinition",{sID:this.sID})]).then((function(t){e.config=t[0],e.flowInfo=t[1].data.WorkFlow})).catch((function(t){e.flowInfo={}}))},loadElement:function(){var e=this,t=this.flowInfo&&this.flowInfo.ElementList||[];if(t&&t.length>0)for(var n=0;n<t.length;n++){var i=t[n];if("node"==i.nodeType)(function(){var t=i;t.in=t.in||[],t.out=t.out||[],t.point.x=parseFloat(t.point.x),t.point.y=parseFloat(t.point.y),t=Object.assign({x:t.point.x,y:t.point.y},t),f["r"].forEach((function(e){e.data.forEach((function(e){t.attributes.BaseInfo.Type==e.type&&(t.attributes.BaseInfo.Type=e.name)}))}));var n=e.addNode(t);if(t.nodes){var s=t.nodes;n.nodes=[],n.lines=[],n.events=[],s.forEach((function(t){t=Object.assign({x:t.point.x,y:t.point.y},t),n.nodes.push(e.addSubNode(t,n))}))}t.events&&t.events.forEach((function(e){var i=new g["a"](e);i.parentNode=t,n.events.push(i)})),t.lines&&t.lines.forEach((function(n){n.linkInfo&&(n.linkInfo.fromOffset=parseFloat(n.linkInfo.fromOffset),n.linkInfo.toOffset=parseFloat(n.linkInfo.toOffset)),setTimeout((function(){e.$bus.$emit("addLine".concat(t.id),{id:n.id,type:n.type,name:n.name,path:n.path,from:n.from,fromType:n.fromType,to:n.to,linkInfo:n.linkInfo,attributes:n.attributes,parentNodeId:t.id})}),0)})),e.nodes.push(n)})();else if("line"==i.nodeType){var s=i;s.linkInfo&&(s.linkInfo.fromOffset=parseFloat(s.linkInfo.fromOffset),s.linkInfo.toOffset=parseFloat(s.linkInfo.toOffset)),this.$bus.$emit("addLine",{id:s.id,type:s.type,name:s.name,path:s.path,from:s.from,fromType:s.fromType,isHide:s.isHide,to:s.to,linkInfo:s.linkInfo,attributes:s.attributes})}else if("lane"==i.nodeType){var o=i;this.createLane({id:o.id,name:o.name,size:o.size,index:o.index,direction:o.direction,attributes:o.attributes})}else"event"==i.nodeType&&this.events.push(new g["a"](i))}this.resize()},doSave:function(){flow.attributes.BaseInfo.ID=this.sID;var e={WorkFlow:{BaseInfo:flow.attributes.BaseInfo,NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[]}};this.nodes.forEach((function(e){if(e.lines){var t=dsf.mix(!0,[],e.lines);e.lines=t.map((function(e){return delete e.paper,e}))}e.events&&(e.events=e.events.map((function(e){return e.parentNodeId=e.parentNode.id,delete e.parentNode,Object(l["a"])({},e)})))}));for(var t={nodes:Object(o["a"])(JSON.parse(JSON.stringify(this.nodes))),lanes:Object(l["a"])({},this.lanes),lines:Object(o["a"])(this.lines),events:Object(o["a"])(this.events)},n=dsf.mix(!0,{},t),i=this.getFlowAllObjectMap(n),s=[],a=[],r=0;r<n.nodes.length;r++){var c=n.nodes[r];if("6"==c.type){var d=[],u=[],p=this.getFromNodes(c);if(p)for(var v=0;v<p.length;v++){var b=p[v];d.push(i[b.id])}if(p=this.getToNodes(c),p)for(var g=0;g<p.length;g++){var m=p[g];u.push(i[m.id])}var y={node:c,from:d,to:u};s.push(y)}}for(var x=0;x<s.length;x++){var w=s[x];w.node;if(w.node["out"].length>0){for(var N=0;N<w.from.length;N++){for(var O=w.from[N],$=0;$<w.node["out"].length;$++){var j=w.node["out"][$],k=Object.assign(!0,{},i[j]);k.attributes.ID=k.id+"_"+O.id,k.attributes.StartNodeID=O.id,n.lines.push(k),a.push(j)}O.attributes.OutLine.SendConditions=w.node.attributes.OutLine.SendConditions;var _=Object(h["d"])(this.nodes,O.id);_&&(_.attributes.OutLine.SendConditions=w.node.attributes.OutLine.SendConditions)}for(var C=0;C<w.node["in"].length;C++)a.push(w.node["in"][C])}else for(var I=0;I<w.from.length;I++){var E=w.from[I];E.attributes.OutLine.SendConditions={IsEnabled:"0"};var L=Object(h["d"])(this.nodes,E.id);L&&(L.attributes.OutLine.SendConditions={IsEnabled:"0"})}}for(var S=0;S<a.length;S++)for(var P=n.lines.length-1;P>=0;P--)n.lines[P].attributes.ID==a[S]&&n.lines.splice(P,1);for(var M=function(t){var i=n.nodes[t];i.nodes&&i.nodes.forEach((function(e){delete e.isRender,delete e.edit})),f["r"].forEach((function(e){e.data.forEach((function(e){i.attributes.BaseInfo.Type==e.name&&(i.attributes.BaseInfo.Type=e.type)}))})),e.WorkFlow.NodeList.push(i.attributes),i.nodeType="node",e.WorkFlow.ElementList.push(i)},D=0;D<n.nodes.length;D++)M(D);for(var T=0;T<n.lines.length;T++){var z=n.lines[T];delete z.paper,e.WorkFlow.LineList.push(z.attributes),delete z.arrowEnd,delete z.isRender,z.nodeType="line",e.WorkFlow.ElementList.push(z)}for(var F=0;F<n.events.length;F++){var R=n.events[F];e.WorkFlow.EventList.push(R.attributes),R.nodeType="event",e.WorkFlow.ElementList.push(R)}for(var B=0;B<t.lanes.horizontal.length;B++){var A=t.lanes.horizontal[B],G=Object(h["a"])(A);delete G.isRender,e.WorkFlow.LaneList.horizontal.push(A.attributes),G.nodeType="lane",e.WorkFlow.ElementList.push(G)}for(var W=0;W<t.lanes.vertical.length;W++){var H=t.lanes.vertical[W],X=Object(h["a"])(H);delete X.isRender,e.WorkFlow.LaneList.vertical.push(H.attributes),X.nodeType="lane",e.WorkFlow.ElementList.push(X)}var V={sData:JSON.stringify(e)};this.$http.post("wfm/saveWFDefinition",V).done((function(e){e.success?dsf.layer.message("保存成功",!0):dsf.layer.message("保存失败",!1)})).error((function(){dsf.layer.message("保存失败",!1)}))},initEvent:function(){var e=this;document.addEventListener("dragover",(function(t){e.dragNode&&(e.hasMoved=!0,e.isCtrlKey=t.ctrlKey,e.dragToolOver(t)),e.dragEvent&&e.dragEventOver(t)})),document.addEventListener("dragend",(function(t){!e.hasMoved&&e.dragNode&&(e.dragNode&&document.body.removeChild(e.dragNode),e.dragNode=null,e.$bus.$emit("isMoveNode",!1),e.hasMoved=!1),e.dragNode&&(e.dragToolEnd(t),e.hasMoved=!1),e.dragEvent&&(e.dragEventEnd(t),e.dragEvent&&document.body.removeChild(e.dragEvent),e.dragEvent=null,e.cloneObj=null,e.crashNode=null,e.$bus.$emit("endMoveEvent",!0))})),this.$bus.$on("update-baseLine",(function(t){e.baseLine=t})),this.$bus.$on("update-checked",(function(t){e.checked=t})),this.$bus.$on("parentAutoScroll",this.parentAutoScroll),this.$bus.$on("autoScroll",this.autoScroll),this.$bus.$on("resize",this.resize),this.$bus.$on("dragCloneEvent",this.dragCloneEvent),this.$bus.$on("dragNode",this.dragTool),this.$bus.$on("startGlobalMove",this.startGlobalMove),this.$bus.$on("startCopyNodes",this.startCopyNodes),this.$bus.$on("deleteLine",this.deleteLine),this.$bus.$on("initSubNode",this.initSubNode),document.addEventListener("keydown",this.keydown),window.onresize=function(){e.reset(),e.resize()},this.$refs.root.addEventListener("mousedown",(function(t){e.$store.state.flow.selectedList;"svg"===t.target.tagName&&-1===t.target.parentElement.parentElement.className.indexOf("subprocess")&&(e.checked=flow,e.$bus.$emit("selectGlobal",null),e.isGlobalSelect=!0,e.selectGlobalPos=e.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}))})),this.$refs.root.addEventListener("mousemove",(function(t){e.readOnly||(e.setCursor(t),e.isGlobalPosMove&&e.globalMove(t),e.isGlobalSelect&&e.selectGlobalMove(t),e.isCopyNodes&&e.nodesMove(t))})),document.addEventListener("mouseup",(function(t){e.isGlobalPosMove&&(e.isGlobalPosMove=!1,e.globalPos=null,e.resize(),e.$store.commit("flow/clearPoints")),e.isGlobalSelect&&(e.selectGlobalEnd(t),e.resize(),e.$store.commit("flow/clearPoints")),e.isCopyNodes&&e.nodesMoveEnd(t)})),this.$refs.ds_page.addEventListener("wheel",this.scrollwheel,!0),document.addEventListener("copy",(function(t){e.$store.state.flow.selectedList.length>0&&e.documentCopy(t)})),document.addEventListener("paste",(function(t){e.ctrlCopyNodes||e.pasteNode(t)}))},initSubNode:function(e,t){var n=this;e.open.show=!0,e.lines&&e.lines.forEach((function(e){e.remove()})),this.$set(e,"nodes",[]),this.$set(e,"lines",[]),this.$set(e,"events",[]),t.forEach((function(t){if("node"==t.nodeType)Object.assign(t,{x:t.point.x,y:t.point.y}),e.nodes.push(n.addSubNode(t,e));else if("line"==t.nodeType){var i=t;i.linkInfo&&(i.linkInfo.fromOffset=parseFloat(i.linkInfo.fromOffset),i.linkInfo.toOffset=parseFloat(i.linkInfo.toOffset)),setTimeout((function(){n.$bus.$emit("addLine".concat(e.id),{id:i.id,type:i.type,name:i.name,path:i.path,from:i.from,fromType:i.fromType,to:i.to,linkInfo:i.linkInfo,attributes:i.attributes,parentNodeId:e.id})}),0)}else if("event"==t.nodeType){var s=new g["a"](t);s.parentNode=e,newNode.events.push(s)}})),this.nodeResize(e)},copyNewNode:function(e,t,n,i){e.dataTransfer&&e.dataTransfer.setDragImage(new Image,0,0);var s=e.target||e,o=s.cloneNode(!0);return o.setAttribute("draggable",!0),o.offset={x:n?n.x:0,y:n?n.y:0},i&&(o.copyNode=t),i||102!==t.type||(o.tool=t),o.className=o.className+" drag_nodeOuter",Object.assign(o.style,{position:"absolute",zIndex:9999,top:this.toPx(e.pageY-((t.padding||0)+o.offset.y)*this.scale),left:this.toPx(e.pageX-((t.padding||0)+o.offset.x)*this.scale),pointerEvents:"none",cursor:"move",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(o),this.$bus.$emit("isMoveNode",i?o.copyNode:o),o},startCopyNodes:function(e){this.isCopyNodes=!0,this.copyNodesPos={x:e.pageX,y:e.pageY}},createCopyNodes:function(e){var t=this,n=this.$store.state.flow.selectedList||null;n&&n.length>1&&(this.copyNodes=[],n.forEach((function(e){var n=document.querySelector('.nodeOuter[data-id="'.concat(e.id,'"]')),i={x:e.point.x*t.scale,y:e.point.y*t.scale},s=t.$store.getters["flow/getMousePointByPoint"](i);n.pageX=s.x,n.pageY=s.y;var o=t.copyNewNode(n,e,null,!0);o.point=s,t.copyNodes.push(o)})))},dragTool:function(e,t,n,i){this.dragNode=this.copyNewNode(e,t,n,i)},getDisplacement:function(e){var t={x:e.pageX,y:e.pageY},n=Object(h["c"])(this.copyNodesPos),i=Object(h["c"])(t);return{x:i.x-n.x,y:i.y-n.y}},nodesMove:function(e){var t=this,n=this.getDisplacement(e);(!this.copyNodes||this.copyNodes&&0===this.copyNodes.length)&&(Math.abs(n.x)>5||Math.abs(n.y)>5)&&this.createCopyNodes(e),this.copyNodes.forEach((function(e){e.copyNode;var i=e.offset,s={x:e.point.x+n.x-i.x*t.scale,y:e.point.y+n.y-i.y*t.scale};e.style.top=t.toPx(s.y),e.style.left=t.toPx(s.x)})),this.isCtrlKey=e.ctrlKey},dragToolOver:function(e){var t=this.dragNode,n=t.offset;t.style.top=this.toPx(e.pageY-n.y*this.scale),t.style.left=this.toPx(e.pageX-n.x*this.scale);var i=t.copyNode;if(this.endTarget=this.getTargetIsNodes(e.target,i||t.tool),this.endTarget){var s=this.endTarget&&this.endTarget.className;if(s.indexOf("nodes isSub")>-1){var o=Object(h["f"])(this.nodes,this.endTarget);this.$bus.$emit("dragToSubNode",i!==o?o:null)}else this.$bus.$emit("dragToSubNode",null);i&&this.$bus.$emit("moveCopyNode".concat(i.parentNodeId||""),e,i)}},getTargetIsNodes:function(e,t){var n=document.querySelector(".svgRoot");return n.contains(e)?t&&"102"==t.type&&e.className.indexOf("nodes isSub")>-1?this.getTargetIsNodes(e.parentElement):e.className.indexOf("nodes")>-1?e:this.getTargetIsNodes(e.parentElement):null},getBeforeCopyLine:function(e){var t=this,n=[];e.forEach((function(e){n=[].concat(Object(o["a"])(n),Object(o["a"])(e.out),Object(o["a"])(e.in))})),n=Object(o["a"])(new Set(n));var i=[],s=[],a=[];return n.forEach((function(n){var o=Object(h["d"])(t.lines,n);if(o){var l;l="event"===o.fromType?Object(h["d"])(t.events,o.from):Object(h["d"])(e,o.from);var r=Object(h["d"])(e,o.to);if(l&&r){var c=Object(h["a"])(o);c.id=u["h"].uuid(),i.push({line:c,nodeId:l.id}),s.push({line:c,nodeId:r.id}),a.push(c)}}})),{fromNodeIds:i,toNodeIds:s,newLines:a}},resetLineFromAndTo:function(e,t,n,i){e.length>0&&e.forEach((function(e){e.nodeId===i.id&&(n.in.push(e.line.id),e.line.from=n.id)})),t.length>0&&t.forEach((function(e){e.nodeId===i.id&&(n.out.push(e.line.id),e.line.to=n.id)}))},copyEventsLines:function(e){var t=this;e.forEach((function(e){if("event"===e.fromType){var n=Object(h["d"])(t.events,e.from,"fromId");n?(delete n.fromId,e.from=n.id):e.from=null}e.from&&e.to&&t.$bus.$emit("addLine",{id:e.id,type:e.type,name:e.name,from:e.from,fromType:e.fromType,to:e.to,linkInfo:e.linkInfo})}))},nodesMoveEnd:function(e){var t=this;if(this.copyNodes&&this.copyNodes.length>0){var n,i=this.copyNodes.map((function(e){return e.copyNode})),s=this.getBeforeCopyLine(i),o=s.fromNodeIds,a=s.toNodeIds,l=s.newLines,r=this.getDisplacement(e),c=[];this.copyNodes.forEach((function(e){var i=e.copyNode,s=(e.offset,{pageX:e.point.x+r.x,pageY:e.point.y+r.y}),l=t.nodeMoveEnd(s,e);l.id===i.id?n=!0:t.resetLineFromAndTo(o,a,l,i),t.checked=l,c.push(l)})),n||this.copyEventsLines(l),this.$store.commit("flow/setSelectedList",c)}this.isCopyNodes=!1,this.copyNodesPos=null,this.copyNodes=[],this.$bus.$emit("isMoveNode",!1)},nodeMoveEnd:function(e,t){var n,i,s,o,a=t&&t.copyNode;if(a){var l=t.offset;if(a.parentNodeId)this.deleteNode(a),delete a.id,delete a.parentNodeId,delete a.point,i=Object.assign(a,{x:e.pageX-l.x*this.scale>a.padding?e.pageX-l.x*this.scale:a.padding,y:e.pageY-l.y*this.scale>a.padding?e.pageY-l.y*this.scale:a.padding,mouseConvert:!0});else{var r=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX-l.x*this.scale,y:e.pageY-l.y*this.scale}),c=r;if(c={x:c.x>a.padding?c.x:a.padding,y:c.y>a.padding?c.y:a.padding},this.isCtrlKey){o=a.id;var d=u["h"].uuid(),f=JSON.parse(JSON.stringify(a));i=Object.assign({},f,{id:d,out:[],in:[],x:c.x,y:c.y}),i.attributes.BaseInfo.ID=d}else c={x:c.x/this.scale,y:c.y/this.scale},c=Object(h["c"])(c),a.point.x=c.x,a.point.y=c.y,this.$bus.$emit("nodeMove",a),s=!0}}if(!s){var p=e.target&&e.target.getAttribute("nodetype"),v=e.target&&e.target.getAttribute("sort");i=i||{type:p,sort:v,x:e.pageX,y:e.pageY,mouseConvert:!0},n=this.copyNodeNext(i,o,a)}return document.body.removeChild(t),this.resize(),s?a:n},copyNodeNext:function(e,t,n){var i=this,s=this.addNode(e);return this.nodes.push(s),t&&this.copyNodeEvent(t,s),n&&n.nodes&&n.nodes.length>0&&(s.nodes=[],n.nodes.forEach((function(e){var t=Object(h["a"])(e),n=Object.assign({x:t.point.x,y:t.point.y},t);s.nodes.push(i.addSubNode(n,s))}))),s},dragToolEnd:function(e){if(this.endTarget){var t=this.endTarget&&this.endTarget.className,n=Object(h["f"])(this.nodes,this.endTarget);if(t.indexOf("nodes isSub")>-1&&!this.verifySub(n)){if(n){var i,s;if(this.dragNode&&this.dragNode.copyNode){var o=this.dragNode.copyNode,a=this.dragNode.offset;if(!o.parentNodeId||o.parentNodeId&&o.parentNodeId!==n.id)i=Object.assign(o,{x:e.pageX-a.x*this.scale>o.padding?e.pageX-a.x*this.scale:o.padding,y:e.pageY-a.y*this.scale>o.padding?e.pageY-a.y*this.scale:o.padding,mouseConvert:!0}),this.deleteNode(o),delete o.id;else{i={x:e.pageX-a.x*this.scale,y:e.pageY-a.y*this.scale,mouseConvert:!0};var l=this.getOptions(i);o.point.x=l.x-n.point.x,o.point.y=l.y-n.point.y-n.imgHeight-2*n.padding,this.$bus.$emit("nodeMove".concat(o.parentNodeId),o),this.$bus.$emit("cutOffLine".concat(o.parentNodeId),o),s=!0}}if(!s){var r=e.target&&e.target.getAttribute("nodetype"),c=e.target&&e.target.getAttribute("sort");i=i||{type:r,sort:c,x:e.pageX,y:e.pageY,mouseConvert:!0};var d=this.addSubNode(i,n);n.nodes?n.nodes.push(d):this.$set(n,"nodes",[d]),this.$set(n,"lines",n.lines||[]),this.$set(n,"events",n.events||[]),this.nodeResize(n),this.$bus.$emit("cutOffLine".concat(d.parentNodeId),d)}}document.body.removeChild(this.dragNode)}else(t.indexOf("nodes")>-1||t.indexOf("nodes isSub")>-1&&this.verifySub(n))&&(this.checked=this.nodeMoveEnd(e,this.dragNode),this.$bus.$emit("cutOffLine",this.checked),this.$store.commit("flow/setSelectedList",[this.checked]))}else document.body.removeChild(this.dragNode);this.dragNode=null,this.$bus.$emit("isMoveNode",!1)},dragBoundaryEvent:function(e,t){e.dataTransfer&&e.dataTransfer.setDragImage(new Image,0,0),this.dragEvent=e.target.cloneNode(!0),this.dragEvent.className="ds_tool_event_drag",this.dragEvent.setAttribute("draggable",!1);var n=Object(h["a"])(t);this.cloneObj=new g["a"](n,e),Object.assign(this.dragEvent.style,{position:"absolute",zIndex:9999,width:this.toPx(this.cloneObj.width),height:this.toPx(this.cloneObj.height),top:this.toPx(e.pageY-e.offsetY),left:this.toPx(e.pageX-e.offsetX),pointerEvents:"none",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(this.dragEvent),this.$bus.$emit("startMoveEvent",this.dragEvent)},dragEventOver:function(e){if(this.dragEvent){var t=this.computedPoint(e,this.dragEvent);if(Array.from(e.target.classList).indexOf("task-node")>-1||Array.from(e.target.parentElement).indexOf("node")){var n=Object(h["e"])(this.nodes,"nodes",e.target);if(n&&!this.verifySub(n.parent)){var i=n.parent,s=n.sub;this.crashNode=s;var o=this.$store.getters["flow/getPoints"](s.id);o||(this.$store.commit("flow/setPointsByNode",{node:s,obj:this.cloneObj}),o=this.$store.getters["flow/getPoints"](s.id));var a={point:{x:t.point.x-i.point.x*this.scale,y:t.point.y-(i.point.y+i.padding+i.imgHeight+2*i.padding)*this.scale}},l=this.getPoint(a,o,this.distance);if(l){this.cloneObj=Object.assign(this.cloneObj,l,{parentNode:i});var r=this.$store.getters["flow/getMousePointByPoint"](l.point);return r.x=r.x+i.point.x*this.scale,r.y=r.y+(i.point.y+i.imgHeight+2*i.padding)*this.scale,this.dragEvent.style.top=this.toPx(r.y),void(this.dragEvent.style.left=this.toPx(r.x))}}var c=Object(h["f"])(this.nodes,e.target);if(c){this.crashNode=c;var d=this.$store.getters["flow/getPoints"](c.id);d||(this.$store.commit("flow/setPointsByNode",{node:c,obj:this.cloneObj}),d=this.$store.getters["flow/getPoints"](c.id));var u=this.getPoint(t,d,this.distance);if(u){this.cloneObj=Object.assign(this.cloneObj,u);var f=this.$store.getters["flow/getMousePointByPoint"](u.point);return this.dragEvent.style.top=this.toPx(f.y),void(this.dragEvent.style.left=this.toPx(f.x))}}}this.dragEvent.style.top=this.toPx(e.pageY),this.dragEvent.style.left=this.toPx(e.pageX)}},dragEventEnd:function(e){var t=this;if("drop"===e.type?(e=event||e,e.preventDefault()):event.touches&&(e=event.touches[0]?event.touches[0]:event),this.crashNode){var n=this.$store.getters["flow/getPoints"](this.crashNode.id),i=this.computedPoint(e,this.cloneObj);if(this.cloneObj.parentNode){var s=this.cloneObj.parentNode;i={point:{x:i.point.x-s.point.x*this.scale,y:i.point.y-(s.point.y+s.padding+s.imgHeight+2*s.padding)*this.scale}}}var o=this.getPoint(i,n,this.distance);if(o){if(n.splice(n.indexOf(o),1),this.cloneObj.from){var a=this.cloneObj.parentNode?this.cloneObj.parentNode.events:this.events;a.forEach((function(e){e.id===t.cloneObj.from&&t.$store.commit("flow/addPoint",{id:t.cloneObj.nodeId,obj:{point:{x:e.point.x,y:e.point.y},index:e.index,direction:e.direction}})})),this.deleteEvent(this.cloneObj.from,a),this.cloneObj.id=this.cloneObj.from,delete this.cloneObj.from}this.cloneObj=Object.assign(this.cloneObj,o),this.cloneObj.point.x=this.cloneObj.point.x/this.scale,this.cloneObj.point.y=this.cloneObj.point.y/this.scale,this.cloneObj.nodeId=this.crashNode.id,this.addNewEvent(this.cloneObj),this.checked=this.cloneObj,this.cloneObj.out&&this.cloneObj.out.length>0&&this.$bus.$emit("eventMove".concat(this.cloneObj.parentNode?this.cloneObj.parentNode.id:""),this.cloneObj)}}},addNewEvent:function(e){e.parentNode?this.nodes.forEach((function(t){e.parentNode&&e.parentNode.id===t.id&&t.events.push(e)})):this.events.push(e)},dragCloneEvent:function(e,t){var n=Object(h["a"])(t);n.from=t.id,n.id=u["h"].uuid(),this.dragBoundaryEvent(e,n)},copyNodeEvent:function(e,t){var n=this,i=[];if(this.events.forEach((function(t){t.nodeId===e&&i.push(Object(h["a"])(t))})),0!==i.length){this.$store.commit("flow/setPointsByNode",{node:t,obj:i[0]});var s=this.$store.getters["flow/getPoints"](t.id);s.forEach((function(e){i.forEach((function(i){i.direction===e.direction&&i.index===e.index&&(i.fromId=i.id,i.id=u["h"].uuid(),i.point=e.point,i.nodeId=t.id,n.addNewEvent(i))}))}))}},getPoint:function(e,t,n){var i,s=this,o=0;return t.forEach((function(t){var a=s.getDistance(t,e);a<=n&&o<a&&(o=a,i=t)})),i},getDistance:function(e,t){var n=Math.sqrt(Math.pow(e.point.x-t.point.x,2)+Math.pow(e.point.y-t.point.y,2));return n},computedPoint:function(e,t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});return{point:Object(h["c"])(n)}},getOptions:function(e){var t=Object.assign({id:u["h"].uuid(),type:1},e),n={x:t.x||0,y:t.y||0};if(1==t.mouseConvert){var i=this.$store.getters["flow/getMousePointByCanvas"]({x:t.x,y:t.y});n.x=i.x,n.y=i.y}return n=Object(h["c"])(n),t.x=n.x/this.scale,t.y=n.y/this.scale,t},addNode:function(e){var t=this.getOptions(e),n=t.type;t.name=t.name||("201"===n?"开始":"299"===n?"结束":"")||"新建环节"+this.nodes.length;var i=new d["a"](t);return i},addSubNode:function(e,t){var n=this.getOptions(e);n.name=n.name||"新建环节"+(t.nodes&&t.nodes.length||0),1==n.mouseConvert&&(n.x=n.x-t.point.x,n.y=n.y-t.point.y-t.imgHeight-2*t.padding);var i=new d["a"](n);return i.parentNodeId=t.id,i},showSubNode:function(e){},keydown:function(e){var t=this;if((!this.checked||!this.checked.readOnly)&&46==e.keyCode){var n=this.$store.state.flow.selectedList||null;if(n&&n.length>1)n.forEach((function(e){setTimeout((function(){t.deleteNode(e)}),0)}));else if(this.checked instanceof d["a"])this.deleteNode(this.checked,!0);else if(this.checked instanceof v)this.$store.commit("flow/deleteLane",this.checked),this.resize();else if(this.checked instanceof b["a"])this.deleteLine(this.checked,!0);else if(this.checked instanceof g["a"]){for(var i=this.checked,s=i["out"].length-1;s>=0;s--){var o=Object(h["d"])(this.lines,i["out"][s]);o&&this.deleteLine(o)}var a=this.checked.parentNode?this.checked.parentNode.events:this.events;this.deleteEvent(this.checked.id,a,!0)}this.checked={}}},deleteNode:function(e,t){var n,i=this;if(!(e.parentNodeId&&(n=this.nodes.find((function(t){return e.parentNodeId===t.id})),t&&this.verifySub(n)))){var s=e.parentNodeId?n.nodes:this.nodes,o=e.parentNodeId?n.lines:this.lines,a=e.parentNodeId?n.events:this.events,l=s.indexOf(e);if(l>-1){var r=e;r.in.length>0&&r.out.length>0&&r.in.forEach((function(t){var n=Object(h["d"])(o,t);if(n){var a=Object(h["d"])(s,n.from);r.out.forEach((function(t){var l=Object(h["d"])(o,t);if(l){var r=Object(h["d"])(s,l.to),c=u["h"].uuid(),d={endPoint:l.path[l.path.length-1],fromDirection:n.linkInfo.fromDirection,fromNode:a,startPoint:n.path[0],targetDirection:l.linkInfo.toDirection,targetNode:r},f=Object(A["a"])(d),p={id:c,type:n.type,name:a.name+"→"+r.name,path:f,from:n.from,fromType:n.fromType,isHide:n.isHide,to:l.to,linkInfo:{fromDirection:n.linkInfo.fromDirection,fromOffset:n.linkInfo.fromOffset,toDirection:l.linkInfo.toDirection,toOffset:l.linkInfo.toOffset},attributes:Object.assign(n.attributes,{BaseInfo:{EndNodeID:l.to,ID:c,Name:a.name+"→"+r.name,StartNodeID:n.from}})};e.parentNodeId&&(p.parentNodeId=e.parentNodeId),i.$bus.$emit("addLine".concat(e.parentNodeId||""),p)}}))}}));for(var c=r.out.length-1;c>=0;c--){var d=Object(h["d"])(o,r.out[c]);d&&this.deleteLine(d)}for(var f=r.in.length-1;f>=0;f--){var p=Object(h["d"])(o,r.in[f]);p&&this.deleteLine(p)}for(var v=0;v<a.length;v++){var b=a[v].nodeId;if(b===r.id){for(var g=a[v],m=g.out.length-1;m>=0;m--){var y=Object(h["d"])(this.lines,g.out[m]);y&&this.deleteLine(y)}a.splice(v,1),v--}}s.splice(l,1)}}},deleteLine:function(e,t){var n;if(!(e.parentNodeId&&(n=this.nodes.find((function(t){return e.parentNodeId===t.id})),t&&this.verifySub(n)))){e.remove();var i=e.parentNodeId?n.nodes:this.nodes,s=e.parentNodeId?n.lines:this.lines,o=s.indexOf(e);o>-1&&this.deleteFromOrOut(i,s,e,o)}},deleteFromOrOut:function(e,t,n,i){var s=Object(h["d"])(e,n.from),o=Object(h["d"])(e,n.to);if(s){var a=s["out"].indexOf(n.id);a>=0&&s["out"].splice(a,1)}if(o){var l=o["in"].indexOf(n.id);l>=0&&o["in"].splice(l,1)}t.splice(i,1),this.$bus.$emit("updateIntersection")},deleteEvent:function(e,t,n){var i=(t||this.events).findIndex((function(t){return t.id===e}));i>-1&&(t||this.events).splice(i,1),this.$store.commit("flow/addPoint",{id:this.checked.nodeId,obj:{point:{x:this.checked.point.x,y:this.checked.point.y},index:this.checked.index,direction:this.checked.direction}})},addLane:function(e,t){this.createLane({direction:e,index:t})},createLane:function(e){var t=e.direction;e.name=e.name||"泳道"+(this.lanes[t].length+1),e.id=e.id||u["h"].uuid();var n=new v(e),i=this.lanes[t][(e.index||this.lanes[t].length)-1];t==u["a"].vertical?n.left=i?i.size+i.left:0:n.top=i?i.size+i.top:0,this.$store.commit("flow/addLane",{direction:t,lane:n,index:e.index}),this.resize()},onScroll:function(e){var t=e.target;this.$store.commit("flow/setSvgRoot",{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft})},getFromNodes:function(e){if(!e["in"]||e["in"].length<=0)return null;for(var t=[],n=0;n<e["in"].length;n++){var i=e["in"][n],s=Object(h["d"])(this.lines,i);if(s){var o=Object(h["d"])(this.nodes,s.from);t.push(o)}}return t},getToNodes:function(e){if(!e["out"]||e["out"].length<=0)return null;for(var t=[],n=0;n<e["out"].length;n++){var i=e["out"][n],s=Object(h["d"])(this.lines,i);if(s){var o=Object(h["d"])(this.nodes,s.to);t.push(o)}}return t},getFlowAllObjectMap:function(e){for(var t={},n=0;n<e.nodes.length;n++){var i=e.nodes[n];t[i.id]=i}for(var s=0;s<e.lines.length;s++){var o=e.lines[s];t[o.id]=o}for(var a=0;a<e.lanes.horizontal.length;a++){var l=e.lanes.horizontal[a];t[l.id]=l}for(var r=0;r<e.lanes.vertical.length;r++){l=e.lanes.vertical[r];t[l.id]=l}return t},drawLine:function(){this.isDrawLine=!this.isDrawLine},resize:function(){var e=this.$store.state.flow.page.width,t=this.$store.state.flow.page.height,n=e||0,i=t||0,s=this.lanes.vertical[this.lanes.vertical.length-1],o=this.$store.getters["flow/lanesWidth"];s&&s.size+s.left+o>n?this.width=s.size+s.left+o:this.width=e;var a=this.lanes.horizontal[this.lanes.horizontal.length-1],l=this.$store.getters["flow/lanesHeight"];a&&a.size+a.top+l>i?this.height=a.size+a.top+l:this.height=t;var r=0,c=0;this.nodes.forEach((function(e){e.width+e.point.x+2*e.padding>r&&(r=e.width+e.point.x+2*e.padding),e.height+e.point.y+2*e.padding+20>c&&(c=e.height+e.point.y+2*e.padding+20)})),this.width=this.width>r?this.width:r,this.height=this.height>c?this.height:c},nodeResize:function(e){var t=0,n=0;e.nodes.forEach((function(i){i.width+i.point.x+2*i.padding>t&&(t=i.width+i.point.x+2*i.padding),i.height+i.point.y+2*i.padding+20+e.imgHeight+2*e.padding>n&&(n=i.height+i.point.y+2*i.padding+20+e.imgHeight+2*e.padding)})),e.width=e.width>t?e.width:t,e.height=e.height>n?e.height:n,this.$bus.$emit("nodeMove",e)},autoScroll:function(e){var t=null,n=e.type;"node"==n?(t=e.point,e.mouse.x>this.width/2?t.x=t.x+e.data.width+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+e.data.height+this.maxSizeOffset:t.y=t.y):"line"==n?(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x-this.maxSizeOffset,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y-this.maxSizeOffset):"lane"==n&&(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y);var i,s,o,a=this.$refs.ds_page;t.x<a.scrollLeft&&(i=Math.abs(a.scrollLeft-t.x),s=a.scrollLeft,a.scrollLeft=s-i/3),t.y<a.scrollTop&&(i=Math.abs(a.scrollTop-t.y),o=a.scrollTop,a.scrollTop=o-i/3),t.h<a.scrollTop&&(i=Math.abs(a.scrollLeft-t.x),s=a.scrollLeft,a.scrollLeft=s-i/3),t.x>a.clientWidth+a.scrollLeft&&(this.width=t.x,i=Math.abs(a.clientWidth+a.scrollLeft-t.x),s=a.scrollLeft,a.scrollLeft=s+i/3),t.y>a.clientHeight+a.scrollTop&&(this.height=t.y,i=Math.abs(a.clientHeight+a.scrollTop-t.y),o=a.scrollTop,a.scrollTop=o+i/3)},parentAutoScroll:function(e){var t=e.mouse,n=e.point,i=e.parent,s=e.node;n.x>i.width+i.point.x?n.x=n.x+s.width+this.maxSizeOffset:n.x=n.x,n.y>i.height+i.point.y?n.y=n.y+s.height+this.maxSizeOffset:n.y=n.y,n.x>i.width+0&&(i.width=n.x),n.y>i.height+0&&(i.height=n.y),this.$bus.$emit("nodeMove",i),this.autoScroll({type:"node",data:i,mouse:{x:t.x,y:t.y},point:{x:n.x,y:n.y}})},setCursor:function(e){if("svg"!=e.target.tagName){e.target.className;if("path"==e.target.tagName){var t=Object(h["g"])(e.target);if(t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});t.type==u["d"].horizontal?0==t.index&&Math.abs(t.sp.x-n.x)<=this.dragSize||t.isLast&&Math.abs(t.ep.x-n.x)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ns-resize"):0==t.index&&Math.abs(t.sp.y-n.y)<=this.dragSize||t.isLast&&Math.abs(t.ep.y-n.y)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ew-resize")}}}else this.setRootCursor("default")},setRootCursor:function(e){this.$refs.root.style.cursor=e},startGlobalMove:function(e){this.isGlobalPosMove=!0,this.globalPos=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY}),this.globalMoveLastMouse={x:e.pageX,y:e.pageY},this.globalRect=this.getRect()},globalMove:function(e){if(this.isGlobalPosMove){var t={x:e.pageX,y:e.pageY},n=Object(h["c"])(this.globalMoveLastMouse),i=Object(h["c"])(t),s={x:i.x-n.x,y:i.y-n.y};Number.MIN_VALUE,Number.MIN_VALUE;if(0==s.x&&0==s.y)return!1;var o=!1,a=!1;return this.globalRect.x+s.x>0&&(this.globalRect.x+=s.x,o=!0),this.globalRect.y+s.y>=0&&(this.globalRect.y+=s.y,a=!0),this.$bus.$emit("globalMove",s,o,a,e),void(this.globalMoveLastMouse=i)}},getRect:function(){for(var e=Number.MAX_VALUE,t=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MIN_VALUE,s=0;s<this.nodes.length;s++){var o=this.nodes[s];o.point.x<e&&(e=o.point.x),o.point.x+o.width>n&&(n=o.point.x+o.width),o.point.y<t&&(t=o.point.y),o.point.y+o.height>i&&(i=o.point.y+o.height)}for(var a=0;a<this.lines.length;a++)for(var l=this.lines[a],r=0;r<l.path.length;r++)l.path[r].x<e&&(e=l.path[r].x),l.path[r].x>n&&(n=l.path[r].x),l.path[r].y<t&&(t=l.path[r].y),l.path[r].y>i&&(i=l.path[r].y);return{x:e,y:t,width:n,height:i}},getWheelDirect:function(e){var t;return e=e||window.event,e.wheelDelta?(e.wheelDelta>0&&(t="up"),e.wheelDelta<0&&(t="down")):e.detail&&(e.detail>0&&(t="up"),e.detail<0&&(t="down")),t},scrollwheel:function(e){if(e=e||window.event,e.wheelDelta&&e.ctrlKey){e.preventDefault();var t=this.getWheelDirect(e);this.rootScale(t)}},rootScale:function(e){this.scale=Number("up"===e?(this.scale+.05<2?this.scale+.05:2).toFixed(2):(this.scale>.4?this.scale-.05:.4).toFixed(2)),this.$store.commit("flow/setPage",{scale:this.scale}),this.$store.commit("flow/clearPoints")},selectGlobalMove:function(e){if(this.globalSelect||(this.globalSelect=document.createElement("div"),this.globalSelect.className="select-nodes",Object.assign(this.globalSelect.style,{zIndex:9999,transform:"translate3d(".concat(this.selectGlobalPos.x/this.scale,"px, ").concat(this.selectGlobalPos.y/this.scale,"px, 0)"),pointerEvents:"none"}),this.$refs.root.appendChild(this.globalSelect)),this.selectGlobalPos){var t,n,i,s,o=this.selectGlobalPos,a=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});a.x>o.x?(n=o.x,i=a.x-o.x):(n=a.x,i=o.x-a.x),a.y>o.y?(t=o.y,s=a.y-o.y):(t=a.y,s=o.y-a.y),this.selectGlobalPonits.start.x=n/this.scale,this.selectGlobalPonits.start.y=t/this.scale,this.selectGlobalPonits.end.x=(n+i)/this.scale,this.selectGlobalPonits.end.y=(t+s)/this.scale,Object.assign(this.globalSelect.style,{transform:"translate3d(".concat(n/this.scale,"px, ").concat(t/this.scale,"px, 0)"),width:this.toPx(i/this.scale),height:this.toPx(s/this.scale)})}},selectGlobalEnd:function(e){if(this.isGlobalSelect=!1,this.globalSelect){this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});this.$bus.$emit("selectGlobal",this.selectGlobalPonits.start,this.selectGlobalPonits.end),this.$refs.root.removeChild(this.globalSelect),this.globalSelect=null}},documentCopy:function(e){var t=this.$store.state.flow.selectedList;t&&t.length>1?this.ctrlCopyNodes=Object(o["a"])(t):this.ctrlCopyNodes=[this.checked]},pasteNode:function(e){var t=this;if(!this.ctrlCopyNodes)return!1;var n=[],i=this.getBeforeCopyLine(this.ctrlCopyNodes),s=i.fromNodeIds,o=i.toNodeIds,a=i.newLines;this.ctrlCopyNodes.forEach((function(e){var i=e,a=i.id,l=u["h"].uuid(),r=JSON.parse(JSON.stringify(i)),c=Object.assign({},r,{id:u["h"].uuid(),out:[],in:[],x:i.point.x+10,y:i.point.y+10});c.attributes.BaseInfo.ID=l;var d=t.copyNodeNext(c,a,i);t.resetLineFromAndTo(s,o,d,i),n.push(d),t.checked=d})),this.copyEventsLines(a),this.ctrlCopyNodes=n,this.$store.commit("flow/setSelectedList",n)}},c["a"])},W=G,H=(n("0e0b"),Object(O["a"])(W,i,s,!1,null,null,null));t["default"]=H.exports},9183:function(e,t,n){},"95b1":function(e,t,n){"use strict";n("9183")},a1a1:function(e,t,n){},e77e:function(e,t,n){"use strict";(function(e){n("4160"),n("13d5"),n("4e82"),n("159b");function i(){var t=this.sID,n=this.flowInfo.BaseInfo.Name,i=dsf.url.getWebPath("wfk/exportJsonWF");e("<form action="+i+' method="get"><input type="text" name="sID" value="'+t+'"/><input type="text" name="zipName" value="'+n+'"/></form>').appendTo("body").submit().remove()}function s(e,t){var n=this;e.forEach((function(e){e.point.x=t,n.$bus.$emit("nodeMove",e)}))}function o(e,t){var n=this;e.forEach((function(e){e.point.x=t-e.width,n.$bus.$emit("nodeMove",e)}))}function a(e,t){var n=this;e.forEach((function(e){e.point.y=t,n.$bus.$emit("nodeMove",e)}))}function l(e,t){var n=this;e.forEach((function(e){e.point.y=t-e.height,n.$bus.$emit("nodeMove",e)}))}function r(e,t){var n=this;e.forEach((function(e){e.point.y=t-e.height/2,n.$bus.$emit("nodeMove",e)}))}function c(e,t){var n=this;e.forEach((function(e){e.point.x=t-e.width/2,n.$bus.$emit("nodeMove",e)}))}function d(e){var t=this,n=e.sort((function(e,t){return e.point.x-t.point.x})),i=[];n.reduce((function(e,t){var n=t.point.x-(e.point.x+e.width);return i.push(n),t})),console.log(i);var s=i.reduce((function(e,t){return e+t}))/i.length;console.log(s),n.forEach((function(e,i){0!==i&&i!==n.length-1&&(e.point.x=n[i-1].point.x+n[i-1].width+s,t.$bus.$emit("nodeMove",e))}))}function u(e){var t=this,n=e.sort((function(e,t){return e.point.y-t.point.y})),i=[];n.reduce((function(e,t){var n=t.point.y-(e.point.y+e.height);return i.push(n),t})),console.log(i);var s=i.reduce((function(e,t){return e+t}))/i.length;console.log(s),n.forEach((function(e,i){0!==i&&i!==n.length-1&&(e.point.y=n[i-1].point.y+n[i-1].height+s,t.$bus.$emit("nodeMove",e))}))}function h(e){console.log(e);var t=this.$store.state.flow.selectedList,n=0,i=0,s=0,o=0,a=0,l=0;switch(t.forEach((function(e,t){var a=e.width,l=e.height,r=e.point,c=r.x,d=r.y;0===t&&(n=d,o=c,i=c+a,s=d+l),o>c&&(o=c),n>d&&(n=d),i<c+a&&(i=c+a),s<d+l&&(s=d+l)})),a=(n+s)/2,l=(o+i)/2,e){case"left":this.alignLeft(t,o);break;case"top":this.alignTop(t,n);break;case"right":this.alignRight(t,i);break;case"bottom":this.alignBottom(t,s);break;case"middle":this.alignMiddle(t,a);break;case"center":this.alignCenter(t,l);break;case"horizontal":this.alignHorizontal(t);break;case"vertical":this.alignVertical(t);break}console.log(n,o,i,s,a,l)}t["a"]={exportFlowJson:i,alignment:h,alignLeft:s,alignRight:o,alignTop:a,alignBottom:l,alignMiddle:r,alignCenter:c,alignHorizontal:d,alignVertical:u}}).call(this,n("1157"))},ef29:function(e,t,n){"use strict";n("5a4d")}}]);
//# sourceMappingURL=Flow.js.map