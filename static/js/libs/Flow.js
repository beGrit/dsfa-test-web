/*! Build time : Sat Aug 22 2020 19:39:07 GMT+0800 (GMT+08:00) */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Flow"],{"18c6":function(e,t,n){},"1b78":function(e,t,n){},"21d6":function(e,t,n){"use strict";var s=n("1b78"),i=n.n(s);i.a},"22df":function(e,t,n){"use strict";var s=n("b858"),i=n.n(s);i.a},"4c53":function(e,t,n){"use strict";var s=n("23e7"),i=n("857a"),o=n("af03");s({target:"String",proto:!0,forced:o("sub")},{sub:function(){return i(this,"sub","","")}})},6062:function(e,t,n){"use strict";var s=n("6d61"),i=n("6566");e.exports=s("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},7105:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_workflow ds-designer",attrs:{id:"desginer"}},[n("div",{staticClass:"designer-head"},[n("div",{staticClass:"desginer_tools"},[n("a",{staticClass:"ds-button__icon-text",on:{click:e.doSave}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("保存")])]),e._m(0),e._m(1),e._m(2),e._m(3),n("a",{staticClass:"ds-button__icon-text",class:{selected:e.isDrawLine},on:{click:e.drawLine}},[n("i",{staticClass:"iconfont icon-liujisuan"}),n("span",[e._v("连线")])]),n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),e._m(4),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.addLane("vertical")}}},[n("span",[e._v("泳道(垂直)")])]),n("dd",{on:{click:function(t){return e.addLane("horizontal")}}},[n("span",[e._v("泳道(水平)")])])])]),n("a",{staticClass:"ds-button__icon-text scale"},[n("div",{staticClass:"scale-com"},[n("i",{staticClass:"el-icon-minus",class:{disabled:e.scale<=.4},on:{click:function(t){return e.rootScale("down")}}}),n("span",{staticClass:"percent"},[e._v(e._s(Math.round(100*e.scale))+"%")]),n("i",{staticClass:"el-icon-plus",class:{disabled:e.scale>=2},on:{click:function(t){return e.rootScale("up")}}})]),n("span",[e._v("缩放")])]),n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-dakai"}),e._m(5),n("dl",{staticClass:"layui-nav-child"},[n("p",{on:{click:function(t){return e.exportFlow()}}},[n("span",[e._v("创建组")])]),n("p",{staticClass:"label",on:{click:function(t){return e.saveAsFlow()}}},[n("span",[e._v("保存为组件")])]),n("p",{on:{click:function(t){return e.openFlow()}}},[n("span",[e._v("选择组")])])])]),n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),e._m(6),n("dl",{staticClass:"layui-nav-child"},[n("p",{on:{click:function(t){return e.exportFlow()}}},[n("span",[e._v("导出")])]),n("p",{staticClass:"child"},[e._v("DFR")]),n("p",{staticClass:"child"},[e._v("BPMN2.0")]),n("p",{staticClass:"child"},[e._v("XML")]),n("p",{staticClass:"label child"},[e._v("JSON")]),n("p",{on:{click:function(t){return e.openFlow()}}},[n("span",[e._v("导入")])]),n("p",{staticClass:"child"},[e._v("DFR")]),n("p",{staticClass:"child"},[e._v("BPMN2.0")]),n("p",{staticClass:"child"},[e._v("XML")]),n("p",{staticClass:"label child"},[e._v("JSON")]),n("p",{staticClass:"label",on:{click:function(t){return e.startTestFlow()}}},[n("span",[e._v("仿真测试")])]),n("p",{on:{click:function(t){return e.monitorFlow()}}},[n("span",[e._v("浏览监控")])])])])])]),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"designer-center"},[n("div",{ref:"ds_page",staticClass:"ds_control ds_page layui-form leftRight_ design",on:{scroll:function(t){return e.onScroll(t)}}},[n("div",{ref:"container",staticClass:"flow",style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale),transform:"scale("+e.scale+") translateZ(0)",transformOrigin:"left top"},attrs:{id:"flow_box"}},[n("div",{ref:"root",staticClass:"root",class:{has_v_head:e.lanes&&e.lanes.vertical.length>0,has_h_head:e.lanes&&e.lanes.horizontal.length>0},style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale)}},[e.baseLine.showV?n("span",{staticClass:"baseLine_v",style:{transform:"translate3d("+e.baseLine.left+"px, 0, 0)"}}):e._e(),e.baseLine.showH?n("span",{staticClass:"baseLine_h",style:{transform:"translate3d(0, "+e.baseLine.top+"px, 0)"}}):e._e(),n("flow-content",{ref:"flowContent",attrs:{"flow-info":e.flowInfo,"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,lanes:e.lanes,events:e.events,checked:e.checked,config:e.config}}),n("div",{ref:"backLayout",staticClass:"backgroundLayout"},[n("div",{ref:"v_lane",staticClass:"v_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.vertical,checked:e.checked},on:{addLane:e.addLane}})],1),n("div",{ref:"h_lane",staticClass:"h_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.horizontal,checked:e.checked},on:{addLane:e.addLane}})],1)])],1)])])]),n("div",{staticClass:"designer-left"},[n("div",{staticClass:"designer-left-tools"},[n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[e._l(e.flowTools,(function(t,s){return n("el-collapse-item",{key:s,attrs:{title:t.title,name:s}},[n("div",{staticClass:"layui-colla-content layui-show"},[e._l(t.data,(function(t){return n("div",{key:t.type,staticClass:"ds_tool_item nodeButton",attrs:{title:t.name,sort:t.sort,nodetype:t.type,draggable:"true"},on:{dragstart:function(n){return e.dragTool(n,t)}}},[n("img",{attrs:{src:t.img,draggable:"false"}}),e._v(" "+e._s(t.name)+" ")])})),n("div",{staticStyle:{clear:"both"}})],2)])})),n("el-collapse-item",{attrs:{title:"边界事件",name:"5"}},[n("div",{staticClass:"layui-colla-content layui-show"},e._l(e.boundaryEvents,(function(t){return n("div",{key:t.type,staticClass:"nodeButton ds_tool_event",attrs:{title:t.name,nodetype:t.type}},[n("div",{staticClass:"tool_event_drag",attrs:{draggable:"true"},on:{dragstart:function(n){return e.dragBoundaryEvent(n,t)}}},[n("img",{attrs:{src:t.url,draggable:"false"}})]),n("span",[e._v(e._s(t.name))])])})),0)])],2)],1)]),n("div",{staticClass:"designer-right",attrs:{id:"propertyBox"}},[n("flow-info",{attrs:{checked:e.checked,nodes:e.nodes,lines:e.lines,"flow-info":e.flowInfo}})],1)])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("发布")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),n("span",[e._v(" 版本 "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("p",{staticClass:"label"},[n("span",[e._v("当前版本")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",{staticClass:"label"},[n("span",[e._v("历史版本")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])]),n("p",[n("span",[e._v("2.0.11 2020-4-10 16：20： 10")])])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-shebeikaifa1"}),n("span",[e._v("模板库")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"ds-button__icon-text"},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("关闭")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 泳道 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 组件 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 更多 "),n("i",{staticClass:"iconfont icon-xia1"})])}],o=(n("99af"),n("7db0"),n("c740"),n("4160"),n("a630"),n("c975"),n("d81d"),n("a434"),n("b0c0"),n("a9e3"),n("b680"),n("d3b7"),n("acd8"),n("6062"),n("3ca3"),n("4c53"),n("159b"),n("ddb0"),n("4795"),n("2909")),a=(n("96cf"),n("1da1")),l=n("5530"),r=n("2f62"),c=n("dd8c"),d=n("1f8f"),h=n("1485"),u=n("a341"),f=function(e){var t=Object.assign({size:260,direction:d["a"].vertical},e);this.id=t.id||null,this.name=t.name||"",this.index=t.index,this.direction=t.direction,this.isRender=!1,this.size=t.size,t.attributes?this.attributes=Object(l["a"])({},t.attributes):(this.attributes=Object(h["b"])(Object(u["d"])()),this.attributes.Name=this.name,this.attributes.ID=this.id)},p=f,v=n("6550"),g=n("d8d9"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_attr_root"},[n("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.status,expression:"status === 'base'"}],staticClass:"base"},[n("p",{staticClass:"title"},[n("span",[e._v("常用")]),n("el-button",{staticClass:"el-button-all",attrs:{size:"mini",round:""},on:{click:function(t){e.status="advanced"}}},[n("span",[e._v("全部")]),n("i",{staticClass:"el-icon-arrow-right"})])],1),n("div",{staticClass:"el-collapse-item__content"},e._l(e.data,(function(t,s){return n("el-form",{key:s,staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,s){return n("div",{key:s,staticClass:"property-item"},[!t.hide&&t.isBase?n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},nativeOn:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",min:1,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,s){return n("el-radio",{key:s,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,s){return n("el-checkbox",{key:s,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:t.class,attrs:{type:"auxiliary",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" 设置 ")]):e._e()],1):e._e()],1)})),0)})),1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:"advanced"===e.status,expression:"status === 'advanced'"}],staticClass:"advanced"},[n("p",{staticClass:"title"},[n("span",[e._v("全部")]),n("el-button",{staticClass:"el-button-base",attrs:{size:"mini",round:""},on:{click:function(t){e.status="base"}}},[n("i",{staticClass:"el-icon-arrow-left"}),n("span",[e._v("常用")])])],1),n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.data,(function(t){return n("el-collapse-item",{key:t.name,attrs:{title:t.name,name:t.name}},[n("el-form",{staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,s){return n("div",{key:s,staticClass:"property-item"},[t.hide?e._e():n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},nativeOn:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",min:1,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,s){return n("el-radio",{key:s,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,s){return n("el-checkbox",{key:s,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:t.class,attrs:{type:"auxiliary",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" 设置 ")]):e._e()],1)],1)})),0)],1)})),1)],1)])},m=[],y=(n("a15b"),n("b64b"),n("ac1f"),n("1276"),n("907c")),x={name:"FlowInfo",components:{DsfDesignerDialog:y["a"]},props:{checked:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}},nodes:{type:Array,default:function(){return[]}},lines:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:["1"],curSelectObj:null,curNodeObj:null,curElement:null,AppInfo:null,data:[],status:"base",showHeplerMark:!1}},computed:{minValue:function(){return function(e,t){return 0===t?Number(e.oldValue.split(".")[0]):e.value0>Number(e.oldValue.split(".")[0])&&1===t?0:Number(e.oldValue.split(".")[1])}}},watch:{checked:function(e){this.loadPropertyWindow(e)}},mounted:function(){var e=this;this.$bus.$on("updateName",(function(t){e.loadPropertyWindow(t)}))},methods:{show:function(e){return!e.nodeType&&"Version"!==e.nodeName2&&!e.editor&&"dialog"!==e.type||!e.unit&&"text"===e.editor||"numberbox"===e.editor},loadPropertyWindow:function(e){0!==Object.keys(e).length&&(this.curSelectObj=e||null,this.curNodeObj=e?e.attributes:null,this.loadPropertyDom(e?this.setPropertyData(e):[]))},showHelp:function(e){this.$set(e,"showHeplerMark",!0)},setPropertyData:function(e){var t=null;if(e instanceof c["a"])if("101"==e.type)t=Object(u["n"])();else if("102"==e.type)t=Object(u["c"])();else if("103"==e.type){var n={name:"脚本任务",Type:"脚本任务",language:"java"};t=Object(u["l"])(n)}else if("104"===e.type)t=Object(u["o"])();else if("105"===e.type)t=Object(u["j"])();else if("106"===e.type){var s={name:"python任务",Type:"python任务",language:"python"};t=Object(u["l"])(s)}else if("107"===e.type){var i={name:"shell任务",Type:"shell任务",language:"shell"};t=Object(u["l"])(i)}else if("108"===e.type){var o={name:"SQL任务",Type:"SQL任务",language:"SQL"};t=Object(u["l"])(o)}else t="201"==e.type?Object(u["m"])():"299"==e.type?Object(u["q"])():"301"==e.type?Object(u["g"])():"302"==e.type?Object(u["h"])():Object(u["k"])();else t=e instanceof v["a"]?Object(u["i"])():e instanceof p?Object(u["d"])():e instanceof g["a"]?Object(u["b"])():Object(u["a"])();var a=e.attributes,l=null,r=-1;t.json=[];for(var d=0;d<t.rows.length;d++)1==t.rows[d].nodeLevel?t.rows[d].value=a[t.rows[d].nodeName]:2==t.rows[d].nodeLevel?a[t.rows[d].nodeName1]?t.rows[d].value=a[t.rows[d].nodeName1][t.rows[d].nodeName2]:t.rows[d].value="":3==t.rows[d].nodeLevel&&(a[t.rows[d].nodeName1]&&a[t.rows[d].nodeName1][t.rows[d].nodeName2]?t.rows[d].value=a[t.rows[d].nodeName1][t.rows[d].nodeName2][t.rows[d].nodeName3]:t.rows[d].value=""),t.rows[d].group!=l&&(r++,l=t.rows[d].group,t.json[r]={name:l,attributes:[]}),t.json[r]["attributes"].push(t.rows[d]);return t.json},loadPropertyDom:function(e){var t=this,n=[];e.forEach((function(e){e.attributes.forEach((function(e){e.editor&&"checkbox"===e.editor.type?e.value=e.value||[]:e.editor&&"checkbox"!==e.editor.type?e.value=e.editor&&e.editor.options&&e.value?Number(e.value):e.value:"flow"===e.nodeType&&"Version"===e.nodeName2?(e.oldValue=e.value,e.value0=e.value.split(".")[0],e.value1=e.value.split(".")[1],e.value2=e.value.split(".")[2]):e.value=e.value,e.showRob&&n.push(e)}))})),this.data=e,n&&n.length>0&&n.forEach((function(e){t.showRob(e)})),this.activeNames=[this.data[0].name]},changeVesion:function(e,t){e&&(0===t&&(e.value1=0,e.value2="0001"),e.value=e.value0+"."+e.value1+"."+e.value2,this.changeProperty(e))},changeProperty:function(e){if(e.nodeName2&&"Name"==e.nodeName2&&(this.curSelectObj instanceof c["a"]&&(this.curSelectObj.name=e.value),this.curSelectObj instanceof p&&(this.curSelectObj.name=e.value)),e.showRob&&"GatherRule"==e.showRob&&this.curSelectObj instanceof v["a"]&&(this.curSelectObj.type=e.value),"InLine"===e.nodeName1&&"Type"===e.nodeName2){var t=Object(u["e"])(e.value),n=[],s=this.curNodeObj.InLine.RangeRule&&this.curNodeObj.InLine.RangeRule.Rule;s&&s.length>0&&(s.forEach((function(e,t){n.push(e.name+"/"+Object(u["f"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(t,": ").concat(n.join(",")))}if("InLine"===e.nodeName1&&"RangeRule"===e.nodeName2&&e.value&&e.value.Rule&&e.value.Rule.length>0){var i=Object(u["e"])(this.curNodeObj.InLine.Type),o=[];e.value.Rule.forEach((function(e,t){o.push(e.name+"/"+Object(u["f"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(i,": ").concat(o.join(","))}this.showRob(e),1==e.nodeLevel?this.curNodeObj[e.nodeName]=e.value:2==e.nodeLevel?this.curNodeObj[e.nodeName1][e.nodeName2]=e.value:3==e.nodeLevel&&(this.curNodeObj[e.nodeName1][e.nodeName2][e.nodeName3]=e.value)},showRob:function(e){e.showRob&&this.data.forEach((function(t){t.attributes.forEach((function(t){var n=e.showRob.split(",");n.forEach((function(n){t.nodeName2!==n&&t.nodeName3!==n||("RushInfo"===n?5===e.value?Object.assign(t,{name:"人数",value:1,max:999999,unit:"（人）",hide:!1}):6===e.value?Object.assign(t,{name:"比例",value:60,max:100,unit:"%",hide:!1}):t.hide=!0:"GatherRule"===n?1===e.value||2===e.value?t.hide=!1:t.hide=!0:"Params"===n?0===e.value||1===e.value?t.hide=!1:t.hide=!0:"Content"===n?2===e.value?t.hide=!1:t.hide=!0:"Value"===n&&(0!==e.value?t.hide=!1:t.hide=!0))}))}))}))},doOpenDialog:function(e){var t=this,n=e,s={code:n.value&&n.value.Expression||"",language:"java",checked:this.checked,value:n.value};n.config&&n.config.content&&("RangeRule"===n.config.content?(s.nodes=this.nodes,s.value=n.value||{}):("Summary"===n.config.content||"SendCondition"===n.config.content)&&(s.lines=this.lines,s.value=n.value||{})),dsf.layer.pc.openDialog({title:n.name,width:n.config.width,height:n.config.height,overflow:"hidden",content:n.config.content,params:s,btns:[{text:"确定",handler:function(e){n.value=e.getContent(),t.changeProperty(n)}},{text:"取消"}]})}}},w=x,N=(n("22df"),n("2877")),O=Object(N["a"])(w,b,m,!1,null,"4ed6962c",null),_=O.exports,L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"svgRoot",staticClass:"svgRoot"},[n("lines",{ref:"lines",attrs:{"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,events:e.events,checked:e.checked,config:e.config}}),n("nodes",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,checked:e.checked,config:e.config}}),n("events",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,events:e.events,checked:e.checked,config:e.config}})],1)},$=[],j=n("839b"),C=n("7f74"),k=n("5177"),E={name:"FlowContent",components:{Lines:j["a"],Events:C["a"],subprocess:k["a"]},props:{flowInfo:{type:Object,default:function(){return{}}},lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},lanes:{type:Object,default:function(){return{}}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}},config:{type:Object,default:function(){return{}}}},data:function(){return{}},watch:{flowInfo:function(e){e&&this.init()}},created:function(){},mounted:function(){},methods:{init:function(){this.initFlow()},initFlow:function(){flow={attributes:Object.assign(Object(h["b"])(Object(u["a"])()),this.flowInfo)}}}},I=E,P=(n("e39b"),Object(N["a"])(I,L,$,!1,null,null,null)),S=P.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lanes"},e._l(e.lanes,(function(t,s){return n("div",{key:t.id||s,staticClass:"lane",class:{selected:e.checked===t},style:{left:e.toPx(t.left),top:e.toPx(t.top),width:"vertical"===t.direction?e.toPx(t.size):"",height:"horizontal"===t.direction?e.toPx(t.size):""},attrs:{index:s},on:{click:function(n){return e.selectLane(n,t)}}},[n("div",{staticClass:"head"},[n("div",{staticClass:"title"},[n("el-popover",{attrs:{placement:"vertical"===t.direction?"bottom":"right",title:"修改名称",width:"200",trigger:"manual"},model:{value:t.isEdit,callback:function(n){e.$set(t,"isEdit",n)},expression:"lane.isEdit"}},[n("div",{staticClass:"el-input"},[t.isEdit?n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"lane.name"},{name:"focus",rawName:"v-focus"}],staticClass:"el-input__inner",attrs:{autofocus:"",type:"text",placeholder:"请输入内容"},domProps:{value:t.name},on:{change:function(n){t.attributes.Name=t.name,e.hideEdit()},input:function(n){n.target.composing||e.$set(t,"name",n.target.value)}}}):e._e()]),n("span",{staticClass:"textContent ellipsis",style:{width:e.toPx(t.size),transform:"horizontal"===t.direction?"rotate(-90deg) translateX(-"+t.size+"px)":""},attrs:{slot:"reference"},on:{dblclick:function(n){return e.edit(t)}},slot:"reference"},[e._v(e._s(t.name))])]),n("img",{staticClass:"plus left",attrs:{src:"/dsfa/res/dsf_styles/themes/workFlow/addLane.png"},on:{click:function(n){return e.addLane(t.direction,s)}}}),n("img",{staticClass:"plus right",attrs:{src:"/dsfa/res/dsf_styles/themes/workFlow/addLane.png"},on:{click:function(n){return e.addLane(t.direction,s+1)}}}),n("span",{staticClass:"resizeLane",on:{mousedown:function(n){return e.dragLane(n,t)}}})],1)]),n("div",{staticClass:"bg/"}),n("div",{staticClass:"laneSelected"})])})),0)},z=[],T={name:"Lanes",props:{lanes:{type:Array,default:function(){return[]}},checked:{type:Object,default:function(){return{}}}},data:function(){return{current:null,minSize:100}},mounted:function(){var e=this;document.addEventListener("mousedown",(function(t){var n=t.target;"tooltip"!==n.getAttribute("role")&&"tooltip"!==n.parentElement.getAttribute("role")&&"tooltip"!==n.parentElement.parentElement.getAttribute("role")&&e.hideEdit()})),document.addEventListener("mousemove",(function(t){e.moveLane(t)})),document.addEventListener("mouseup",(function(t){e.dropLane(t)}))},methods:{toPx:function(e){return"".concat(e,"px")},selectLane:function(e,t){this.$bus.$emit("update-checked",t),e.stopPropagation()},addLane:function(e,t){this.$emit("addLane",e,t)},dragLane:function(e,t){this.$bus.$emit("update-checked",t),this.current=Object(l["a"])({},t),this.$bus.$emit("update-baseLine",{show:this.current.direction,top:0,left:0})},dropLane:function(e){if(this.current){var t=this.$store.state.flow.page,n=this.$store.state.flow.svgRoot,s=this.$store.state.flow.page.scale;this.current.direction===d["a"].vertical?this.current.size=(e.pageX-this.current.left-t.left+n.scrollLeft)/s:this.current.size=(e.pageY-this.current.top-t.top+n.scrollTop)/s,this.current.size=this.current.size>this.minSize?this.current.size:this.minSize,this.$bus.$emit("update-baseLine",{showV:!1,showH:!1,top:0,left:0}),this.$store.commit("flow/changeLane",this.current),this.$bus.$emit("resize"),this.current=null}},moveLane:function(e){if(!this.current)return!1;var t,n=this.$store.state.flow.page,s=this.$store.state.flow.svgRoot,i=this.$store.state.flow.page.scale;if(this.current.direction===d["a"].vertical){var o=this.current.left+this.minSize,a=e.pageX-n.left+s.scrollLeft;t={top:10,left:(a>o*i?a:o*i)/i}}else{var l=this.current.top+this.minSize,r=e.pageY-n.top+s.scrollTop;t={top:(r>l*i?r*i:l)/i,left:10}}var c=Object.assign(t,{showV:"vertical"===this.current.direction,showH:"horizontal"===this.current.direction});this.$bus.$emit("update-baseLine",c),this.$bus.$emit("autoScroll",{type:"lane",data:this.current,mouse:{x:e.pageX,y:e.pageY}})},edit:function(e){this.lanes.forEach((function(t){t.isEdit=e===t}))},hideEdit:function(){this.lanes.forEach((function(e){e.isEdit=!1}))}}},R=T,D=(n("7950"),Object(N["a"])(R,M,z,!1,null,"c192e5b2",null)),F=D.exports;n("b032"),n("8a5f");window.flow=null;var A={name:"Flow",components:{FlowInfo:_,FlowContent:S,Lanes:F},data:function(){return{activeNames:[0],isDrawLine:!1,dragNode:null,dragEvent:null,endTarget:null,width:0,height:0,maxWidth:0,maxHeight:0,flow:null,flowInfo:null,config:null,xmlId:this.$route.query&&this.$route.query.id||"5b2d48d830c44b509d4fa730fa9d0b9b",nodes:[],lines:[],events:[],distance:30,cloneObj:null,crashNode:null,scale:this.$store.state.flow.page.scale,dragSize:20,maxSizeOffset:50,flowTools:u["r"],boundaryEvents:u["p"],checked:null,baseLine:{show:"",top:0,left:0},showLineV:!1,showLineH:!1,isGlobalPosMove:!1,globalPos:null,globalMoveLastMouse:null,globalRect:null,isGlobalSelect:!1,selectGlobalPos:null,selectGlobalPonits:{start:{x:0,y:0},end:{x:0,y:0}},globalSelect:null,isCtrlKey:!1,ctrlCopyNodes:null,isCopyNodes:!1,copyNodesPos:null,copyNodes:[]}},computed:Object(l["a"])({},Object(r["b"])({lanes:function(e){return e.flow.lanes}})),created:function(){},mounted:function(){this.reset(),this.init(),this.flow=this.$store.state.flow},methods:{toPx:h["h"],reset:function(){var e=this.$refs.ds_page;this.$store.commit("flow/setPage",{width:e.clientWidth,height:e.clientHeight})},init:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initData();case 2:e.loadElement(),e.initEvent();case 4:case"end":return t.stop()}}),t)})))()},initData:function(){var e=this;return this.$http.all([this.$http.get("./static/pd_attributes/dsf.flow.json"),this.$http.get("wfm/getWFDefinition",{sID:this.xmlId},$$webRoot.dsfa)]).then((function(t){e.config=t[0],e.flowInfo=t[1].data.WorkFlow})).catch((function(t){e.flowInfo={},console.log(t)}))},initEvent:function(){var e=this;document.addEventListener("dragover",(function(t){e.dragNode&&(e.isCtrlKey=t.ctrlKey,e.dragToolOver(t)),e.dragEvent&&e.dragEventOver(t)})),document.addEventListener("dragend",(function(t){e.dragNode&&e.dragToolEnd(t),e.dragEvent&&(e.dragEventEnd(t),e.dragEvent&&document.body.removeChild(e.dragEvent),e.dragEvent=null,e.cloneObj=null,e.crashNode=null,e.$bus.$emit("endMoveEvent",!0))})),this.$bus.$on("update-baseLine",(function(t){e.baseLine=t})),this.$bus.$on("update-checked",(function(t){e.checked=t})),this.$bus.$on("parentAutoScroll",this.parentAutoScroll),this.$bus.$on("autoScroll",this.autoScroll),this.$bus.$on("resize",this.resize),this.$bus.$on("dragCloneEvent",this.dragCloneEvent),this.$bus.$on("dragNode",this.dragTool),this.$bus.$on("startGlobalMove",this.startGlobalMove),this.$bus.$on("startCopyNodes",this.startCopyNodes),document.addEventListener("keydown",this.keydown),window.onresize=function(){e.reset(),e.resize()},this.$refs.root.addEventListener("mousedown",(function(t){e.$store.state.flow.selectedList;"svg"===t.target.tagName&&-1===t.target.parentElement.parentElement.className.indexOf("subprocess")&&(e.checked=flow,e.$bus.$emit("selectGlobal",null),e.isGlobalSelect=!0,e.selectGlobalPos=e.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY}))})),this.$refs.root.addEventListener("mousemove",(function(t){e.readOnly||(e.setCursor(t),e.isGlobalPosMove&&e.globalMove(t),e.isGlobalSelect&&e.selectGlobalMove(t),e.isCopyNodes&&e.nodesMove(t))})),document.addEventListener("mouseup",(function(t){e.isGlobalPosMove&&(e.isGlobalPosMove=!1,e.globalPos=null,e.resize(),e.$store.commit("flow/clearPoints")),e.isGlobalSelect&&(e.selectGlobalEnd(t),e.resize(),e.$store.commit("flow/clearPoints")),e.isCopyNodes&&e.nodesMoveEnd(t)})),this.$refs.ds_page.addEventListener("wheel",this.scrollwheel,!0),document.addEventListener("copy",(function(t){t.preventDefault(),e.documentCopy(t)})),document.addEventListener("paste",(function(t){t.preventDefault(),e.pasteNode(t)}))},copyNewNode:function(e,t,n,s){e.dataTransfer&&e.dataTransfer.setDragImage(new Image,0,0);var i=e.target||e,o=i.cloneNode(!0);return o.setAttribute("draggable",!0),o.offset={x:n?n.x:0,y:n?n.y:0},s&&(o.copyNode=t),s||102!==t.type||(o.tool=t),o.className=o.className+" drag_nodeOuter",Object.assign(o.style,{position:"absolute",zIndex:9999,top:this.toPx(e.pageY-((t.padding||0)+o.offset.y)*this.scale),left:this.toPx(e.pageX-((t.padding||0)+o.offset.x)*this.scale),pointerEvents:"none",cursor:"move",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(o),this.$bus.$emit("isMoveNode",s?o.copyNode:o),o},startCopyNodes:function(e){this.isCopyNodes=!0,this.copyNodesPos={x:e.pageX,y:e.pageY}},createCopyNodes:function(e){var t=this,n=this.$store.state.flow.selectedList||null;n&&n.length>1&&(this.copyNodes=[],n.forEach((function(e){var n=document.querySelector('.nodeOuter[data-id="'.concat(e.id,'"]')),s={x:e.point.x*t.scale,y:e.point.y*t.scale},i=t.$store.getters["flow/getMousePointByPoint"](s);n.pageX=i.x,n.pageY=i.y;var o=t.copyNewNode(n,e,null,!0);o.point=i,t.copyNodes.push(o)})))},dragTool:function(e,t,n,s){this.dragNode=this.copyNewNode(e,t,n,s)},getDisplacement:function(e){var t={x:e.pageX,y:e.pageY},n=Object(h["c"])(this.copyNodesPos),s=Object(h["c"])(t);return{x:s.x-n.x,y:s.y-n.y}},nodesMove:function(e){var t=this,n=this.getDisplacement(e);(!this.copyNodes||this.copyNodes&&0===this.copyNodes.length)&&(Math.abs(n.x)>5||Math.abs(n.y)>5)&&this.createCopyNodes(e),this.copyNodes.forEach((function(e){e.copyNode;var s=e.offset,i={x:e.point.x+n.x-s.x*t.scale,y:e.point.y+n.y-s.y*t.scale};e.style.top=t.toPx(i.y),e.style.left=t.toPx(i.x)})),this.isCtrlKey=e.ctrlKey},dragToolOver:function(e){var t=this.dragNode,n=t.offset;t.style.top=this.toPx(e.pageY-n.y*this.scale),t.style.left=this.toPx(e.pageX-n.x*this.scale);var s=t.copyNode;if(this.endTarget=this.getTargetIsNodes(e.target,s||t.tool),this.endTarget){var i=this.endTarget&&this.endTarget.className;if(i.indexOf("nodes isSub")>-1){var o=Object(h["f"])(this.nodes,this.endTarget);this.$bus.$emit("dragToSubNode",s!==o?o:null)}else this.$bus.$emit("dragToSubNode",null);s&&this.$bus.$emit("moveCopyNode".concat(s.parentNodeId||""),e,s)}},getTargetIsNodes:function(e,t){var n=document.querySelector(".svgRoot");return n.contains(e)?t&&"102"==t.type&&e.className.indexOf("nodes isSub")>-1?this.getTargetIsNodes(e.parentElement):e.className.indexOf("nodes")>-1?e:this.getTargetIsNodes(e.parentElement):null},getBeforeCopyLine:function(e){var t=this,n=[];e.forEach((function(e){n=[].concat(Object(o["a"])(n),Object(o["a"])(e.out),Object(o["a"])(e.in))})),n=Object(o["a"])(new Set(n));var s=[],i=[],a=[];return n.forEach((function(n){var o=Object(h["d"])(t.lines,n);if(o){var l;l="event"===o.fromType?Object(h["d"])(t.events,o.from):Object(h["d"])(e,o.from);var r=Object(h["d"])(e,o.to);if(l&&r){var c=Object(h["a"])(o);c.id=d["h"].uuid(),s.push({line:c,nodeId:l.id}),i.push({line:c,nodeId:r.id}),a.push(c)}}})),{fromNodeIds:s,toNodeIds:i,newLines:a}},resetLineFromAndTo:function(e,t,n,s){e.length>0&&e.forEach((function(e){e.nodeId===s.id&&(n.in.push(e.line.id),e.line.from=n.id)})),t.length>0&&t.forEach((function(e){e.nodeId===s.id&&(n.out.push(e.line.id),e.line.to=n.id)}))},copyEventsLines:function(e){var t=this;e.forEach((function(e){if("event"===e.fromType){var n=Object(h["d"])(t.events,e.from,"fromId");n?(delete n.fromId,e.from=n.id):e.from=null}e.from&&e.to&&t.$bus.$emit("addLine",{id:e.id,type:e.type,name:e.name,from:e.from,fromType:e.fromType,to:e.to,linkInfo:e.linkInfo})}))},nodesMoveEnd:function(e){var t=this;if(this.copyNodes&&this.copyNodes.length>0){var n,s=this.copyNodes.map((function(e){return e.copyNode})),i=this.getBeforeCopyLine(s),o=i.fromNodeIds,a=i.toNodeIds,l=i.newLines,r=this.getDisplacement(e),c=[];this.copyNodes.forEach((function(e){var s=e.copyNode,i=(e.offset,{pageX:e.point.x+r.x,pageY:e.point.y+r.y}),l=t.nodeMoveEnd(i,e);l.id===s.id?n=!0:t.resetLineFromAndTo(o,a,l,s),t.checked=l,c.push(l)})),n||this.copyEventsLines(l),this.$store.commit("flow/setSelectedList",c)}this.isCopyNodes=!1,this.copyNodesPos=null,this.copyNodes=[],this.$bus.$emit("isMoveNode",!1)},nodeMoveEnd:function(e,t){var n,s,i,o,a=t&&t.copyNode;if(a){var l=t.offset;if(a.parentNodeId)this.deleteNode(a),delete a.id,delete a.parentNodeId,delete a.point,s=Object.assign(a,{x:e.pageX-l.x*this.scale>a.padding?e.pageX-l.x*this.scale:a.padding,y:e.pageY-l.y*this.scale>a.padding?e.pageY-l.y*this.scale:a.padding,mouseConvert:!0});else{var r=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX-l.x*this.scale,y:e.pageY-l.y*this.scale}),c=r;c={x:c.x>a.padding?c.x:a.padding,y:c.y>a.padding?c.y:a.padding},this.isCtrlKey?(o=a.id,s=Object.assign({},a,{id:d["h"].uuid(),out:[],in:[],x:c.x,y:c.y})):(c={x:c.x/this.scale,y:c.y/this.scale},c=Object(h["c"])(c),a.point.x=c.x,a.point.y=c.y,this.$bus.$emit("nodeMove",a),i=!0)}}if(!i){var u=e.target&&e.target.getAttribute("nodetype"),f=e.target&&e.target.getAttribute("sort");s=s||{type:u,sort:f,x:e.pageX,y:e.pageY,mouseConvert:!0},n=this.copyNodeNext(s,o,a)}return document.body.removeChild(t),this.resize(),i?a:n},copyNodeNext:function(e,t,n){var s=this,i=this.addNode(e);return this.nodes.push(i),t&&this.copyNodeEvent(t,i),n&&n.nodes&&n.nodes.length>0&&(i.nodes=[],n.nodes.forEach((function(e){var t=Object(h["a"])(e),n=Object.assign({x:t.point.x,y:t.point.y},t);i.nodes.push(s.addSubNode(n,i))}))),i},dragToolEnd:function(e){if(this.endTarget){var t=this.endTarget&&this.endTarget.className;if(t.indexOf("nodes isSub")>-1){var n=Object(h["f"])(this.nodes,this.endTarget);if(n){var s,i;if(this.dragNode&&this.dragNode.copyNode){var o=this.dragNode.copyNode,a=this.dragNode.offset;if(!o.parentNodeId||o.parentNodeId&&o.parentNodeId!==n.id)s=Object.assign(o,{x:e.pageX-a.x*this.scale>o.padding?e.pageX-a.x*this.scale:o.padding,y:e.pageY-a.y*this.scale>o.padding?e.pageY-a.y*this.scale:o.padding,mouseConvert:!0}),this.deleteNode(o),delete o.id;else{s={x:e.pageX-a.x*this.scale,y:e.pageY-a.y*this.scale,mouseConvert:!0};var l=this.getOptions(s);o.point.x=l.x-n.point.x,o.point.y=l.y-n.point.y-n.imgHeight-2*n.padding,this.$bus.$emit("nodeMove".concat(o.parentNodeId),o),i=!0}}if(!i){var r=e.target&&e.target.getAttribute("nodetype"),c=e.target&&e.target.getAttribute("sort");s=s||{type:r,sort:c,x:e.pageX,y:e.pageY,mouseConvert:!0};var d=this.addSubNode(s,n);n.nodes?n.nodes.push(d):this.$set(n,"nodes",[d]),this.$set(n,"lines",n.lines||[]),this.$set(n,"events",n.events||[]),this.nodeResize(n)}}document.body.removeChild(this.dragNode)}else t.indexOf("nodes")>-1&&(this.checked=this.nodeMoveEnd(e,this.dragNode),this.$store.commit("flow/setSelectedList",[this.checked]))}else document.body.removeChild(this.dragNode);this.dragNode=null,this.$bus.$emit("isMoveNode",!1)},dragBoundaryEvent:function(e,t){e.dataTransfer.setDragImage(new Image,0,0),this.dragEvent=e.target.cloneNode(!0),this.dragEvent.className="ds_tool_event_drag",this.dragEvent.setAttribute("draggable",!1);var n=Object(h["a"])(t);this.cloneObj=new g["a"](n,e),Object.assign(this.dragEvent.style,{position:"absolute",zIndex:9999,width:this.toPx(this.cloneObj.width),height:this.toPx(this.cloneObj.height),top:this.toPx(e.pageY-e.offsetY),left:this.toPx(e.pageX-e.offsetX),pointerEvents:"none",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(this.dragEvent),this.$bus.$emit("startMoveEvent",this.dragEvent)},dragEventOver:function(e){if(this.dragEvent){var t=this.computedPoint(e,this.dragEvent);if(Array.from(e.target.classList).indexOf("task-node")>-1||Array.from(e.target.parentElement).indexOf("node")){var n=Object(h["e"])(this.nodes,"nodes",e.target);if(n){var s=n.parent,i=n.sub;this.crashNode=i;var o=this.$store.getters["flow/getPoints"](i.id);o||(this.$store.commit("flow/setPointsByNode",{node:i,obj:this.cloneObj}),o=this.$store.getters["flow/getPoints"](i.id));var a={point:{x:t.point.x-s.point.x*this.scale,y:t.point.y-(s.point.y+s.padding+s.imgHeight+2*s.padding)*this.scale}},l=this.getPoint(a,o,this.distance);if(l){this.cloneObj=Object.assign(this.cloneObj,l,{parentNode:s});var r=this.$store.getters["flow/getMousePointByPoint"](l.point);return r.x=r.x+s.point.x*this.scale,r.y=r.y+(s.point.y+s.imgHeight+2*s.padding)*this.scale,this.dragEvent.style.top=this.toPx(r.y),void(this.dragEvent.style.left=this.toPx(r.x))}}var c=Object(h["f"])(this.nodes,e.target);if(c){this.crashNode=c;var d=this.$store.getters["flow/getPoints"](c.id);d||(this.$store.commit("flow/setPointsByNode",{node:c,obj:this.cloneObj}),d=this.$store.getters["flow/getPoints"](c.id));var u=this.getPoint(t,d,this.distance);if(u){this.cloneObj=Object.assign(this.cloneObj,u);var f=this.$store.getters["flow/getMousePointByPoint"](u.point);return this.dragEvent.style.top=this.toPx(f.y),void(this.dragEvent.style.left=this.toPx(f.x))}}}this.dragEvent.style.top=this.toPx(e.pageY),this.dragEvent.style.left=this.toPx(e.pageX)}},dragEventEnd:function(e){var t=this;if("drop"===e.type?(e=event||e,e.preventDefault()):event.touches&&(e=event.touches[0]?event.touches[0]:event),this.crashNode){var n=this.$store.getters["flow/getPoints"](this.crashNode.id),s=this.computedPoint(e,this.cloneObj);if(this.cloneObj.parentNode){var i=this.cloneObj.parentNode;s={point:{x:s.point.x-i.point.x*this.scale,y:s.point.y-(i.point.y+i.padding+i.imgHeight+2*i.padding)*this.scale}}}var o=this.getPoint(s,n,this.distance);if(o){if(n.splice(n.indexOf(o),1),this.cloneObj.from){var a=this.cloneObj.parentNode?this.cloneObj.parentNode.events:this.events;a.forEach((function(e){e.id===t.cloneObj.from&&t.$store.commit("flow/addPoint",{id:t.cloneObj.nodeId,obj:{point:{x:e.point.x,y:e.point.y},index:e.index,direction:e.direction}})})),this.deleteEvent(this.cloneObj.from,a),this.cloneObj.id=this.cloneObj.from,delete this.cloneObj.from}this.cloneObj=Object.assign(this.cloneObj,o),this.cloneObj.point.x=this.cloneObj.point.x/this.scale,this.cloneObj.point.y=this.cloneObj.point.y/this.scale,this.cloneObj.nodeId=this.crashNode.id,this.addNewEvent(this.cloneObj),this.checked=this.cloneObj,this.cloneObj.out&&this.cloneObj.out.length>0&&this.$bus.$emit("eventMove".concat(this.cloneObj.parentNode?this.cloneObj.parentNode.id:""),this.cloneObj)}}},addNewEvent:function(e){e.parentNode?this.nodes.forEach((function(t){e.parentNode&&e.parentNode.id===t.id&&t.events.push(e)})):this.events.push(e)},dragCloneEvent:function(e,t){var n=Object(h["a"])(t);n.from=t.id,n.id=d["h"].uuid(),this.dragBoundaryEvent(e,n)},copyNodeEvent:function(e,t){var n=this,s=[];if(this.events.forEach((function(t){t.nodeId===e&&s.push(Object(h["a"])(t))})),0!==s.length){this.$store.commit("flow/setPointsByNode",{node:t,obj:s[0]});var i=this.$store.getters["flow/getPoints"](t.id);i.forEach((function(e){s.forEach((function(s){s.direction===e.direction&&s.index===e.index&&(s.fromId=s.id,s.id=d["h"].uuid(),s.point=e.point,s.nodeId=t.id,n.addNewEvent(s))}))}))}},getPoint:function(e,t,n){var s,i=this,o=0;return t.forEach((function(t){var a=i.getDistance(t,e);a<=n&&o<a&&(o=a,s=t)})),s},getDistance:function(e,t){var n=Math.sqrt(Math.pow(e.point.x-t.point.x,2)+Math.pow(e.point.y-t.point.y,2));return n},computedPoint:function(e,t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});return{point:Object(h["c"])(n)}},getOptions:function(e){var t=Object.assign({id:d["h"].uuid(),type:1},e),n={x:t.x||0,y:t.y||0};if(1==t.mouseConvert){var s=this.$store.getters["flow/getMousePointByCanvas"]({x:t.x,y:t.y});n.x=s.x,n.y=s.y}return n=Object(h["c"])(n),t.x=n.x/this.scale,t.y=n.y/this.scale,t},addNode:function(e){var t=this.getOptions(e);t.name=t.name||"新建环节"+this.nodes.length;var n=new c["a"](t);return n},addSubNode:function(e,t){var n=this.getOptions(e);n.name=n.name||"新建环节"+(t.nodes&&t.nodes.length||0),1==n.mouseConvert&&(n.x=n.x-t.point.x,n.y=n.y-t.point.y-t.imgHeight-2*t.padding);var s=new c["a"](n);return s.parentNodeId=t.id,s},showSubNode:function(e){},keydown:function(e){var t=this;if((!this.checked||!this.checked.readOnly)&&46==e.keyCode){var n=this.$store.state.flow.selectedList||null;if(n&&n.length>1)n.forEach((function(e){setTimeout((function(){t.deleteNode(e)}),0)}));else if(this.checked instanceof c["a"])this.deleteNode(this.checked);else if(this.checked instanceof p)this.$store.commit("flow/deleteLane",this.checked),this.resize();else if(this.checked instanceof v["a"])this.deleteLine(this.checked);else if(this.checked instanceof g["a"]){for(var s=this.checked,i=s["out"].length-1;i>=0;i--){var o=Object(h["d"])(this.lines,s["out"][i]);o&&this.deleteLine(o)}var a=this.checked.parentNode?this.checked.parentNode.events:this.events;this.deleteEvent(this.checked.id,a)}this.checked={}}},deleteNode:function(e){var t;e.parentNodeId&&(t=this.nodes.find((function(t){return e.parentNodeId===t.id})));var n=e.parentNodeId?t.nodes:this.nodes,s=e.parentNodeId?t.lines:this.lines,i=e.parentNodeId?t.events:this.events,o=n.indexOf(e);if(o>-1){for(var a=e,l=a["out"].length-1;l>=0;l--){var r=Object(h["d"])(s,a["out"][l]);r&&this.deleteLine(r)}for(var c=a["in"].length-1;c>=0;c--){var d=Object(h["d"])(s,a["in"][c]);d&&this.deleteLine(d)}for(var u=0;u<i.length;u++){var f=i[u].nodeId;if(f===a.id){for(var p=i[u],v=p.out.length-1;v>=0;v--){var g=Object(h["d"])(this.lines,p.out[v]);g&&this.deleteLine(g)}i.splice(u,1),u--}}n.splice(o,1)}},deleteLine:function(e){var t;e.remove(),e.parentNodeId&&(t=this.nodes.find((function(t){return e.parentNodeId===t.id})));var n=e.parentNodeId?t.nodes:this.nodes,s=e.parentNodeId?t.lines:this.lines,i=s.indexOf(e);i>-1&&this.deleteFromOrOut(n,s,e,i)},deleteFromOrOut:function(e,t,n,s){var i=Object(h["d"])(e,n.from),o=Object(h["d"])(e,n.to);if(i){var a=i["out"].indexOf(n.id);a>=0&&i["out"].splice(a,1)}if(o){var l=o["in"].indexOf(n.id);l>=0&&o["in"].splice(l,1)}t.splice(s,1),this.$bus.$emit("updateIntersection")},deleteEvent:function(e,t){var n=(t||this.events).findIndex((function(t){return t.id===e}));n>-1&&(t||this.events).splice(n,1),this.$store.commit("flow/addPoint",{id:this.checked.nodeId,obj:{point:{x:this.checked.point.x,y:this.checked.point.y},index:this.checked.index,direction:this.checked.direction}})},addLane:function(e,t){this.createLane({direction:e,index:t})},createLane:function(e){var t=e.direction;e.name=e.name||"泳道"+(this.lanes[t].length+1),e.id=e.id||d["h"].uuid();var n=new p(e),s=this.lanes[t][(e.index||this.lanes[t].length)-1];t==d["a"].vertical?n.left=s?s.size+s.left:0:n.top=s?s.size+s.top:0,this.$store.commit("flow/addLane",{direction:t,lane:n,index:e.index}),this.resize()},onScroll:function(e){var t=e.target;this.$store.commit("flow/setSvgRoot",{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft})},getFromNodes:function(e){if(!e["in"]||e["in"].length<=0)return null;for(var t=[],n=0;n<e["in"].length;n++){var s=e["in"][n],i=Object(h["d"])(this.lines,s);if(i){var o=Object(h["d"])(this.nodes,i.from);t.push(o)}}return t},getToNodes:function(e){if(!e["out"]||e["out"].length<=0)return null;for(var t=[],n=0;n<e["out"].length;n++){var s=e["out"][n],i=Object(h["d"])(this.lines,s);if(i){var o=Object(h["d"])(this.nodes,i.to);t.push(o)}}return t},loadElement:function(){var e=this;if(this.flowInfo&&this.flowInfo.ElementList&&this.flowInfo.ElementList.length>0){var t=[],n=[],s=[],i=[],o=[];if(this.flowInfo.NodeList&&(i=Array.isArray(this.flowInfo.NodeList)?this.flowInfo.NodeList:[this.flowInfo.NodeList]),this.flowInfo.LineList&&(o=Array.isArray(this.flowInfo.LineList)?this.flowInfo.LineList:[this.flowInfo.LineList]),this.flowInfo.EventList)for(var a=this.flowInfo.EventList,l=0;l<a.length;l++)this.events.push(new g["a"](a[l]));for(var r={},c=0;c<i.length;c++)r[i[c].ID]=i[c];for(var d=0;d<o.length;d++)r[o[d].ID]=o[d];this.flowInfo.ElementList=Array.isArray(this.flowInfo.ElementList)?this.flowInfo.ElementList:[this.flowInfo.ElementList];for(var h=0;h<this.flowInfo.ElementList.length;h++){var f=this.flowInfo.ElementList[h];"node"==f.nodeType?t.push(f):"line"==f.nodeType?n.push(f):"lane"==f.nodeType&&s.push(f)}for(var p=function(n){var s=t[n];s["in"]=Array.isArray(s["in"])?s["in"]:s["in"]?[s["in"]]:[],s["out"]=Array.isArray(s["out"])?s["out"]:s["out"]?[s["out"]]:[],s.point.x=parseFloat(s.point.x),s.point.y=parseFloat(s.point.y),s=Object.assign({x:s.point.x,y:s.point.y},s),u["r"].forEach((function(e){e.data.forEach((function(e){s.attributes.BaseInfo.Type==e.type&&(s.attributes.BaseInfo.Type=e.name)}))}));var i=e.addNode(s);if(e.nodes.push(i),s.nodes){var o=s.nodes;e.$set(i,"nodes",[]),o.forEach((function(t){t=Object.assign({x:t.point.x,y:t.point.y},t),i.nodes.push(e.addSubNode(t,i))})),e.$set(i,"lines",[]),e.$set(i,"events",[])}s.events&&s.events.forEach((function(e){var t=new g["a"](e);t.parentNode=s,i.events.push(t)})),s.lines&&s.lines.forEach((function(t){t.linkInfo&&(t.linkInfo.fromOffset=parseFloat(t.linkInfo.fromOffset),t.linkInfo.toOffset=parseFloat(t.linkInfo.toOffset)),setTimeout((function(){e.$bus.$emit("addLine".concat(s.id),{id:t.id,type:t.type,name:t.name,path:t.path,from:t.from,fromType:t.fromType,to:t.to,linkInfo:t.linkInfo,attributes:t.attributes})}),0)}))},v=0;v<t.length;v++)p(v);for(var b=0;b<n.length;b++){var m=n[b];r[m.id]&&r[m.id],m.linkInfo&&(m.linkInfo.fromOffset=parseFloat(m.linkInfo.fromOffset),m.linkInfo.toOffset=parseFloat(m.linkInfo.toOffset)),this.$bus.$emit("addLine",{id:m.id,type:m.type,name:m.name,path:m.path,from:m.from,fromType:m.fromType,isHide:m.isHide,to:m.to,linkInfo:m.linkInfo,attributes:m.attributes})}for(var y=0;y<s.length;y++){var x=s[y];this.createLane({id:x.id,name:x.name,size:x.size,index:x.index,direction:x.direction,attributes:x.attributes})}}this.resize()},doSave:function(){flow.attributes.BaseInfo.ID=this.xmlId;for(var e={WorkFlow:{BaseInfo:flow.attributes.BaseInfo,NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[]}},t={nodes:Object(o["a"])(JSON.parse(JSON.stringify(this.nodes))),lanes:Object(l["a"])({},this.lanes),lines:Object(o["a"])(this.lines),events:Object(o["a"])(this.events)},n=dsf.mix(!0,{},t),s=this.getFlowAllObjectMap(n),i=[],a=[],r=0;r<n.nodes.length;r++){var c=n.nodes[r];if("6"==c.type){var d=[],f=[],p=this.getFromNodes(c);if(p)for(var v=0;v<p.length;v++){var g=p[v];d.push(s[g.id])}if(p=this.getToNodes(c),p)for(var b=0;b<p.length;b++){var m=p[b];f.push(s[m.id])}var y={node:c,from:d,to:f};i.push(y)}}for(var x=0;x<i.length;x++){var w=i[x];w.node;if(w.node["out"].length>0){for(var N=0;N<w.from.length;N++){for(var O=w.from[N],_=0;_<w.node["out"].length;_++){var L=w.node["out"][_],$=Object.assign(!0,{},s[L]);$.attributes.ID=$.id+"_"+O.id,$.attributes.StartNodeID=O.id,n.lines.push($),a.push(L)}O.attributes.OutLine.SendConditions=w.node.attributes.OutLine.SendConditions;var j=Object(h["d"])(this.nodes,O.id);j&&(j.attributes.OutLine.SendConditions=w.node.attributes.OutLine.SendConditions)}for(var C=0;C<w.node["in"].length;C++)a.push(w.node["in"][C])}else for(var k=0;k<w.from.length;k++){var E=w.from[k];E.attributes.OutLine.SendConditions={IsEnabled:"0"};var I=Object(h["d"])(this.nodes,E.id);I&&(I.attributes.OutLine.SendConditions={IsEnabled:"0"})}}for(var P=0;P<a.length;P++)for(var S=n.lines.length-1;S>=0;S--)n.lines[S].attributes.ID==a[P]&&n.lines.splice(S,1);for(var M=function(t){var s=n.nodes[t];s.lines&&s.lines.forEach((function(e){delete e.paper})),s.events&&s.events.forEach((function(e){e.parentNodeId=e.parentNode.id,delete e.parentNode})),s.nodes&&s.nodes.forEach((function(e){delete e.isRender,delete e.edit})),u["r"].forEach((function(e){e.data.forEach((function(e){s.attributes.BaseInfo.Type==e.name&&(s.attributes.BaseInfo.Type=e.type)}))})),e.WorkFlow.NodeList.push(s.attributes),s.nodeType="node",e.WorkFlow.ElementList.push(s)},z=0;z<n.nodes.length;z++)M(z);for(var T=0;T<n.lines.length;T++){var R=n.lines[T];delete R.paper,e.WorkFlow.LineList.push(R.attributes),delete R.arrowEnd,delete R.isRender,R.nodeType="line",e.WorkFlow.ElementList.push(R)}for(var D=0;D<n.events.length;D++){var F=n.events[D];e.WorkFlow.EventList.push(F.attributes),F.nodeType="event",e.WorkFlow.ElementList.push(F)}for(var A=0;A<t.lanes.horizontal.length;A++){var B=t.lanes.horizontal[A],G=Object(h["a"])(B);delete G.isRender,e.WorkFlow.LaneList.horizontal.push(B.attributes),G.nodeType="lane",e.WorkFlow.ElementList.push(G)}for(var X=0;X<t.lanes.vertical.length;X++){var H=t.lanes.vertical[X],V=Object(h["a"])(H);delete V.isRender,e.WorkFlow.LaneList.vertical.push(H.attributes),V.nodeType="lane",e.WorkFlow.ElementList.push(V)}var Y={sData:JSON.stringify(e)};this.$http.post("wfm/saveWFDefinition",Y,$$webRoot.dsfa).done((function(e){e.success?dsf.layer.message("保存成功",!0):dsf.layer.message("保存失败",!1)})).error((function(){dsf.layer.message("保存失败",!1)}))},getFlowAllObjectMap:function(e){for(var t={},n=0;n<e.nodes.length;n++){var s=e.nodes[n];t[s.id]=s}for(var i=0;i<e.lines.length;i++){var o=e.lines[i];t[o.id]=o}for(var a=0;a<e.lanes.horizontal.length;a++){var l=e.lanes.horizontal[a];t[l.id]=l}for(var r=0;r<e.lanes.vertical.length;r++){l=e.lanes.vertical[r];t[l.id]=l}return t},drawLine:function(){this.isDrawLine=!this.isDrawLine},resize:function(){var e=this.$store.state.flow.page.width,t=this.$store.state.flow.page.height,n=e||0,s=t||0,i=this.lanes.vertical[this.lanes.vertical.length-1],o=this.$store.getters["flow/lanesWidth"];i&&i.size+i.left+o>n?this.width=i.size+i.left+o:this.width=e;var a=this.lanes.horizontal[this.lanes.horizontal.length-1],l=this.$store.getters["flow/lanesHeight"];a&&a.size+a.top+l>s?this.height=a.size+a.top+l:this.height=t;var r=0,c=0;this.nodes.forEach((function(e){e.width+e.point.x+2*e.padding>r&&(r=e.width+e.point.x+2*e.padding),e.height+e.point.y+2*e.padding+20>c&&(c=e.height+e.point.y+2*e.padding+20)})),this.width=this.width>r?this.width:r,this.height=this.height>c?this.height:c},nodeResize:function(e){var t=0,n=0;e.nodes.forEach((function(s){s.width+s.point.x+2*s.padding>t&&(t=s.width+s.point.x+2*s.padding),s.height+s.point.y+2*s.padding+20+e.imgHeight+2*e.padding>n&&(n=s.height+s.point.y+2*s.padding+20+e.imgHeight+2*e.padding)})),e.width=e.width>t?e.width:t,e.height=e.height>n?e.height:n,this.$bus.$emit("nodeMove",e)},autoScroll:function(e){var t=null,n=e.type;"node"==n?(t=e.point,e.mouse.x>this.width/2?t.x=t.x+e.data.width+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+e.data.height+this.maxSizeOffset:t.y=t.y):"line"==n?(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x-this.maxSizeOffset,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y-this.maxSizeOffset):"lane"==n&&(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y);var s,i,o,a=this.$refs.ds_page;t.x<a.scrollLeft&&(s=Math.abs(a.scrollLeft-t.x),i=a.scrollLeft,a.scrollLeft=i-s/3),t.y<a.scrollTop&&(s=Math.abs(a.scrollTop-t.y),o=a.scrollTop,a.scrollTop=o-s/3),t.h<a.scrollTop&&(s=Math.abs(a.scrollLeft-t.x),i=a.scrollLeft,a.scrollLeft=i-s/3),t.x>a.clientWidth+a.scrollLeft&&(this.width=t.x,s=Math.abs(a.clientWidth+a.scrollLeft-t.x),i=a.scrollLeft,a.scrollLeft=i+s/3),t.y>a.clientHeight+a.scrollTop&&(this.height=t.y,s=Math.abs(a.clientHeight+a.scrollTop-t.y),o=a.scrollTop,a.scrollTop=o+s/3)},parentAutoScroll:function(e){var t=e.mouse,n=e.point,s=e.parent,i=e.node;n.x>s.width+s.point.x?n.x=n.x+i.width+this.maxSizeOffset:n.x=n.x,n.y>s.height+s.point.y?n.y=n.y+i.height+this.maxSizeOffset:n.y=n.y,n.x>s.width+0&&(s.width=n.x),n.y>s.height+0&&(s.height=n.y),this.$bus.$emit("nodeMove",s),this.autoScroll({type:"node",data:s,mouse:{x:t.x,y:t.y},point:{x:n.x,y:n.y}})},setCursor:function(e){if("svg"!=e.target.tagName){e.target.className;if("path"==e.target.tagName){var t=Object(h["g"])(e.target);if(t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});t.type==d["d"].horizontal?0==t.index&&Math.abs(t.sp.x-n.x)<=this.dragSize||t.isLast&&Math.abs(t.ep.x-n.x)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ns-resize"):0==t.index&&Math.abs(t.sp.y-n.y)<=this.dragSize||t.isLast&&Math.abs(t.ep.y-n.y)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ew-resize")}}}else this.setRootCursor("default")},setRootCursor:function(e){this.$refs.root.style.cursor=e},startGlobalMove:function(e){this.isGlobalPosMove=!0,this.globalPos=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY}),this.globalMoveLastMouse={x:e.pageX,y:e.pageY},this.globalRect=this.getRect()},globalMove:function(e){if(this.isGlobalPosMove){var t={x:e.pageX,y:e.pageY},n=Object(h["c"])(this.globalMoveLastMouse),s=Object(h["c"])(t),i={x:s.x-n.x,y:s.y-n.y};Number.MIN_VALUE,Number.MIN_VALUE;if(0==i.x&&0==i.y)return!1;var o=!1,a=!1;return this.globalRect.x+i.x>0&&(this.globalRect.x+=i.x,o=!0),this.globalRect.y+i.y>=0&&(this.globalRect.y+=i.y,a=!0),this.$bus.$emit("globalMove",i,o,a,e),void(this.globalMoveLastMouse=s)}},getRect:function(){for(var e=Number.MAX_VALUE,t=Number.MAX_VALUE,n=Number.MIN_VALUE,s=Number.MIN_VALUE,i=0;i<this.nodes.length;i++){var o=this.nodes[i];o.point.x<e&&(e=o.point.x),o.point.x+o.width>n&&(n=o.point.x+o.width),o.point.y<t&&(t=o.point.y),o.point.y+o.height>s&&(s=o.point.y+o.height)}for(var a=0;a<this.lines.length;a++)for(var l=this.lines[a],r=0;r<l.path.length;r++)l.path[r].x<e&&(e=l.path[r].x),l.path[r].x>n&&(n=l.path[r].x),l.path[r].y<t&&(t=l.path[r].y),l.path[r].y>s&&(s=l.path[r].y);return{x:e,y:t,width:n,height:s}},getWheelDirect:function(e){var t;return e=e||window.event,e.wheelDelta?(e.wheelDelta>0&&(t="up"),e.wheelDelta<0&&(t="down")):e.detail&&(e.detail>0&&(t="up"),e.detail<0&&(t="down")),t},scrollwheel:function(e){if(e=e||window.event,e.wheelDelta&&e.ctrlKey){e.preventDefault();var t=this.getWheelDirect(e);this.rootScale(t)}},rootScale:function(e){this.scale=Number("up"===e?(this.scale+.05<2?this.scale+.05:2).toFixed(2):(this.scale>.4?this.scale-.05:.4).toFixed(2)),this.$store.commit("flow/setPage",{scale:this.scale}),this.$store.commit("flow/clearPoints")},selectGlobalMove:function(e){if(this.globalSelect||(this.globalSelect=document.createElement("div"),this.globalSelect.className="select-nodes",Object.assign(this.globalSelect.style,{zIndex:9999,transform:"translate3d(".concat(this.selectGlobalPos.x/this.scale,"px, ").concat(this.selectGlobalPos.y/this.scale,"px, 0)"),pointerEvents:"none"}),this.$refs.root.appendChild(this.globalSelect)),this.selectGlobalPos){var t,n,s,i,o=this.selectGlobalPos,a=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});a.x>o.x?(n=o.x,s=a.x-o.x):(n=a.x,s=o.x-a.x),a.y>o.y?(t=o.y,i=a.y-o.y):(t=a.y,i=o.y-a.y),this.selectGlobalPonits.start.x=n/this.scale,this.selectGlobalPonits.start.y=t/this.scale,this.selectGlobalPonits.end.x=(n+s)/this.scale,this.selectGlobalPonits.end.y=(t+i)/this.scale,Object.assign(this.globalSelect.style,{transform:"translate3d(".concat(n/this.scale,"px, ").concat(t/this.scale,"px, 0)"),width:this.toPx(s/this.scale),height:this.toPx(i/this.scale)})}},selectGlobalEnd:function(e){if(this.isGlobalSelect=!1,this.globalSelect){this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});this.$bus.$emit("selectGlobal",this.selectGlobalPonits.start,this.selectGlobalPonits.end),this.$refs.root.removeChild(this.globalSelect),this.globalSelect=null}},documentCopy:function(e){var t=this.$store.state.flow.selectedList;t&&t.length>1?this.ctrlCopyNodes=Object(o["a"])(t):this.ctrlCopyNodes=[this.checked]},pasteNode:function(e){var t=this,n=[],s=this.getBeforeCopyLine(this.ctrlCopyNodes),i=s.fromNodeIds,o=s.toNodeIds,a=s.newLines;this.ctrlCopyNodes.forEach((function(e){var s=e,a=s.id,l=Object.assign({},s,{id:d["h"].uuid(),out:[],in:[],x:s.point.x+10,y:s.point.y+10}),r=t.copyNodeNext(l,a,s);t.resetLineFromAndTo(i,o,r,s),n.push(r),t.checked=r})),this.copyEventsLines(a),this.ctrlCopyNodes=n,this.$store.commit("flow/setSelectedList",n)}}},B=A,G=(n("21d6"),Object(N["a"])(B,s,i,!1,null,null,null));t["default"]=G.exports},7950:function(e,t,n){"use strict";var s=n("9a50"),i=n.n(s);i.a},"9a50":function(e,t,n){},b858:function(e,t,n){},e39b:function(e,t,n){"use strict";var s=n("18c6"),i=n.n(s);i.a}}]);
//# sourceMappingURL=Flow.js.map